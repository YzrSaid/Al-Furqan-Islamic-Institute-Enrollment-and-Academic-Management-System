<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Furqan Islamic Institute Incorporated</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0//css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Font Awesome for icons -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script type="text/javascript" th:src="@{/js/publicip.js}"></script>
</head>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let savedSubmenus = JSON.parse(localStorage.getItem("openedSubmenus")) || [];

        savedSubmenus.forEach(submenuId => {
            let submenu = document.getElementById(submenuId);
            if (submenu) {
                submenu.classList.add("open");

                // Make sure parent menus are also opened
                let parentMenu = submenu.closest(".submenu");
                if (parentMenu) {
                    parentMenu.classList.add("open");
                }

                // Update arrow icon
                let arrowIconImg = submenu.previousElementSibling?.querySelector(".arrow-icon img");
                if (arrowIconImg) {
                    arrowIconImg.src = "/images/icons/greater-than.png";
                }
            }
        });
    });
</script>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="text-center">
            <div class="school-logo">
                <img th:src="@{/images/al-furqanlogo.jpg}" alt="School Logo">
            </div>
            <p class="mt-2">S.Y. 2024-2025</p>
            <div class="welcome-div">
                <p>WELCOME, <span class="account-text">ADMIN!</span></p>
            </div>
        </div>

        <a href="/home" class="sidebar-icons menu" onclick="clearSubmenus()">
            <img th:src="@{/images/icons/dashboard_icon.png}" alt="Dashboard Icon"> Dashboard
        </a>

        <a href="#" class="active sidebar-icons" onclick="toggleSubMenu('enrollment-submenu', event)">
            <img th:src="@{/images/icons/enrollment.png}" alt="Enrollment Icon"> Enrollment
            <span class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="enrollment-submenu">
            <a href="/enrollment/listing" class="second-active">Listing/Register</a>
            <a href="/enrollment/assessment">Assessment</a>
            <a href="/enrollment/payment">Payment</a>
            <a href="/enrollment/enrolled">Enrolled</a>
        </div>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('transaction-submenu', event)">
            <img th:src="@{/images/icons/transaction_icon.png}" alt="Transaction Icon"> Transaction
            <span class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="transaction-submenu">
            <a href="/transaction/tuition">Tuition</a>
            <a href="/transaction/academic-resources">Book Distribution</a>
        </div>


        <a href="/grade-management" class="sidebar-icons">
            <img th:src="@{/images/icons/data-entry_icon.png}" alt="Grade Icon"> Grade Management
        </a>

        <a href="/schedule" class="sidebar-icons">
            <img th:src="@{/images/icons/schedule.png}" alt="Schedule Icon"> Schedule
        </a>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('maintenance-submenu', event)">
            <img th:src="@{/images/icons/maintenance_icon.png}" alt="Maintenance Icon"> Maintenance <span
                class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="maintenance-submenu">
            <a href="/maintenance/school-year">School Year</a>
            <a href="/maintenance/grade-level">Grade Level</a>
            <a href="/maintenance/subject">Subject</a>
            <a href="/maintenance/section">Section</a>
            <a href="/maintenance/fees-management">Fees Management</a>
            <!-- <a href="/maintenance/teacher">Teacher</a> -->
        </div>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('reports-submenu', event)">
            <img th:src="@{/images/icons/reports_icon.png}" alt="Reports Icon"> Reports <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="reports-submenu">
            <a href="/reports/student">Student Reports</a>
            <a href="/reports/payment">Payment Reports</a>
            <a href="/reports/teacher">Teacher Report</a>
            <a href="/reports/academic-resources">Book Distribution Reports</a>
        </div>
        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('account-submenu', event)">
            <img th:src="@{/images/icons/account.png}" alt="Account Icon"> Account <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="account-submenu">
            <a href="/accounts/verify-accounts">Verify Accounts</a>
            <a href="/accounts/manage-accounts">Manage Accounts</a>
            <a href="/accounts/my-account">My Account</a>
        </div>
        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('settings-submenu', event)">
            <img th:src="@{/images/icons/settings.png}" alt="Reports Icon"> Settings <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="settings-submenu">
            <a href="/settings/create-user">Create User</a>
        </div>
    </div>

    <!-- Topbar with Hamburger & User Icon -->
    <div class="dashboard-container" id="content">
        <div class="topbar">
            <div class="main-topbar">
                <span class="hamburger" onclick="toggleSidebar()">
                    <img th:src="@{/images/icons/burger_menu_icon.png}" alt="Menu">
                </span>

                <span class="institute-name">AL-FURQAN ISLAMIC INSTITUTE INCORPORATED</span>
            </div>
            <div class="dropdown-logout">
                <div class="user-icon dropdown-logout-toggle">
                    <img th:src="@{/images/icons/account.png}" onclick="toggleDropdown('dropdownUserIcon')"
                        alt="User Icon">
                    <div id="dropdownUserIcon" class="dropdown-logout-content">
                        <h6><span>Admin</span></h6>
                        <a href="/logout">Log Out</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-link">
            <h4>Listing/Register</h4>
            <p>Main</p>
            <p>/</p>
            <p>Transaction</p>
            <p>/</p>
            <p>Enrollment</p>
            <p>/</p>
            <p>Listing/Register</p>
        </div>

        <!-- Enrollment Buttons -->
        <div class="enrollment-buttons">
            <button class="new-student" data-open-modal="newStudentModal">NEW STUDENT</button>
            <button id="old-student" data-open-modal="oldStudentModal">EXISTING RECORDS</button>
            <button id="transferee" data-open-modal="transfereeStudentModal">TRANSFEREE</button>
        </div>

        <div class="search-div">
            <!-- Searchbox and sort btn -->
            <div class="search">
                <div class="search-container">
                    <input type="text" placeholder="Search..." class="search-input" />
                    <button class="search-btn">Search</button>
                </div>
                <div class="sort-container">
                    <select name="sort" id="sort-select" class="sort-select">
                        <option value="" disabled selected>Sort</option>
                        <option value="patient-number">Patient Number</option>
                        <option value="patient-name">Patient Name</option>
                        <option value="patient-sex">Sex</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Table -->
        <table id="lamesa" class="listing-table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Student Name</th>
                    <th>Current Grade Level</th>
                    <th>Type</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Batman</td>
                    <td>25</td>
                    <td>New Student</td>
                    <td>
                        <div class="dropdown">
                            <div class="status-container">
                                <div class="status" id="status-registration">Incomplete</div>
                                <button class="dropdown-status-btn">
                                    <i class="fas fa-chevron-down"></i> <!-- Icon is the button -->
                                </button>
                            </div>
                            <div class="dropdown-status-content" id="dropdown-listing">
                                <a href="#" data-action="listingAddGradeLevel"
                                    data-open-modal="gradeLevelModal">Proceed</a>
                                <a href="#" data-action="cancelRegistration" data-open-modal="confirmationModal"
                                    data-message="Are you sure you want to cancel this registration?">Cancel
                                    Registration</a>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Modal for student information -->
        <div id="studentInformationModal" class="student-information-modal modal">
            <div class="student-information-modal-content">
                <h1>Student Information</h1>
                <form method="" action="" id="studentInformationForm">
                    <div class="header">
                        <div class="half-unique">
                            <label for="student-id">Student ID: </label>
                            <input type="text" id="student-id">
                        </div> <br>

                        <div style="display: flex; gap: 50px;">
                            <div class="half-unique" id="stud-type-row">
                                <label for="type">Student Type:</label>
                                <h6>New</h6>
                            </div>

                            <div class="half-unique" id="scholar-row">
                                <label for="type">Scholar:</label>
                                <h6>Yes</h6>
                            </div>
                        </div>


                    </div>


                    <div style="display: flex; align-content: center; justify-items: left;">
                        <h2>Personal Information</h2>
                    </div>

                    <div class="container">
                        <div class="row">
                            <div class="column1">
                                <div>
                                    <label for="name">Name</label>
                                    <div class="student-form-group half">
                                        <input type="text" id="firstName">
                                        <input type="text" id="middleName">
                                        <input type="text" id="lastName">
                                    </div>
                                    <div class="small-text">
                                        <p>First</p>
                                        <p>Middle</p>
                                        <p>Last</p>
                                    </div>
                                </div>
                            </div>
                            <div class="column2">
                                <!-- Gender, BDate, and Scholar -->
                                <div class="student-form-group half-stud-info-small" style="margin-bottom: 0px;">
                                    <label for="gender">Gender:</label>
                                    <input type="text" id="gender" style="width: 80px;">

                                    <label for="birthdate">Birthdate:</label>
                                    <input type="date" id="birthdate" readonly style="width: 120px;">
                                </div>
                            </div>

                            <div class="student-form-group">
                                <div>
                                    <label for="address">Address:</label>
                                    <div class="student-form-group half-unique">
                                        <input type="text" id="street" required placeholder="Street">
                                        <input type="text" id="barangay" required placeholder="Barangay">
                                        <input type="text" id="city" required placeholder="City">
                                    </div>
                                </div>

                                <div>
                                    <label>Place of Birth:</label>
                                    <div class="student-form-group">
                                        <input type="text" id="placeOfBirth" class="place-of-birth"
                                            style="width: 390px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                        <h2>Additional Information</h2>
                    </div>

                    <div>
                        <h6>Father's Information</h6>
                        <div class="student-form-group">
                            <label for="fatherName">Name:</label>
                            <input type="text" id="fatherName">

                            <label for="fatherOccupation">Occupation:</label>
                            <input type="text" id="fatherOccupation">
                        </div> <br>
                    </div>
                    <div>
                        <h6>Mother's Information</h6>
                        <div class="student-form-group">
                            <label for="motherName">Name:</label>
                            <input type="text" id="motherName">

                            <label for="motherOccupation">Occupation:</label>
                            <input type="text" id="motherOccupation">
                        </div> <br>
                    </div>

                    <h6>Guardian's Information</h6>
                    <div class="student-form-group">
                        <label for="guardianName">Name:</label>
                        <input type="text" id="guardianName">

                        <label for="guardianOccupation">Occupation:</label>
                        <input type="text" id="guardianOccupation">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="guardianContactNumber">Contact Number:</label>
                        <input type="text" id="guardianContactNumber" style="width: 385px;">

                        <label for="guardianAddress">Address:</label>
                        <input type="text" id="guardianAddress" style="width: 355px;">
                    </div> <br>

                    <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                        <h2>For Transferees Only</h2>
                    </div>

                    <div class="student-form-group">
                        <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                        <input type="text" id="lastGradeLevelCompleted">

                        <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed</label>
                        <input type="text" id="lastMadrasaYearCompleted">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                        <input type="text" id="madrasaNameLastAttended">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="madrasaAddress">Madrasa Address:</label>
                        <input type="text" id="madrasaAddress">
                    </div> <br>

                    <div style="display: flex; gap: 365px;">
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Financial Information</h2>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Book Distribution</h2>
                        </div>
                    </div>

                    <div class="container-two">
                        <div class="column-main">
                            <p>Recent Transactions</p>
                            <div class="table-container">
                                <table class="mini-table" id="payment-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Book</td>
                                            <td><span>P</span>2,000</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="status-payments">Unpaid</div>
                                                </div>
                                            </td>
                                            <td>February 12, 2025</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin: 0px;">
                                <div style="display: flex; gap: 10px;">
                                    <h6>Balance:</h6>
                                    <h6>1, 000</h6>
                                </div>
                                <button id="transaction-record-btn">View Record</button>
                            </div>

                        </div>

                        <div class="column-main">
                            <p>Recent Distributions</p>
                            <div class="table-container">
                                <table class="mini-table" id="distribution-table">
                                    <thead>
                                        <tr>
                                            <th>Grade Level</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Grade 1</td>
                                            <td>February 12, 2025</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="status-distribution">Completed</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> <br>

                    <div>
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Grades</h2>
                        </div>
                    </div>

                    <div class="container-two">
                        <div class="column-main">
                            <div class="table-container">
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="display: flex; gap: 8px;">
                                        <label>School Year:</label>
                                        <h6 id="sy">2025-2026</h6>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <label>Semester:</label>
                                        <h6 id="sem">1st Semester</h6>
                                    </div>
                                </div>
                                <table class="mini-table" id="grades-table">
                                    <thead>
                                        <tr>
                                            <th>Subject</th>
                                            <th>Grade</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr>
                                            <td>English</td>
                                            <td>78</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="grade-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr id="average-row">
                                            <td>Average</td>
                                            <td>90</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="average-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="column-main">
                            <div class="table-container">
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="display: flex; gap: 8px;">
                                        <label>School Year:</label>
                                        <h6 id="sy">2025-2026</h6>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <label>Semester:</label>
                                        <h6 id="sem">1st Semester</h6>
                                    </div>
                                </div>
                                <table class="mini-table" id="grades-table">
                                    <thead>
                                        <tr>
                                            <th>Subject</th>
                                            <th>Grade</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr>
                                            <td>English</td>
                                            <td>78</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="grade-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr id="average-row">
                                            <td>Average</td>
                                            <td>90</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="average-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn-cancel"
                            data-close-modal="studentInformationModal">Close</button>
                    </div>
            </div>
            </form>
        </div>
    </div>

    <!-- Modal for confirmation -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <p id="modalText"></p>
            <div class="modal-buttons">
                <button id="confirmAction" class="btn-confirm">Confirm</button>
                <button class="btn-close-confirm" data-close-modal="confirmationModal">Cancel</button>
            </div>
        </div>
    </div>


    <!-- Modal for adding a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content">
            <h2>Promote To</h2>

            <label for="grade-level">Grade Level:</label>
            <input type="text" id="grade-level" readonly>

            <label for="section">Section:</label>
            <select name="section" id="section">
                <option value="" disabled selected>Choose</option>
            </select>


            <div class="modal-buttons">
                <button type="button" class="btn-confirm" data-action="proceedToPayment"
                    data-message="Are you sure you want to proceed with payment?" id=""
                    data-open-modal="confirmationModal">
                    Confirm
                </button>
                <button type="button" class="btn-cancel" data-close-modal="addGradeLevelAssessmentModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for addPaymentModal-->
    <div id="addPaymentModal" class="add-payment-modal modal">
        <div class="printable-area">
            <div class="add-payment-modal-content">
                <div class="header-container">
                    <h2>Payment Form</h2>
                    <div class="logo">
                        <img th:src="@{/images/al-furqanlogo.jpg}" alt="School Logo">
                    </div>
                </div> <br>
                <div class="date-sem-container">
                    <div class="separator">
                        <div class="half-width">
                            <label for="date">Date:</label>
                            <input type="date" id="date">
                        </div>
                        <div id="sem-sy">
                            <div class="half-width">
                                <label for="semester">Semester:</label>
                                <input type="text" id="semester" readonly>
                            </div>
                            <div class="half-width">
                                <label for="school-year">School Year:</label>
                                <input type="text" id="school-year" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="content-container">
                        <h6>Received payment from</h6>
                        <input type="text" id="payee-name" readonly>
                        <h6>Student ID</h6>
                        <input type="number" id="student-id" readonly value="0001">
                        <h6>sum of ₱</h6>
                        <input type="number" id="payment-amount">
                        <h6>as payment for</h6>
                        <select name="payment-list" id="payment-list">
                            <option value="" disabled>Choose</option>
                        </select>
                    </div> <br> <br>

                    <div class="collector-info-container">
                        <h6>Received/Collected By:</h6>
                        <div class="collector-name-container">
                            <input type="text" readonly value="Mohammad Aldrin Said" id="collector-name">
                            <p id="position">Enrollment Staff</p>
                        </div>
                    </div>

                    <div class="modal-buttons payment-modal-buttons">
                        <button class="no-print" onclick="printReport()">Print Report</button>

                        <button id="save-payment-btn" class="btn-confirm no-print" type="button"
                            data-open-modal="confirmationModal" data-action="savePayment"
                            data-message="Are you sure you want to save this payment?">Save
                        </button>

                        <button type="button" data-close-modal="addPaymentModal" class="btn-cancel no-print"
                            id="close-button">Close</button>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal for listOfPaymentsModal -->
    <div id="listOfPaymentsModal" class="list-of-payments-modal modal">
        <div class="list-of-payments-modal-content">
            <h2>List of Payments</h2>

            <div class="half-width" id="view-grade-studId">
                <label for="student-id">Student ID:</label>
                <h6 id="student-id">0001</h6>
            </div>
            <div class="half-width" id="view-grade-studName">
                <label for="student-name">Student Name:</label>
                <h6 id="student-name">Martin Francisco</h6>
            </div> <br>

            <!-- List of Payments Table -->
            <table id="table-ni-kharl" class="view-list-of-payments-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <td>Tuition</td>
                    <td>2,000.00</td>
                    <td>
                        <div class="status-container">
                            <div class="status" id="status-payments">Unpaid</div>
                        </div>
                    </td>
                    <td>
                        <div class="action-container">
                            <div class="action">
                                <button id="open-add-payment-modal" data-open-modal="addPaymentModal">
                                    <img id="add-button" th:src="@{/images/icons/add-button.png}"
                                        alt="add-payment-icon">
                                </button>
                            </div>

                        </div>

                    </td>
                </tbody>
            </table>

            <!-- Close button -->
            <div class="close-button" id="view-grades-close-btn">
                <button type="button" data-close-modal="listOfPaymentsModal" class="btn-cancel"
                    id="close-button">Close</button>
            </div>
        </div>
    </div>


    <!-- Modal for listing add grade level -->
    <div id="gradeLevelModal" class="grade-level-modal modal">
        <div class="grade-level-modal-content">
            <h2>Enroll To</h2>
            <form method="post" action="/gradelevelmaintenance/add" id="gradeLevelForm">
                <label for="levelName">Grade Level Name:</label>
                <select name="levelName" id="levelName">
                    <option value="" disabled>Choose a Grade Level</option>
                </select>
                <br><br>
                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" data-action="proceedAssessment"
                        data-message="Are you sure you want to proceed this registration from Listing to Assessment?"
                        id="confirmGradeLevel" data-open-modal="confirmationModal">
                        Confirm
                    </button>
                    <button type="button" class="btn-cancel" data-close-modal="gradeLevelModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for new student enrollment -->
    <div id="newStudentModal" class="student-modal modal">
        <div class="student-modal-content">
            <h2>Student Information</h2>
            <form id="studentForm">
                <div class="header">
                    <h5>Personal Information</h5>
                </div>

                <div class="student-form-group">
                    <label for="studentFirstName">First Name:</label>
                    <input type="text" id="studentFirstName" required>

                    <label for="studentLastName">Last Name:</label>
                    <input type="text" id="studentLastName" required>

                    <label for="studentMiddleName">Middle Name:</label>
                    <input type="text" id="studentMiddleName" placeholder="Optional">
                </div> <br>

                <div class="student-form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                    </select>

                    <label for="birthdate">Birthdate:</label>
                    <input type="date" id="birthdate" required>

                    <div class="checkbox">
                        <label for="scholar">Scholar:</label>
                        <input type="checkbox" id="scholar">
                    </div>

                </div> <br>


                <div class="student-form-group">
                    <label>Place of Birth:</label>
                    <input type="text" id="placeOfBirth" class="place-of-birth">
                </div> <br>

                <div>
                    <label for="address">Address:</label>
                    <div class="student-form-group">
                        <input type="text" id="street" required placeholder="Street">
                        <input type="text" id="barangay" required placeholder="Barangay">
                        <input type="text" id="city" required placeholder="City">
                    </div>
                </div> <br> <br>

                <h5>Parent's/Guardian's Information</h5>

                <h6>Father's Information</h6>
                <div class="student-form-group">
                    <label for="fatherName">Name:</label>
                    <input type="text" id="fatherName" required>

                    <label for="fatherOccupation">Occupation:</label>
                    <input type="text" id="fatherOccupation">
                </div> <br>

                <h6>Mother's Information</h6>
                <div class="student-form-group">
                    <label for="motherName">Name:</label>
                    <input type="text" id="motherName" required>

                    <label for="motherOccupation">Occupation:</label>
                    <input type="text" id="motherOccupation">
                </div> <br>

                <h6>Guardian's Information</h6>
                <div class="student-form-group">
                    <label for="guardianName">Name:</label>
                    <input type="text" id="guardianName">

                    <label for="guardianOccupation">Occupation:</label>
                    <input type="text" id="guardianOccupation">
                </div> <br>

                <div class="student-form-group">
                    <label for="guardianContactNumber">Contact Number:</label>
                    <input type="text" id="guardianContactNumber">

                    <label for="guardianAddress">Address:</label>
                    <input type="text" id="guardianAddress">
                </div> <br>

                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" id="confirmStudent" data-action="addListing"
                        data-open-modal="confirmationModal"
                        data-message="Are you sure you want to add this new student?">Confirm</button>
                    <button type="button" class="btn-cancel" id="cancelStudent"
                        data-close-modal="newStudentModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content">
            <p id="errorMessage"></p>
            <div class="modal-buttons">
                <button class="error-btn-cancel" data-close-modal="errorModal">Close</button>
            </div>
        </div>
    </div>

    <!-- Success modal -->
    <div id="successModal"
        style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: #218838; color: #ffffff; font-weight: bolder; padding: 30px; border-radius: 7px; text-align: center; z-index: 10000;">
        <p id="successModalMessage"></p>
    </div>


    <!-- Modal for adding a a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content">
            <h2>Promote To</h2>

            <label for="grade-level">Grade Level:</label>
            <input type="text" id="grade-level" readonly>

            <label for="section">Section:</label>
            <select name="section" id="section">
                <option value="" disabled selected>Choose</option>
            </select>


            <div class="modal-buttons">
                <button type="button" class="btn-confirm" data-action="proceedToPayment"
                    data-message="Are you sure you want to proceed with payment?" id=""
                    data-open-modal="confirmationModal">
                    Confirm
                </button>
                <button type="button" class="btn-cancel" data-close-modal="addGradeLevelAssessmentModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing grades -->
    <div id="viewGradesModal" class="view-grades-modal modal">
        <div class="view-grades-modal-content">
            <h2>Student Grades</h2>

            <div class="half-width" id="view-grade-studId">
                <label for="student-id">Student ID:</label>
                <h6 id="student-id">0001</h6>
            </div>
            <div class="half-width" id="view-grade-studName">
                <label for="student-name">Student Name:</label>
                <h6 id="student-name">Martin Francisco</h6>
            </div> <br>

            <!-- Grades Table -->
            <table class="view-grades-table">
                <thead>
                    <tr>
                        <th>Subject ID</th>
                        <th>Subject</th>
                        <th>Grade</th>
                        <th>Remarks</th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td>001</td>
                        <td>English</td>
                        <td>78</td>
                        <td>
                            <div class="status-container">
                                <div class="status" id="grade-remarks">Pass</div>
                            </div>
                        </td>
                    </tr>

                    <tr id="average-row">
                        <td colspan="2">Average</td>
                        <td>90</td>
                        <td>
                            <div class="status-container">
                                <div class="status" id="average-remarks">Pass</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- <div class="half-width" id="view-grade-average">
                <label for="grade-average">Final Average:</label>
                <input type="text" id="average-input" readonly value="90">
            </div>
            
            <div class="half-width" id="view-grade-remarks">
                <label for="grade-average">Remarks:</label>
                <div class="status-container">
                    <div class="status" id="grade-remarks">Pass</div>
                </div>  
            </div> -->

            <!-- Close button -->
            <div class="close-button" id="view-grades-close-btn">
                <button type="button" data-close-modal="viewGradesModal" class="btn-cancel"
                    id="close-button">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for transferee enrollment -->
    <div id="transfereeStudentModal" class="student-modal modal">
        <div class="student-modal-content">
            <h2>Student Information</h2>
            <form id="studentForm">
                <div class="header">
                    <h5>Personal Information</h5>
                </div>

                <div class="student-form-group">
                    <label for="studentFirstName">First Name:</label>
                    <input type="text" id="studentFirstName" required>

                    <label for="studentLastName">Last Name:</label>
                    <input type="text" id="studentLastName" required>

                    <label for="studentMiddleName">Middle Name:</label>
                    <input type="text" id="studentMiddleName" placeholder="Optional">
                </div> <br>

                <div class="student-form-group half">
                    <label for="gender">Gender:</label>
                    <select id="gender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                    </select>

                    <label for="birthdate">Birthdate:</label>
                    <input type="date" id="birthdate" required>
                </div> <br>

                <div class="student-form-group">
                    <label>Place of Birth:</label>
                    <input type="text" id="placeOfBirthTransferee" class="place-of-birth">
                </div> <br>

                <div>
                    <label for="address">Address:</label>
                    <div class="student-form-group">
                        <input type="text" id="street" required placeholder="Street">
                        <input type="text" id="barangay" required placeholder="Barangay">
                        <input type="text" id="city" required placeholder="City">
                    </div>
                </div> <br> <br>

                <h5>Parent's/Guardian's Information</h5>

                <h6>Father's Information</h6>
                <div class="student-form-group">
                    <label for="fatherName">Name:</label>
                    <input type="text" id="fatherName" required>

                    <label for="fatherOccupation">Occupation:</label>
                    <input type="text" id="fatherOccupation">
                </div> <br>

                <h6>Mother's Information</h6>
                <div class="student-form-group">
                    <label for="motherName">Name:</label>
                    <input type="text" id="motherName" required>

                    <label for="motherOccupation">Occupation:</label>
                    <input type="text" id="motherOccupation">
                </div> <br>

                <h6>Guardian's Information</h6>
                <div class="student-form-group">
                    <label for="guardianName">Name:</label>
                    <input type="text" id="guardianName">

                    <label for="guardianOccupation">Occupation:</label>
                    <input type="text" id="guardianOccupation">
                </div> <br>

                <div class="student-form-group">
                    <label for="guardianContactNumber">Contact Number:</label>
                    <input type="text" id="guardianContactNumber">

                    <label for="guardianAddress">Address:</label>
                    <input type="text" id="guardianAddress">
                </div> <br>

                <h5>For Transferees Only</h5>

                <div class="student-form-group">
                    <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                    <input type="text" id="lastGradeLevelCompleted">

                    <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed</label>
                    <input type="text" id="lastMadrasaYearCompleted">
                </div> <br>

                <div class="student-form-group">
                    <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                    <input type="text" id="madrasaNameLastAttended">


                </div> <br>

                <div class="student-form-group">
                    <label for="madrasaAddress">Madrasa Address:</label>
                    <input type="text" id="madrasaAddress" style="width: 900px;">
                </div> <br>

                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" id="confirmStudent" data-open-modal="confirmationModal"
                        data-message="Are you sure you want to add this new student?">Confirm</button>
                    <button type="button" class="btn-cancel" id="cancelStudent"
                        data-close-modal="transfereeStudentModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Modal for old student enrollment -->
    <div id="oldStudentModal" class="old-student-modal modal">
        <div class="old-student-modal-content">
            <div>
                <h2>Existing Records</h2>
                <div class="search-div">
                    <!-- Searchbox btn -->
                    <div class="search">
                        <div class="search-container">
                            <input type="text" placeholder="Search..." class="search-input" />
                            <button class="search-btn">Search</button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <!-- Table -->
                            <table class="old-student-table">
                                <thead>
                                    <tr>
                                        <th>Student ID</th>
                                        <th>Student Name</th>
                                        <th>Grade Level</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>001</td>
                                        <td>Batman</td>
                                        <td>Grade 1 - Lamok</td>
                                        <td>
                                            <div class="action-container">
                                                <div class="action">
                                                    <img data-open-modal="confirmationModal"
                                                        data-id="${student.student_Id}"
                                                        data-message="Are you sure you want to register this old student?"
                                                        src="/images/icons/add-button.png" alt="add-button-icon">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-cancel" id="cancelStudent"
                    data-close-modal="oldStudentModal">Close</button>
            </div>
            </form>
        </div>
    </div>
    <script th:src="@{/js/script.js}"></script>
</body>

<script>
    async function fetchStudents() {
        try {
            const response = await fetch("/students/all");
            if (!response.ok) {
                throw new Error("Failed to fetch students");
            }

            const students = await response.json();
            const studentTableBody = document.querySelector(".old-student-table tbody");

            // Clear previous data
            studentTableBody.innerHTML = "";

            // Populate table with fetched data
            students.forEach(student => {
                const fullName = `${student.firstName} ${student.middleName || ""} ${student.lastName}`.trim();

                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${student.studentDisplayId}</td>
                <td>${fullName}</td>
                <td>${student.currentGradeSection || "NONE"}</td>
                <td>
                    <div class="action-container">
                        <div class="action">
                            <img
                                onClick="addExistingStudent(${student.studentId})"
                                src="/images/icons/add-button.png" 
                                alt="add-button-icon"
                            >
                        </div>
                    </div>
                </td>
            `;

                studentTableBody.appendChild(row);
            });

        } catch (error) {
            console.error("Error fetching students:", error);
            alert("Failed to fetch student data. Please try again.");
        }
    }


    document.addEventListener("DOMContentLoaded", function () {
        fetchAllGradeLevels();
        fetchStudents();
    });

    function proceedToPayment(enrollmentIdLet, sectionNumberLet) {
        // Re-fetch the sectionNumber to ensure we have the latest value
        sectionNumberLet = document.querySelector("#section").value;

        // Check if section is selected
        if (!sectionNumberLet || sectionNumberLet === "") {
            alert("⚠️ Please select a section before proceeding.");
            return;
        }

        const apiUrl = `/enrollment/add/payment/${enrollmentIdLet}/${sectionNumberLet}`;
        console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status }))) // Get text & status
            .then(({ text, status }) => {
                console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
                    alert("✅ Enrollment successfully moved to payment.");
                    location.reload(); // Reloads the page
                } else {
                    alert(`⚠️ ${text}`); // Shows backend response in an alert
                }
            })
            .catch(error => {
                console.error("🚨 Error calling proceedToPayment API:", error);
                alert("❌ Error: Unable to proceed with payment.");
            });
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            if (event.target.closest(".proceedButton")) {
                event.preventDefault(); // Prevent default link behavior

                // Get Enrollment ID from the button
                enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id");

                // Get the selected section number value
                sectionNumberLet = document.querySelector("#section").value;

                console.log("Enrollment ID:", enrollmentIdLet);
                console.log("Selected Section:", sectionNumberLet);
            }
        });
    });

    function getPaymentStatusClass(status) {
        status = status.toLowerCase();
        if (status === "paid") {
            return "paid-status";
        } else if (status === "unpaid") {
            return "unpaid-status";
        } else if (status === "partially paid") {
            return "partially-paid-status"
        }
        return "";
    }


    document.addEventListener("click", function (event) {
        // Check if the clicked element is for opening the "List of Payments" modal
        const proceedButton = event.target.closest('[data-open-modal="listOfPaymentsModal"]');
        if (proceedButton) {
            const enrollmentId = proceedButton.getAttribute("data-enrollment-id");
            if (!enrollmentId) return console.error("Enrollment Id Not Found");

            fetchPayments(enrollmentId);
        }
    });

    function fetchPayments(enrollmentId) {
        fetch(`/enrollment/paymentView/${enrollmentId}`)
            .then(res => res.json())
            .then(epv => {
                console.log('The object is', epv);
                const studentname = document.querySelector("#student-name");
                const studentId = document.querySelector("#student-id");
                alert(epv.studentId);
                if (!studentname || !studentId) return console.error("Dropdown for sections not found");

                studentname.textContent = epv.studentFirstName + ' ' + epv.studentLastName;
                studentId.textContent = epv.studentId;

                const tableBody = document.querySelector("#table-ni-kharl tbody");
                tableBody.innerHTML = "";
                const feeStatusArray = Object.entries(epv.feeStatus);

                feeStatusArray.forEach(([key, value]) => {
                    const match = key.match(/name=([^,]+), requiredAmount=([\d.]+)/);
                    if (match) {
                        const name = match[1];
                        const requiredAmount = match[2];

                        const row = document.createElement("tr");

                        // Get class for status
                        const statusClass = getPaymentStatusClass(value);

                        row.innerHTML = `
                        <td>${name}</td>
                        <td>${requiredAmount}</td>
                        <td>
                            <div class="status-container">
                                <div class="status ${statusClass}">${value}</div>
                            </div>
                        </td>
                        <td>
                            <div class="action-container">
                                <div class="action">
                                    <img data-open-modal="addPaymentModal" src="/images/icons/add-button.png"
                                        alt="add-payment-icon" class="add-payment-btn">
                                </div>
                            </div>
                        </td>`;

                        tableBody.appendChild(row);
                    }
                });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }

    async function fetchAllGradeLevels() {
        try {
            const response = await fetch('/gradelevel/all'); // Adjust if API runs on a different port
            if (!response.ok) throw new Error("Failed to fetch grade levels");

            const data = await response.json();
            populateGradeLevelDropdown(data);
        } catch (error) {
            console.error("Error fetching grade levels:", error);
        }
    }

    function populateGradeLevelDropdown(gradeLevels) {
        const selectElement = document.getElementById("levelName");
        selectElement.innerHTML = '<option value="" disabled selected>Choose a Grade Level</option>'; // Reset options

        gradeLevels.forEach(level => {
            let option = document.createElement("option");
            option.value = level.levelId;
            option.textContent = level.levelName;
            selectElement.appendChild(option);
        });
    }


    document.addEventListener("DOMContentLoaded", function () {
        goList();
    });


    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            if (event.target.closest(".proceedButton")) {
                event.preventDefault(); // Prevent default link behavior

                enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id");
                console.log("Enrollment ID:", enrollmentIdLet); // Check if it's logging
            }
        });
    });

    function proceedToEnrolled(enrollmentIdLet) {
        const apiUrl = `/enrollment/add/enrolled/${enrollmentIdLet}`;
        console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status }))) // Get text & status
            .then(({ text, status }) => {
                console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
                    alert("✅ Student successfully enrolled!");
                    location.reload(); // Reloads the page after successful enrollment
                } else {
                    alert(`⚠️ ${text}`); // Shows backend response message
                }
            })
            .catch(error => {
                console.error("🚨 Error calling proceedToEnrolled API:", error);
                alert("❌ Error: Unable to proceed with enrollment.");
            });
    }

    async function proceedToAssessment(enrollmentIdLet) {
        const gradeLevelId = document.getElementById("levelName").value;

        if (!gradeLevelId) {
            alert("Please select a grade level.");
            return;
        }

        try {
            const response = await fetch(`/enrollment/add/assessment/${enrollmentIdLet}/${gradeLevelId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" }
            });

            const result = await response.text();

            if (response.ok) {
                alert("Enrollment successfully moved to assessment!");
                location.reload(); // Reload to update the table
            } else {
                alert(result); // Show error message
            }
        } catch (error) {
            console.error("Error proceeding to assessment:", error);
            alert("Transaction failed. Try again.");
        }
    }

    function addExistingStudent(studentId) {
        fetch('/enrollment/add/student/' + studentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        showSuccessModal(message);
                        window.location.reload(); // Reload the page
                    } else {
                        showErrorModal(message);
                    }
                });
            })
            .catch(error => {
                showErrorModal(message);
            });
    }
    // function goList() {
    //     fetch("/enrollment/all/listing")
    //         .then(res => {
    //             if (!res.ok) throw new Error("Failed to fetch grade levels");
    //             return res.json();
    //         })
    //         .then(data => {
    //             const tableBody = document.querySelector("#lamesa tbody");
    //             tableBody.innerHTML = "";

    //             data.forEach(enr => {
    //                 console.log(enr);
    //                 enrollmentIdLet = enr.enrollmentId;

    //                 const row = document.createElement("tr");
    //                 row.setAttribute("data-enrollment-id", enr.enrollmentId);

    //                 row.innerHTML = `
    //             <td>${enr.student.studentDisplayId}</td>
    //             <td>${enr.student.firstName} ${enr.student.middleName} ${enr.student.lastName}</td>
    //             <td>${enr.student.currentGradeSection === null ? "NONE" : enr.student.currentGradeSection?.level?.levelName || "N/A"}</td>
    //             <td>${enr.student.new ? 'New Student' : 'Old Student'}</td>
    //             <td>
    //                 <div class="dropdown">
    //                     <div class="status-container">
    //                         <div class="status" id="status-registration">${enr.enrollmentStatus}</div>
    //                         <button class="dropdown-status-btn">
    //                             <i class="fas fa-chevron-down"></i>
    //                         </button>
    //                     </div>
    //                     <div class="dropdown-status-content" id="dropdown-listing">
    //                         <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}">View Record</a>

    //                         <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" 
    //                             data-open-modal="gradeLevelModal">Proceed</a>

    //                         <a href="#" data-action="cancelRegistration" data-open-modal="confirmationModal"
    //                             data-message="Are you sure you want to cancel this registration?">
    //                             Cancel Registration
    //                         </a>
    //                     </div>
    //                 </div>
    //             </td>
    //         `;

    //                 tableBody.appendChild(row);
    //             });

    //             // ✅ Event Listener for 'View Record'
    //             document.addEventListener("click", function (event) {
    //                 const target = event.target;

    //                 if (target.classList.contains("viewRecordButton")) {
    //                     const enrollmentId = target.getAttribute("data-enrollment-id");
    //                     console.log("🔍 View Record for Enrollment ID:", enrollmentId);
    //                     // Add logic for opening a modal or redirecting here
    //                 }
    //             });
    //         })
    //         .catch(error => console.error("Error:", error));
    // }


    document.addEventListener("click", function (event) {
        const viewRecordButton = event.target.closest(".viewRecordButton"); // ✅ Detect "View Record" click
        if (viewRecordButton) {
            const enrollmentId = viewRecordButton.getAttribute("data-enrollment-id"); // ✅ Capture enrollment ID
            console.log(`🔍 View Record for Enrollment ID: ${enrollmentId}`);

            // Show the modal
            const modal = document.getElementById("studentInformationModal");
            if (modal) {
                modal.classList.add("show");
                modal.style.visibility = "visible";
                modal.style.opacity = "1";
                modal.style.pointerEvents = "auto";
            }
        }
    });



    document.getElementById("scholar").addEventListener("change", function () {
        this.checked;
    });


    function addListing() {
        const actionUrl = "/students/add"; // Update with your actual API endpoint
        const method = "POST";

        // Collect input values
        const birthPlace =
            document.getElementById("placeOfBirth")?.value?.trim() ||
            document.getElementById("placeOfBirthTransferee")?.value?.trim() ||
            null;

        const studentData = {
            scholar: document.getElementById("scholar").checked,
            firstName: document.getElementById("studentFirstName").value.trim(),
            lastName: document.getElementById("studentLastName").value.trim(),
            middleName: document.getElementById("studentMiddleName")?.value?.trim() || null,
            gender: document.getElementById("gender")?.value || null,
            birthdate: document.getElementById("birthdate")?.value || null,
            birthPlace: birthPlace, // Use the extracted birthPlace variable

            // Address
            address: [
                document.getElementById("street")?.value?.trim(),
                document.getElementById("barangay")?.value?.trim(),
                document.getElementById("city")?.value?.trim()
            ].filter(Boolean).join(", "), // Removes empty values

            // Parent's Information
            fatherName: document.getElementById("fatherName")?.value?.trim() || null,
            fatherOccupation: document.getElementById("fatherOccupation")?.value?.trim() || null,
            motherName: document.getElementById("motherName")?.value?.trim() || null,
            motherOccupation: document.getElementById("motherOccupation")?.value?.trim() || null,

            // Guardian's Information
            guardianName: document.getElementById("guardianName")?.value?.trim() || null,
            guardianOccupation: document.getElementById("guardianOccupation")?.value?.trim() || null,
            guardianContactNum: document.getElementById("guardianContactNumber")?.value?.trim() || null,
            guardianAddress: document.getElementById("guardianAddress")?.value?.trim() || null
        };

        console.log("Student Data:", studentData);

        fetch(actionUrl, {
            method: method,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(studentData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.text();
            })
            .then(text => {
                showSuccessModal("✅ Success: New student has been added successfully!");
            })
            .catch(error => {
                showErrorModal("❌ Error: " + error.message);
            });
    }

    function goList() {
        fetch("/enrollment/all/listing")
            .then(res => {
                if (!res.ok) throw new Error("Failed to fetch enrollment records");
                return res.json();
            })
            .then(data => {
                const tableBody = document.querySelector("#lamesa tbody");
                tableBody.innerHTML = "";

                data.forEach(enr => {
                    console.log(enr);

                    const row = document.createElement("tr");
                    row.setAttribute("data-enrollment-id", enr.enrollmentId);
                    row.classList.add("clickable-row");

                    // 🔹 Dynamic Dropdown Content
                    let dropdownContent = "";

                    switch (enr.enrollmentStatus) {
                        case "LISTING":
                            dropdownContent = `
                            <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}" 
                               data-open-modal="studentInformationModal"> View Record </a>

                            <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" 
                               data-open-modal="gradeLevelModal"> Proceed </a>

                            <a href="#" data-action="cancelRegistration" data-open-modal="confirmationModal" 
                               data-message="Are you sure you want to cancel this registration?"> Cancel Registration </a>
                        `;
                            break;

                        case "ASSESSMENT":
                            dropdownContent = `
                            <a href="#" class="viewGradesButton" data-enrollment-id="${enr.enrollmentId}" 
                               data-open-modal="viewGradesModal"> View Grades </a>

                            <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" data-grade-level-id="${enr.gradeLevelToEnroll}" 
                               data-open-modal="addGradeLevelAssessmentModal"> Proceed </a>
                        `;
                            break;

                        case "PAYMENT":
                            dropdownContent = `
                            <a href="#" class="viewPaymentsButton" data-enrollment-id="${enr.enrollmentId}" 
                               data-open-modal="listOfPaymentsModal"> View List of Payments </a>

                            <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" 
                               data-open-modal="confirmationModal" data-message="Are you sure you want to proceed and finish enrollment?" data-action="proceedToEnrolled"> Proceed </a>
                        `;
                            break;

                        default:
                            dropdownContent = `<p>No actions available</p>`;
                            break;
                    }

                    row.innerHTML = `
                    <td>${enr.student.studentDisplayId}</td>
                    <td>${enr.student.firstName} ${enr.student.middleName} ${enr.student.lastName}</td>
                    <td>${enr.student.currentGradeSection === null ? "NONE" : enr.student.currentGradeSection?.level?.levelName || "N/A"}</td>
                    <td>${enr.student.new ? 'New Student' : 'Old Student'}</td>
                    <td>
                        <div class="dropdown">
                            <div class="status-container">
                                <div class="status" id="status-registration">${enr.enrollmentStatus}</div>
                                <button class="dropdown-status-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="dropdown-status-content" id="dropdown-listing">
                                ${dropdownContent}
                            </div>
                        </div>
                    </td>
                `;

                    tableBody.appendChild(row);
                });

                // ✅ Event Listener for "View Record", "Proceed", etc.
                document.addEventListener("click", function (event) {
                    const target = event.target;
                    const enrollmentId = target.getAttribute("data-enrollment-id");

                    if (target.classList.contains("viewRecordButton")) {
                        console.log(`🔍 View Record for Enrollment ID: ${enrollmentId}`);
                        openModal("studentInformationModal");
                    }

                    if (target.classList.contains("proceedButton")) {
                        const modalId = target.getAttribute("data-open-modal");
                        console.log(`🚀 Proceeding with Enrollment ID: ${enrollmentId}`);
                        openModal(modalId);
                    }

                    if (target.classList.contains("viewGradesButton")) {
                        console.log(`📄 Viewing Grades for Enrollment ID: ${enrollmentId}`);
                        openModal("viewGradesModal");
                    }

                    if (target.classList.contains("viewPaymentsButton")) {
                        console.log(`💰 Viewing Payments for Enrollment ID: ${enrollmentId}`);
                        openModal("listOfPaymentsModal");
                    }
                });
            })
            .catch(error => console.error("Error:", error));
    }

    // ✅ Utility Function to Open Modals
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add("show");
            modal.style.visibility = "visible";
            modal.style.opacity = "1";
            modal.style.pointerEvents = "auto";
        }
    }

    // Handle Proceed Button Click (Attach to Modal)
    document.addEventListener("click", function (event) {
        const proceedButton = event.target.closest('[data-open-modal="addGradeLevelAssessmentModal"]');

        if (proceedButton) {
            const gradeLevel = proceedButton.getAttribute("data-grade-level-id");
            if (!gradeLevel) return console.error("Grade level not found for section selection");

            console.log("Grade Level Selected:", gradeLevel);

            // Set grade level in modal input field
            const gradeLevelInput = document.querySelector("#grade-level");
            if (gradeLevelInput) {
                gradeLevelInput.value = gradeLevel;
            }

            // Populate sections dropdown
            fetchSections(gradeLevel);
        }
    });

    let enrollmentIdLet = null;
    // Ensure the event listener is added only once when the page loads
    document.addEventListener("click", function (event) {
        const proceedToEnrolledButton = event.target.closest("#proceed-btn"); // Check if the clicked element is the button

        if (proceedToEnrolledButton) {
            console.log("📌 Proceed button clicked!");

            // Retrieve enrollment ID from the button's data attribute
            const enrollmentIdElement = proceedToEnrolledButton.getAttribute("data-enrollment-id");

            if (enrollmentIdElement) {
                enrollmentIdLet = enrollmentIdElement.trim(); // No need for textContent
                console.log("📌 Captured Enrollment ID:", enrollmentIdLet);
            } else {
                alert("⚠️ Enrollment ID not found.");
            }
        }
    });

    // Fetch sections based on selected grade level
    function fetchSections(gradeLevel) {
        fetch(`/section/gradeLevel/${gradeLevel}`)
            .then(res => res.json())
            .then(sections => {
                const selectTag = document.querySelector("#section"); // Modal select tag
                if (!selectTag) return console.error("Dropdown for sections not found");

                selectTag.innerHTML = `<option value="">Select Section</option>`; // Default option

                sections.forEach(section => {
                    const option = document.createElement("option");
                    option.value = section.number;
                    option.textContent = section.sectionName;
                    selectTag.appendChild(option);
                });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }

    document.addEventListener("click", async function (event) {
        const addButton = event.target.closest('.add-payment-btn');

        if (addButton) {
            // Retrieve student information
            const studentName = document.querySelector("#student-name")?.textContent?.trim();
            const studentId = document.querySelector("#student-id")?.textContent?.trim();

            if (!studentName || !studentId) {
                console.error("Student information not found");
                return;
            }

            // Populate modal fields
            document.querySelector("#payee-name").value = studentName;
            document.querySelector("#addPaymentModal input[type='number'][readonly]").value = studentId;

            // Fetch and populate the current active school year
            try {
                let response = await fetch("/semester/currentactive");
                if (!response.ok) throw new Error("Failed to fetch active school year");

                let data = await response.json();

                // Get input elements
                let semesterInput = document.getElementById("semester");
                let schoolYearInput = document.getElementById("school-year");

                if (semesterInput) {
                    semesterInput.value = data.sem;
                } else {
                    console.error("Semester input field not found in the modal");
                }

                if (schoolYearInput) {
                    schoolYearInput.value = data.schoolYear.schoolYear;
                    console.log("Fetched School Year:", data.schoolYear.schoolYear);
                    console.log("Fetched Semester:", data.sem);
                } else {
                    console.error("School year input field not found in the modal");
                }
            } catch (error) {
                console.error("Error fetching current active school year:", error);
            }

            try {
                let response = await fetch("/payments/all");
                if (!response.ok) throw new Error("Failed to fetch required payments");

                let data = await response.json();

                let paymentList = document.getElementById("payment-list");
                if (!paymentList) {
                    console.error("Payment list dropdown not found");
                    return;
                }

                // Clear existing options (except the placeholder)
                paymentList.innerHTML = '<option value="" disabled selected>Choose</option>';

                Object.values(data).forEach(payment => {
                    let option = document.createElement("option");
                    option.value = payment.id;
                    option.textContent = payment.name;
                    paymentList.appendChild(option);
                });

                console.log("Fetched Payment List:", data);
            } catch (error) {
                console.error("Error fetching payment list:", error);
            }
        }
    });



</script>

</html>