<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Furqan Islamic Institute Incorporated</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0//css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Font Awesome for icons -->
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script type="text/javascript" th:src="@{/js/publicip.js}"></script>
</head>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let savedSubmenus = JSON.parse(localStorage.getItem("openedSubmenus")) || [];

        savedSubmenus.forEach(submenuId => {
            let submenu = document.getElementById(submenuId);
            if (submenu) {
                submenu.classList.add("open");

                // Make sure parent menus are also opened
                let parentMenu = submenu.closest(".submenu");
                if (parentMenu) {
                    parentMenu.classList.add("open");
                }

                // Update arrow icon
                let arrowIconImg = submenu.previousElementSibling?.querySelector(".arrow-icon img");
                if (arrowIconImg) {
                    arrowIconImg.src = "/images/icons/greater-than.png";
                }
            }
        });
    });
</script>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="text-center">
            <div class="school-logo">
                <img th:src="@{/images/al-furqanlogo.jpg}" alt="School Logo">
            </div> <br>
            <p th:if="${currentSY != 'NOT FOUND' and currentSem != 'NOT FOUND'}"
                th:text="|S.Y ${currentSY} - ${currentSem} Sem|" class="mt-2">
            </p> <br>
            <div class="welcome-div">
                <p>
                    Welcome,
                    <span class="account-text" th:text="|${userFirstName} (${userRole})|"></span>
                </p>

            </div>
        </div>

        <a href="/home" class="sidebar-icons menu" onclick="clearSubmenus()">
            <img th:src="@{/images/icons/dashboard_icon.png}" alt="Dashboard Icon"> Dashboard
        </a>

        <a href="#" class="active sidebar-icons" onclick="toggleSubMenu('enrollment-submenu', event)">
            <img th:src="@{/images/icons/enrollment.png}" alt="Enrollment Icon"> Enrollment
            <span class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="enrollment-submenu">
            <a href="/enrollment/listing" class="second-active">Listing/Register</a>
            <a href="/enrollment/assessment">Assessment</a>
            <a href="/enrollment/payment">Payment</a>
            <a href="/enrollment/enrolled">Enrolled</a>
        </div>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('transaction-submenu', event)">
            <img th:src="@{/images/icons/transaction_icon.png}" alt="Transaction Icon"> Transaction
            <span class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="transaction-submenu">
            <a href="/transaction/tuition">Tuition</a>
            <a href="/transaction/academic-resources">Book Distribution</a>
        </div>


        <a href="/grade-management" class="sidebar-icons">
            <img th:src="@{/images/icons/data-entry_icon.png}" alt="Grade Icon"> Grade Management
        </a>

        <a href="/schedule" class="sidebar-icons">
            <img th:src="@{/images/icons/schedule.png}" alt="Schedule Icon"> Schedule
        </a>

        <a href="/class-list" class="sidebar-icons">
            <img th:src="@{/images/icons/persons-in-a-class.png}" alt="Class List Icon"> Class List
        </a>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('maintenance-submenu', event)">
            <img th:src="@{/images/icons/maintenance_icon.png}" alt="Maintenance Icon"> Maintenance <span
                class="arrow-icon"><img th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="maintenance-submenu">
            <a href="/maintenance/school-year">School Year</a>
            <a href="/maintenance/grade-level">Grade Level</a>
            <a href="/maintenance/subject">Subject</a>
            <a href="/maintenance/section">Section</a>
            <a href="/maintenance/fees-management">Fees Management</a>
            <!-- <a href="/maintenance/teacher">Teacher</a> -->
        </div>

        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('reports-submenu', event)">
            <img th:src="@{/images/icons/reports_icon.png}" alt="Reports Icon"> Reports <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="reports-submenu">
            <a href="/reports/student">Student Reports</a>
            <a href="/reports/payment">Payment Reports</a>
            <a href="/reports/teacher">Teacher Report</a>
            <a href="/reports/academic-resources">Book Distribution Reports</a>
        </div>
        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('account-submenu', event)">
            <img th:src="@{/images/icons/account.png}" alt="Account Icon"> Account <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="account-submenu">
            <a href="/accounts/verify-accounts">Verify Accounts</a>
            <a href="/accounts/manage-accounts">Manage Accounts</a>
            <a href="/accounts/my-account">My Account</a>
        </div>
        <a href="#" class="sidebar-icons" onclick="toggleSubMenu('settings-submenu', event)">
            <img th:src="@{/images/icons/settings.png}" alt="Reports Icon"> Settings <span class="arrow-icon"><img
                    th:src="@{/images/icons/arrow-down.png}" alt="arrow-down"></span>
        </a>
        <div class="submenu" id="settings-submenu">
            <a href="/settings/create-user">Create User</a>
        </div>
    </div>

    <!-- Topbar with Hamburger & User Icon -->
    <div class="dashboard-container" id="content">
        <div class="topbar">
            <div class="main-topbar">
                <span class="hamburger" onclick="toggleSidebar()">
                    <img th:src="@{/images/icons/burger_menu_icon.png}" alt="Menu">
                </span>

                <span class="institute-name">AL-FURQAN ISLAMIC INSTITUTE INCORPORATED</span>
            </div>
            <div class="dropdown-logout">
                <div class="user-icon dropdown-logout-toggle">
                    <img th:src="@{/images/icons/account.png}" onclick="toggleDropdown('dropdownUserIcon')"
                        alt="User Icon">
                    <div id="dropdownUserIcon" class="dropdown-logout-content">
                        <h6><span th:text="(${userRole})"></span></h6>
                        <a href="/logout">Log Out</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-link">
            <h4>Listing/Register</h4>
            <p>Main</p>
            <p>/</p>
            <p>Transaction</p>
            <p>/</p>
            <p>Enrollment</p>
            <p>/</p>
            <p>Listing/Register</p>
        </div>


        <div class="search-div">
            <!-- Searchbox and sort btn -->
            <div class="search">
                <div class="search-container">
                    <input type="text" id="search-stud" placeholder="Search..." class="search-input" />
                    <button onclick="goList(1,1)" class="search-btn">Search</button>
                </div>

                <!-- Enrollment Buttons -->
                <div class="enrollment-buttons">
                    <button class="new-student" data-open-modal="newStudentModal">NEW STUDENT</button>
                </div>

                <div class="sort-container">
                    <select title="sort" name="sort" onchange="goList(1,1)" id="sort-select" class="sort-select">
                        <option value="All" selected>All</option>
                        <option value="Listing">Listing</option>
                        <option value="Assessment">Assessment</option>
                        <option value="Payment">Payment</option>
                        <option value="Enrolled">Enrolled</option>
                        <option value="Not_registered">Wala sa listing</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Table -->
        <table id="lamesa" class="listing-table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Student Name</th>
                    <th>Enrolling to</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <div class="dropdown">
                            <div class="status-container">
                                <div class="status" id="status-registration"></div>
                                <button class="dropdown-status-btn">
                                    <i class="fas fa-chevron-down"></i> <!-- Icon is the button -->
                                </button>
                            </div>
                            <div class="dropdown-status-content" id="dropdown-listing">
                                <a href="#" data-action="listingAddGradeLevel"
                                    data-open-modal="gradeLevelModal">Proceed</a>
                                <a href="#" data-action="cancelRegistration" data-open-modal="confirmationModal"
                                    data-message="Are you sure you want to cancel this registration?">Cancel
                                    Registration</a>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-container">
            <div id="pagination" class="pagination">
                <button id="prevPage" disabled>&laquo;</button>
                <div id="pageNumbers"></div>
                <button id="nextPage">&raquo;</button>
            </div>
        </div>



        <!-- Modal for student information -->
        <div id="studentInformationModal" class="student-information-modal modal">
            <div class="student-information-modal-content">
                <h1>Student Information</h1>
                <form method="" action="" id="studentInformationForm">
                    <div class="header">
                        <div class="half-unique">
                            <label for="student-id">Student ID: </label>
                            <input type="text" id="student-id">
                        </div> <br>

                        <div style="display: flex; gap: 50px;">
                            <div class="half-unique" id="stud-type-row">
                                <label for="type">Student Type:</label>
                                <h6>New</h6>
                            </div>

                            <div class="half-unique" id="scholar-row">
                                <label for="type">Scholar:</label>
                                <h6>Yes</h6>
                            </div>
                        </div>


                    </div>


                    <div style="display: flex; align-content: center; justify-items: left;">
                        <h2>Personal Information</h2>
                    </div>

                    <div class="container">
                        <div class="row">
                            <div class="column1">
                                <div>
                                    <label for="name">Name</label>
                                    <div class="student-form-group half">
                                        <input type="text" id="firstName">
                                        <input type="text" id="middleName">
                                        <input type="text" id="lastName">
                                    </div>
                                    <div class="small-text">
                                        <p>First</p>
                                        <p>Middle</p>
                                        <p>Last</p>
                                    </div>
                                </div>
                            </div>
                            <div class="column2">
                                <!-- Gender, BDate, and Scholar -->
                                <div class="student-form-group half-stud-info-small" style="margin-bottom: 0px;">
                                    <label for="gender">Gender:</label>
                                    <input type="text" id="gender" style="width: 80px;">

                                    <label for="birthdate">Birthdate:</label>
                                    <input type="date" id="birthdate" readonly style="width: 120px;">
                                </div>
                            </div>

                            <div class="student-form-group">
                                <div>
                                    <label for="address">Address:</label>
                                    <div class="student-form-group half-unique">
                                        <input type="text" id="street" required placeholder="Street">
                                        <input type="text" id="barangay" required placeholder="Barangay">
                                        <input type="text" id="city" required placeholder="City">
                                    </div>
                                </div>

                                <div>
                                    <label>Place of Birth:</label>
                                    <div class="student-form-group">
                                        <input type="text" id="placeOfBirth" class="place-of-birth"
                                            style="width: 390px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                        <h2>Additional Information</h2>
                    </div>

                    <div>
                        <h6>Father's Information</h6>
                        <div class="student-form-group">
                            <label for="fatherName">Name:</label>
                            <input type="text" id="fatherName">

                            <label for="fatherOccupation">Occupation:</label>
                            <input type="text" id="fatherOccupation">
                        </div> <br>
                    </div>
                    <div>
                        <h6>Mother's Information</h6>
                        <div class="student-form-group">
                            <label for="motherName">Name:</label>
                            <input type="text" id="motherName">

                            <label for="motherOccupation">Occupation:</label>
                            <input type="text" id="motherOccupation">
                        </div> <br>
                    </div>

                    <h6>Guardian's Information</h6>
                    <div class="student-form-group">
                        <label for="guardianName">Name:</label>
                        <input type="text" id="guardianName">

                        <label for="guardianOccupation">Occupation:</label>
                        <input type="text" id="guardianOccupation">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="guardianContactNumber">Contact Number:</label>
                        <input type="text" id="guardianContactNumber" style="width: 385px;">

                        <label for="guardianAddress">Address:</label>
                        <input type="text" id="guardianAddress" style="width: 355px;">
                    </div> <br>

                    <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                        <h2>For Transferees Only</h2>
                    </div>

                    <div class="student-form-group">
                        <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                        <input type="text" id="lastGradeLevelCompleted">

                        <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed</label>
                        <input type="text" id="lastMadrasaYearCompleted">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                        <input type="text" id="madrasaNameLastAttended">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="madrasaAddress">Madrasa Address:</label>
                        <input type="text" id="madrasaAddress">
                    </div> <br>

                    <div style="display: flex; gap: 365px;">
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Financial Information</h2>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Book Distribution</h2>
                        </div>
                    </div>

                    <div class="container-two">
                        <div class="column-main">
                            <p>Recent Transactions</p>
                            <div class="table-container">
                                <table class="mini-table" id="payment-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Book</td>
                                            <td><span>P</span>2,000</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="status-payments">Unpaid</div>
                                                </div>
                                            </td>
                                            <td>February 12, 2025</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin: 0px;">
                                <div style="display: flex; gap: 10px;">
                                    <h6>Balance:</h6>
                                    <h6>1, 000</h6>
                                </div>
                                <button id="transaction-record-btn">View Record</button>
                            </div>

                        </div>

                        <div class="column-main">
                            <p>Recent Distributions</p>
                            <div class="table-container">
                                <table class="mini-table" id="distribution-table">
                                    <thead>
                                        <tr>
                                            <th>Grade Level</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Grade 1</td>
                                            <td>February 12, 2025</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="status-distribution">Completed</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> <br>

                    <div>
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Grades</h2>
                        </div>
                    </div>

                    <div class="container-two">
                        <div class="column-main">
                            <div class="table-container">
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="display: flex; gap: 8px;">
                                        <label>School Year:</label>
                                        <h6 id="sy">2025-2026</h6>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <label>Semester:</label>
                                        <h6 id="sem">1st Semester</h6>
                                    </div>
                                </div>
                                <table class="mini-table" id="grades-table">
                                    <thead>
                                        <tr>
                                            <th>Subject</th>
                                            <th>Grade</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr>
                                            <td>English</td>
                                            <td>78</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="grade-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr id="average-row">
                                            <td>Average</td>
                                            <td>90</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="average-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="column-main">
                            <div class="table-container">
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="display: flex; gap: 8px;">
                                        <label>School Year:</label>
                                        <h6 id="sy">2025-2026</h6>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <label>Semester:</label>
                                        <h6 id="sem">1st Semester</h6>
                                    </div>
                                </div>
                                <table class="mini-table" id="grades-table">
                                    <thead>
                                        <tr>
                                            <th>Subject</th>
                                            <th>Grade</th>
                                            <th>Remarks</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr>
                                            <td>English</td>
                                            <td>78</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="grade-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr id="average-row">
                                            <td>Average</td>
                                            <td>90</td>
                                            <td>
                                                <div class="status-container">
                                                    <div class="status" id="average-remarks">Pass</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn-cancel"
                            data-close-modal="studentInformationModal">Close</button>
                    </div>
            </div>
            </form>
        </div>
    </div>

    <!-- Modal for confirmation -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <p id="modalText"></p>
            <div class="modal-buttons">
                <button id="confirmAction" class="btn-confirm">Confirm</button>
                <button class="btn-close-confirm" data-close-modal="confirmationModal">Cancel</button>
            </div>
        </div>
    </div>


    <!-- Modal for adding a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="addGradeLevelAssessmentModal">&times;</span>

            <h2>Promote To</h2>

            <label for="grade-level">Grade Level:</label>
            <input type="text" id="grade-level" readonly>

            <label for="section">Section:</label>
            <select name="section" id="section">
                <option value="" disabled selected>Choose</option>
            </select>


            <div class="modal-buttons">
                <button type="button" class="btn-confirm" data-action="proceedToPayment"
                    data-message="Are you sure you want to proceed with payment?" id=""
                    data-open-modal="confirmationModal">
                    Confirm
                </button>
                <button type="button" class="btn-cancel" data-close-modal="addGradeLevelAssessmentModal">Cancel</button>
            </div>
        </div>
    </div>
  
    <!-- Modal for listOfPaymentsModal -->
    <div id="listOfPaymentsModal" class="list-of-payments-modal modal">
        <div class="list-of-payments-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="listOfPaymentsModal">&times;</span>

            <h2>List of Payments</h2>

            <div class="half-width">
                <label for="student-id-list">Student ID:</label>
                <h6 id="student-id-list"></h6>
            </div>
            <div class="half-width">
                <label for="student-name">Student Name:</label>
                <h6 id="student-name"></h6>
            </div> <br>

            <!-- List of Payments Table -->
            <table id="table-ni-kharl" class="view-list-of-payments-table">
                <thead>
                <tr>
                    <th>Type</th>
                    <th>Req. Amount</th>
                    <th>Amount Paid</th>
                    <th>Balance</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

            <!-- Add Payment button -->
            <div class="action" id="add-payment-btn">
                <button type="button" id="open-add-payment-modal" data-open-modal="addPaymentModal">Add
                    Payment</button>
            </div>

        </div>
    </div>


    <!-- Modal for listing add grade level -->
    <div id="gradeLevelModal" class="grade-level-modal modal">
        <div class="grade-level-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="gradeLevelModal">&times;</span>

            <h2>Enroll To</h2>
            <form method="post" action="/gradelevelmaintenance/add" id="gradeLevelForm">
                <label for="levelName">Grade Level Name:</label>
                <select name="levelName" id="levelName">
                    <option value="" disabled>Choose a Grade Level</option>
                </select>
                <br><br>
                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" data-action="proceedAssessment"
                        data-message="Are you sure you want to proceed this registration from Listing to Assessment?"
                        id="confirmGradeLevel" data-open-modal="confirmationModal">
                        Confirm
                    </button>
                    <button type="button" class="btn-cancel" data-close-modal="gradeLevelModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content">
            <p id="errorMessage"></p>
            <div class="modal-buttons">
                <button class="error-btn-cancel" data-close-modal="errorModal">Close</button>
            </div>
        </div>
    </div>

    <!-- Background overlay -->
    <div id="successModalOverlay"></div>

    <!-- Success modal -->
    <div id="successModal">
        <p id="successModalMessage"></p>
    </div>


    <!-- Modal for adding a a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="addGradeLevelAssessmentModal">&times;</span>

            <h2>Promote To</h2>

            <label for="grade-level">Grade Level:</label>
            <input type="text" id="grade-level" readonly>

            <label for="section">Section:</label>
            <select name="section" id="section">
                <option value="" disabled selected>Choose</option>
            </select>


            <div class="modal-buttons">
                <button type="button" class="btn-confirm" data-action="proceedToPayment"
                    data-message="Are you sure you want to proceed with payment?" id=""
                    data-open-modal="confirmationModal">
                    Confirm
                </button>
                <button type="button" class="btn-cancel" data-close-modal="addGradeLevelAssessmentModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing grades -->
    <div id="viewGradesModal" class="view-grades-modal modal">
        <div class="view-grades-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="viewGradesModal">&times;</span>

            <h2>Student Grades</h2>

            <div class="half-width" id="view-grade-studId">
                <label for="student-grade-id">Student ID:</label>
                <h6 id="student-grade-id"></h6>
            </div>
            <div class="half-width" id="view-grade-studName">
                <label for="student-grade-name">Student Name:</label>
                <h6 id="student-grade-name">Martin Francisco</h6>
            </div> <br>

            <!-- Grades Table -->
            <table id="lamesaa" class="view-grades-table">
                <thead>
                    <tr>
                        <th>Subject ID</th>
                        <th>Subject</th>
                        <th>Grade</th>
                        <th>Remarks</th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td>001</td>
                        <td>English</td>
                        <td>78</td>
                        <td>
                            <div class="status-container">
                                <div class="status" id="grade-remarks">Pass</div>
                            </div>
                        </td>
                    </tr>

                    <tr id="average-row">
                        <td colspan="2">Average</td>
                        <td>90</td>
                        <td>
                            <div class="status-container">
                                <div class="status" id="average-remarks">Pass</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- <div class="half-width" id="view-grade-average">
                <label for="grade-average">Final Average:</label>
                <input type="text" id="average-input" readonly value="90">
            </div>
            
            <div class="half-width" id="view-grade-remarks">
                <label for="grade-average">Remarks:</label>
                <div class="status-container">
                    <div class="status" id="grade-remarks">Pass</div>
                </div>  
            </div> -->

            <!-- Close button -->
            <div class="close-button" id="view-grades-close-btn">
                <button type="button" data-close-modal="viewGradesModal" class="btn-cancel"
                    id="close-button">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for new student enrollment -->
    <div id="newStudentModal" class="student-modal modal">
        <div class="student-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="newStudentModal">&times;</span>

            <h2>Student Information</h2>
            <form id="studentForm">
                <div class="header">
                    <h5>Personal Information</h5>
                </div>

                <div class="student-form-group">
                    <label for="studentFirstName">First Name:</label>
                    <input type="text" name="firstname" id="studentFirstName" required>

                    <label for="studentLastName">Last Name:</label>
                    <input type="text" name="lastname" id="studentLastName" required>

                    <label for="studentMiddleName">Middle Name:</label>
                    <input type="text" name="middlename" id="studentMiddleName" placeholder="Optional">
                </div> <br>

                <div class="student-form-group">
                    <label for="gender">Gender:</label>
                    <select id="studgender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                    </select>

                    <label for="birthdate">Birthdate:</label>
                    <input type="date" id="studbirthdate" required>

                    <div class="checkbox">
                        <label for="scholar">Scholar:</label>
                        <input type="checkbox" id="scholar">
                    </div>

                </div> <br>


                <div class="student-form-group">
                    <label>Place of Birth:</label>
                    <input type="text" id="studplaceOfBirth" class="place-of-birth">
                </div> <br>

                <div>
                    <label for="studaddress">Address:</label>
                    <div id="studaddress" class="student-form-group">
                        <input type="text" id="studstreet" required placeholder="Street">
                        <input type="text" id="studbarangay" required placeholder="Barangay">
                        <input type="text" id="studcity" required placeholder="City">
                    </div>

                </div> <br> <br>

                <h5>Parent's/Guardian's Information</h5>

                <h6>Father's Information</h6>
                <div class="student-form-group">
                    <label for="studfatherName">Name:</label>
                    <input type="text" name="fatherName" id="studfatherName" required>

                    <label for="studfatherOccupation">Occupation:</label>
                    <input type="text" id="studfatherOccupation">
                </div> <br>

                <h6>Mother's Information</h6>
                <div class="student-form-group">
                    <label for="studmotherName">Name:</label>
                    <input type="text" id="studmotherName" required>

                    <label for="studmotherOccupation">Occupation:</label>
                    <input type="text" id="studmotherOccupation">
                </div> <br>

                <h6>Guardian's Information</h6>
                <div class="student-form-group">
                    <label for="studguardianName">Name:</label>
                    <input type="text" id="studguardianName">

                    <label for="studguardianOccupation">Occupation:</label>
                    <input type="text" id="studguardianOccupation">
                </div> <br>

                <div class="student-form-group">
                    <label for="studguardianContactNumber">Contact Number:</label>
                    <input type="text" id="studguardianContactNumber">

                    <label for="studguardianAddress">Address:</label>
                    <input type="text" id="studguardianAddress">
                </div> <br>

                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" id="confirmStudent" data-action="studAddListing"
                        data-open-modal="confirmationModal"
                        data-message="Are you sure you want to add this new student?">Confirm</button>
                    <button type="button" class="btn-cancel" id="cancelStudent"
                        data-close-modal="newStudentModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for transferee enrollment -->
    <div id="transfereeStudentModal" class="student-modal modal">
        <div class="student-modal-content">
            <!-- Close Button -->
            <span class="close-modal" data-close-modal="feesManagementModal">&times;</span>

            <h2>Student Information</h2>
            <form id="studentFormTransferee">
                <div class="header">
                    <h5>Personal Information</h5>
                </div>

                <div class="student-form-group">
                    <label for="studentFirstName">First Name:</label>
                    <input type="text" id="transfereestudentFirstName" required>

                    <label for="studentLastName">Last Name:</label>
                    <input type="text" id="transfereestudentLastName" required>

                    <label for="studentMiddleName">Middle Name:</label>
                    <input type="text" id="transfereestudentMiddleName" placeholder="Optional">
                </div> <br>

                <div class="student-form-group half">
                    <label for="gender">Gender:</label>
                    <select id="transfereegender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option value="MALE">Male</option>
                        <option value="FEMALE">Female</option>
                    </select>

                    <label for="birthdate">Birthdate:</label>
                    <input type="date" id="transfereebirthdate" required>
                </div> <br>

                <div class="student-form-group">
                    <label>Place of Birth:</label>
                    <input type="text" id="transfereeplaceOfBirth" class="place-of-birth">
                </div> <br>

                <div>
                    <label for="address">Address:</label>
                    <div class="student-form-group">
                        <input type="text" id="transfereestreet" required placeholder="Street">
                        <input type="text" id="transfereebarangay" required placeholder="Barangay">
                        <input type="text" id="transfereecity" required placeholder="City">
                    </div>
                </div> <br> <br>

                <h5>Parent's/Guardian's Information</h5>

                <h6>Father's Information</h6>
                <div class="student-form-group">
                    <label for="fatherName">Name:</label>
                    <input type="text" id="transfereefatherName" required>

                    <label for="fatherOccupation">Occupation:</label>
                    <input type="text" id="transfereefatherOccupation">
                </div> <br>

                <h6>Mother's Information</h6>
                <div class="student-form-group">
                    <label for="motherName">Name:</label>
                    <input type="text" id="transfereemotherName" required>

                    <label for="motherOccupation">Occupation:</label>
                    <input type="text" id="transfereemotherOccupation">
                </div> <br>

                <h6>Guardian's Information</h6>
                <div class="student-form-group">
                    <label for="guardianName">Name:</label>
                    <input type="text" id="transfereeguardianName">

                    <label for="guardianOccupation">Occupation:</label>
                    <input type="text" id="transfereeguardianOccupation">
                </div> <br>

                <div class="student-form-group">
                    <label for="guardianContactNumber">Contact Number:</label>
                    <input type="text" id="transfereeguardianContactNumber">

                    <label for="guardianAddress">Address:</label>
                    <input type="text" id="transfereeguardianAddress">
                </div> <br>

                <h5>For Transferees Only</h5>

                <div class="student-form-group">
                    <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                    <input type="text" id="lastGradeLevelCompleted">

                    <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed</label>
                    <input type="text" id="lastMadrasaYearCompleted">
                </div> <br>

                <div class="student-form-group">
                    <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                    <input type="text" id="madrasaNameLastAttended">
                </div> <br>

                <div class="student-form-group">
                    <label for="madrasaAddress">Madrasa Address:</label>
                    <input type="text" id="madrasaAddress" style="width: 900px;">
                </div> <br>

                <div class="modal-buttons">
                    <button type="button" class="btn-confirm" id="confirmStudent" data-open-modal="confirmationModal"
                        data-action="transfereeAddListing"
                        data-message="Are you sure you want to add this new student?">Confirm</button>
                    <button type="button" class="btn-cancel" id="cancelStudent"
                        data-close-modal="transfereeStudentModal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="receipt-modal modal">
        <div class="printable-area">
            <div class="receipt-modal-content">
                <!-- Close Button -->
                <span class="close-modal" data-close-modal="receiptModal">&times;</span>

                <!-- Receipt Header -->
                <div class="header-container-payment">
                    <div class="left-header">
                        <img src="/images/al-furqanlogo.jpg" alt="School Logo" class="school-logo-payment">
                        <div class="school-info">
                            <h3>AL-FURQAN ISLAMIC INSTITUTE INCORPORATED</h3>
                            <p>Talabaan, Zamboanga City</p>
                            <p>Phone #: 09358268263</p>
                        </div>
                    </div>

                    <div class="right-header">
                        <div class="receipt-box">
                            <h2>RECEIPT</h2>
                        </div>
                        <p>Semester & SY: <strong>1ST SEM | 2021-2022</strong></p>
                    </div>
                </div>

                <div class="separator-line"></div>

                <!-- Student Info -->
                <div class="student-info-container">
                    <div class="payment-student-info-container">
                        <div class="half-width">
                            <label id="receipt-student-id-label">Student ID:</label>
                            <input type="text" id="receipt-student-id" readonly>
                        </div>

                        <div class="half-width">
                            <label>Date:</label>
                            <input type="date" id="receipt-date" readonly>
                        </div>
                    </div>
                    <div class="payment-student-info-container">
                        <div class="half-width">
                            <label id="receipt-student-name-label">Student Name:</label>
                            <input type="text" id="receipt-student-name" readonly>
                        </div>

                        <div class="half-width">
                            <label id="receipt-number-label">Receipt Number:</label>
                            <input type="text" id="receipt-number" readonly>
                        </div>
                    </div>
                </div>

                <div id="receipt-table" class="receipt-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ITEM #</th>
                                <th>DESCRIPTION</th>
                                <th>AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody id="receipt-items">
                            <tr>
                                <td>1</td>
                                <td>Tuition Fee</td>
                                <td>1,000.00</td>
                                <td>-200.00</td>
                                <td>800.00</td>
                            </tr>
                            <!-- Additional rows will be inserted dynamically if needed -->
                        </tbody>
                    </table>
                </div>

                <!-- Total Amount -->
                <div class="total-container">
                    <p>Total Amount Due: <strong>₱ 800.00</strong></p>
                </div>

                <!-- Collected By Section -->
                <div id="staff-receiver" class="collector-info-container">
                    <h6>Received/Collected By:</h6>
                    <div class="collector-name-container">
                        <input th:value="${userFullName}" type="text" readonly id="collector-name">
                        <p id="position" th:text="${userRole}">Enrollment Staff</p>
                    </div>
                </div>

                <!-- Print Button -->
                <div class="modal-buttons">
                    <button onclick="printReceipt()" class="print-btn">PRINT RECEIPT</button>
                </div>
            </div>
        </div>
    </div>

    
        <!-- Modal for addPaymentModal-->
        <div id="addPaymentModal" class="add-payment-modal modal">
            <div class="printable-area">
                <div class="add-payment-modal-content">
                    <!-- Close Button -->
                    <span class="close-modal" data-close-modal="addPaymentModal">&times;</span>
                    <div class="header-container">
                        <h3>Payment Form</h3>
                    </div> <br>

                    <div class="payee-info-container" id="payee-info">
                        <div class="half-width half-payee">
                            <div>
                                <label for="student-id" id="label-id">Student ID:</label>
                                <input type="text" id="payee-id" readonly>
                            </div>
                            <div>
                                <label for="Date">Date:</label>
                                <input type="date" id="date">
                            </div>
                        </div>

                        <div class="full-width">
                            <label for="payee-name">Student Name:</label>
                            <input type="text" id="payee-name" readonly>
                        </div>
                        <div class="half-width half-payee">
                            <div>
                                <label for="semester" id="label-sem">Semester:</label>
                                <input th:value="${currentSem}" type="text" id="semester" readonly>
                            </div>
                            <div>
                                <label for="school-year">S.Y.</label>
                                <input th:value="${currentSY}" type="text" id="school-year" readonly>
                            </div>
                        </div>
                        <div class="full-width amount-container">
                            <label for="amount" id="label-amount">Amount:</label>
                            <div class="input-wrapper">
                                <span class="currency-symbol">₱</span>
                                <input type="number" max="0" id="payment-amount" placeholder="0.00">
                            </div>
                        </div>
                    </div>
                    <div class="payment-wrapper">
                        <h6>Payment For:</h6>
                        <div class="payment-container-group">
                            <div class="payment-item">
                                <input type="checkbox" id="" name="payment" value="payment">
                                <label for="payment">Book</label>
                            </div>
                            <div class="payment-item">
                                <input type="checkbox" id="" name="payment" value="payment">
                                <label for="payment">Book</label>
                            </div>
                            <div class="payment-item">
                                <input type="checkbox" id="" name="payment" value="payment">
                                <label for="payment">Book</label>
                            </div>
                            <div class="payment-item">
                                <input type="checkbox" id="" name="payment" value="payment">
                                <label for="payment">Book</label>
                            </div>
                        </div> <br>
                    </div>


                    <div id="staff-receiver" class="collector-info-container">
                        <h6>Received/Collected By:</h6>
                        <div class="collector-name-container">
                            <input th:value="${userFullName}" type="text" readonly id="collector-name">
                            <p id="position" th:text="${userRole}">Enrollment Staff</p>
                        </div>
                    </div>


                    <div class="modal-buttons payment-modal-buttons">
                        <button class="no-print" onclick="printReport()">Print Report</button>

                        <button id="save-payment-btn" class="btn-confirm no-print" type="button"
                            data-open-modal="confirmationModal" data-action="savePayment"
                            data-message="Are you sure you want to save this payment?">Save Payment
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <script th:src="@{/js/script.js}"></script>
</body>

<script>

    function proceedToPayment(enrollmentIdLet, sectionNumberLet) {
        sectionNumberLet = document.querySelector("#section").value;
        if (!sectionNumberLet || sectionNumberLet === "") {
            showErrorModal("❌ Error: Please select a section!");
            return;
        }

        const apiUrl = `/enrollment/add/payment/${enrollmentIdLet}/${sectionNumberLet}`;
        console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status })))
            .then(({ text, status }) => {
                console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
// <!--                    showSuccessModal("✅ Success: New student has been added successfully!");-->
// <!--                    location.reload(); // Reloads the page-->
                        goList(currentPageNo, currentPageSize);
                } else {
                    showErrorModal("❌ Error:" + text);
                }
            })
            .catch(error => {
                showErrorModal("❌ Error: Transaction failed. Please try again!");
            });
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            if (event.target.closest(".proceedButton")) {
                event.preventDefault(); // Prevent default link behavior

                // Get Enrollment ID from the button
                enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id");

                // Get the selected section number value
                sectionNumberLet = document.querySelector("#section").value;

                console.log("Enrollment ID:", enrollmentIdLet);
                console.log("Selected Section:", sectionNumberLet);
            }
        });
    });

    function getPaymentStatusClass(status) {
        status = status.toLowerCase();
        if (status === "fully paid") {
            return "paid-status";
        } else if (status === "unpaid") {
            return "unpaid-status";
        } else if (status === "partially paid") {
            return "partially-paid-status"
        }
        return "";
    }

    var payerId = 0;
    function fetchPayments(enrollmentId) {
        fetch(`/enrollment/paymentView/${enrollmentId}`)
            .then(res => res.json())
            .then(epv => {
                console.log('The object is', epv);
                const studentname = document.querySelector("#student-name");
                const studentId = document.querySelector("#student-id-list");
                if (!studentname || !studentId) return console.error("Dropdown for sections not found");

                studentname.textContent = epv.studentFirstName + (epv.studentMiddleName ? ' ' + epv.studentMiddleName : '') + ' ' + epv.studentLastName;
                studentId.textContent = epv.studentDisplayId;
                payerId = epv.studentId;

                const tableBody = document.querySelector("#table-ni-kharl tbody");
                tableBody.innerHTML = "";
                epv.feeStatus.forEach(datas => {
                        const row = document.createElement("tr");
                        const statusClass = getPaymentStatusClass(datas.status);
                        row.innerHTML =`
                            <td>${datas.feeName}</td>
                            <td>${datas.requiredFee}</td>
                            <td>${datas.totalPaid}</td>
                            <td>${datas.balance}</td>
                            <td>
                                <div class="status-container">
                                    <div class="status ${statusClass}">${datas.status}</div>
                                </div>
                            </td>`;
                            tableBody.appendChild(row);
                    });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }

    async function fetchAllGradeLevels(isStudentNew,isTransferee, currentLevelId) {
        try {
            isStudentNew = isStudentNew === true || isStudentNew === "true";
            isTransferee = isTransferee === true || isTransferee === "true";

            var response = await fetch("/gradelevel/successor/"+currentLevelId);
            if(isStudentNew && isTransferee){
                response= await fetch('/gradelevel/all');
            }
             else if(isStudentNew === true){
                response = await fetch('/gradelevel/no-pre-requisite');}

            if (!response.ok) throw new Error("Failed to fetch grade levels");
            const data = await response.json();
            populateGradeLevelDropdown(data);
        } catch (error) {
            console.error("Error fetching grade levels:", error);
        }
    }

    function populateGradeLevelDropdown(gradeLevels) {
        const selectElement = document.getElementById("levelName");
        selectElement.innerHTML = '<option value="" disabled selected>Choose a Grade Level</option>';

        gradeLevels.forEach(level => {
            let option = document.createElement("option");
            option.value = level.levelId;
            option.textContent = level.levelName;
            selectElement.appendChild(option);
        });
    }


    document.addEventListener("DOMContentLoaded", function () {
        goList();
    });

    function getCheckedPaymentValues() {
            const checkedCheckboxes = document.querySelectorAll('.payment-container-group input[type="checkbox"]:checked');
            const checkedValues = Array.from(checkedCheckboxes).map(checkbox => checkbox.value);
            return checkedValues;
    }

    function savePayment() {
        const feesSelectedId = getCheckedPaymentValues();
        const totalAmount = paymentAmountInput.value;
        if (totalAmount == 0) {
            alert("DLi pwde wlay kay ibayad uys");
            return;
        } else if (feesSelectedId.length == 0) {
            alert("Dapat naa ka pilion");
            return;
        }
        const url = `/paymentrecord/add/all/${encodeURIComponent(payerStudentId)}/${encodeURIComponent(totalAmount)}?gradeLevel=${encodeURIComponent(payLevelToEnrollId)}`;
        const obj = {
            feesId: feesSelectedId
        };

        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(obj)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json(); // Parse the response as JSON
            })
            .then(receipt => {
                document.getElementById("receipt-student-id").value = receipt.student.studentDisplayId;
                document.getElementById("receipt-date").value = receipt.date;
                document.getElementById("receipt-student-name").value = receipt.student.fullName;
                document.getElementById("receipt-number").value = receipt.transactionReference;
                document.getElementById("receipt-number").value = receipt.transactionReference;

                const tableBody = document.querySelector("#receipt-table tbody");
                tableBody.innerHTML = "";
                let i = 1;
                receipt.particulars.forEach(dat =>{
                    const row = document.createElement("tr");
                    row.innerHTML =`
                        <tr>
                            <td>${i++}</td>
                            <td>${dat.feeName}</td>
                            <td>${dat.amountPaid}</td>
                        </tr>`;
                    tableBody.appendChild(row);
                });
                const row = document.createElement("tr");
                    row.innerHTML =`
                        <tfoot>
                            <tr>
                                <td colspan="2">Total Amount Paid:
                                </td>
                                <td>₱ ${receipt.totalAmount}</td>
                            </tr>
                        </tfoot>`;
                tableBody.appendChild(row);
                goList(currentPageNo, currentPageSize);
               closeOpen();
            })
            .catch(error => {
                console.error("Error adding payment:", error);
                alert("Failed to add payment. Please try again.");
            });
    }

    function closeOpen(){
            const button1 = document.createElement("button");
            button1.setAttribute("data-close-modal", "addPaymentModal");
            button1.setAttribute("data-open-modal","receiptModal");
            const button2 = document.createElement("button");
            button2.setAttribute("data-close-modal", "listOfPaymentsModal");
            document.body.appendChild(button1);
            document.body.appendChild(button2);
            button1.click();
            button2.click();
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            if (event.target.closest(".proceedButton")) {
                event.preventDefault();

                enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id");
                console.log("Enrollment ID:", enrollmentIdLet);
            }
        });
    });

    function proceedToEnrolled(enrollmentIdLet) {
        const apiUrl = `/enrollment/add/enrolled/${enrollmentIdLet}`;
        console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status }))) // Get text & status
            .then(({ text, status }) => {
                console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
// <!--                    showSuccessModal("✅ Success: Student successfully enrolled!");-->
// <!--                    location.reload(); // Reloads the page after successful enrollment-->
                    goList(currentPageNo, currentPageSize);
                } else {
                    // showErrorModal("❌ Error: " + text);
                    location.reload();
                }
            })
            .catch(error => {
                // showErrorModal("❌ Error: " + text);
                location.reload();
            });
    }

    async function proceedToAssessment(enrollmentIdLet) {
        const gradeLevelId = document.getElementById("levelName").value;

        if (!gradeLevelId) {
            showErrorModal("❌ Error: Please select a grade level!");
            return;
        }

        try {
            const response = await fetch(`/enrollment/add/assessment/${enrollmentIdLet}/${gradeLevelId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" }
            });

            const result = await response.text();

            if (response.ok) {
                goList(currentPageNo, currentPageSize);
            } else {
                showErrorModal("❌ Error: Transaction failed. Please try again!");
            }
        } catch (error) {
            showErrorModal("❌ Error: Transaction failed. Please try again!");
        }
    }

    function addExistingStudent(studentId) {
    alert(studentId);
        fetch('/enrollment/add/student/' + studentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                    goList(currentPageNo, currentPageSize);
// <!--                        showSuccessModal(message);-->
// <!--                        window.location.reload(); // Reload the page-->
                    } else {
                        showErrorModal(message);
                    }
                });
            })
            .catch(error => {
                showErrorModal(message);
            });
    }
    document.getElementById("scholar").addEventListener("change", function () {
        this.checked;
    });

    function studAddListing() {
        const actionUrl = "/students/add"; 
        const method = "POST";

        // Collect input values
        const birthplace =
            document.getElementById("studplaceOfBirth")?.value?.trim() ||
            document.getElementById("studplaceOfBirth")?.value?.trim() ||
            null;

        const studentData = {
            scholar: document.getElementById("scholar").checked,
            firstName: document.getElementById("studentFirstName").value.trim(),
            lastName: document.getElementById("studentLastName").value.trim(),
            middleName: document.getElementById("studentMiddleName")?.value?.trim() || null,
            gender: document.getElementById("studgender").value || null,
            birthdate: document.getElementById("studbirthdate").value || null,
            birthPlace: birthplace, // Use the extracted birthPlace variable

            address: [
                document.getElementById("studstreet")?.value?.trim(),
                document.getElementById("studbarangay")?.value?.trim(),
                document.getElementById("studcity")?.value?.trim()
            ].filter(Boolean).join(", "),

            // Parent's Information
            fatherName: document.getElementById("studfatherName")?.value?.trim() || null,
            fatherOccupation: document.getElementById("studfatherOccupation")?.value?.trim() || null,
            motherName: document.getElementById("studmotherName")?.value?.trim() || null,
            motherOccupation: document.getElementById("studmotherOccupation")?.value?.trim() || null,

            // Guardian's Information
            guardianName: document.getElementById("studguardianName")?.value?.trim() || null,
            guardianOccupation: document.getElementById("studguardianOccupation")?.value?.trim() || null,
            guardianContactNum: document.getElementById("studguardianContactNumber")?.value?.trim() || null,
            guardianAddress: document.getElementById("studguardianAddress")?.value?.trim() || null
        };

        // console.log("Student Data:", studentData);

        fetch(actionUrl, {
            method: method,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(studentData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.text();
            })
            .then(text => {
// <!--                showSuccessModal("✅ Success: New student has been added successfully!");-->
                goList(currentPageNo, currentPageSize);
            })
            .catch(error => {
                showErrorModal("❌ Error: Please try again!");
            });
    }

    function transfereeAddListing() {
        const actionUrl = "/students/add"; // Update with your actual API endpoint
        const method = "POST";

        const birthplace = document.getElementById("transfereeplaceOfBirth")?.value?.trim() || null;

        const studentData = {
            firstName: document.getElementById("transfereestudentFirstName").value.trim(),
            lastName: document.getElementById("transfereestudentLastName").value.trim(),
            middleName: document.getElementById("transfereestudentMiddleName")?.value?.trim() || null,
            gender: document.getElementById("transfereegender").value || null,
            birthdate: document.getElementById("transfereebirthdate").value || null,
            birthPlace: birthplace,

            // Address
            address: [
                document.getElementById("transfereestreet")?.value?.trim(),
                document.getElementById("transfereebarangay")?.value?.trim(),
                document.getElementById("transfereecity")?.value?.trim()
            ].filter(Boolean).join(", "),

            // Parent's Information
            fatherName: document.getElementById("transfereefatherName")?.value?.trim() || null,
            fatherOccupation: document.getElementById("transfereefatherOccupation")?.value?.trim() || null,
            motherName: document.getElementById("transfereemotherName")?.value?.trim() || null,
            motherOccupation: document.getElementById("transfereemotherOccupation")?.value?.trim() || null,

            // Guardian's Information
            guardianName: document.getElementById("transfereeguardianName")?.value?.trim() || null,
            guardianOccupation: document.getElementById("transfereeguardianOccupation")?.value?.trim() || null,
            guardianContactNum: document.getElementById("transfereeguardianContactNumber")?.value?.trim() || null,
            guardianAddress: document.getElementById("transfereeguardianAddress")?.value?.trim() || null,

            // Transferee-specific Information
            lastGradeLevelCompleted: document.getElementById("lastGradeLevelCompleted")?.value?.trim() || null,
            lastMadrasaYearCompleted: document.getElementById("lastMadrasaYearCompleted")?.value?.trim() || null,
            madrasaNameLastAttended: document.getElementById("madrasaNameLastAttended")?.value?.trim() || null,
            madrasaAddress: document.getElementById("madrasaAddress")?.value?.trim() || null
        };

        console.log("Transferee Data:", studentData);

        fetch(actionUrl, {
            method: method,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(studentData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.text();
            })
            .then(text => {
                showSuccessModal("✅ Success: New transferee has been added successfully!");
            })
            .catch(error => {
                showErrorModal("❌ Error: please try again!");
            });
    }
    function changeView(){
        console.log("Palitan ang table content");
        goList(1,1);
    }

    var currentStat = "";
    var currentPageNo = 0;
    var currentPageSize = 0;
    var currentStat = "";
    function goList(pageNo = 1, pageSize = 1) {
        const search = document.getElementById("search-stud").value;
        currentStat = document.getElementById("sort-select").value;
        console.log(currentStat);
        currentPageNo = pageNo;
        currentPageSize = pageSize;
        fetch(`/enrollment/all/paged/${currentStat}?pageNo=${pageNo}&pageSize=${pageSize}&search=${search}`)
            .then(res => {
                if (!res.ok) throw new Error("Failed to fetch enrollment records");
                return res.json();
            })
            .then(data => {
                const tableBody = document.querySelector("#lamesa tbody");
                tableBody.innerHTML = "";

                data.content.forEach(enr => {
                    const row = document.createElement("tr");
                    row.setAttribute("data-enrollment-id", enr.enrollmentId);
                    row.classList.add("clickable-row");

                    let dropdownContent = getDropdownContent(enr);

                    row.innerHTML = `
                    <td>${enr.student.studentDisplayId}</td>
                    <td>${enr.student.firstName} ${enr.student.middleName ? enr.student.middleName + ' ' : ''} ${enr.student.lastName}</td>`;
                    if(enr.enrollmentStatus === "ASSESSMENT"){
                        const levelId = enr.student.currentGradeLevel?.levelId ?? null;
                        row.innerHTML+=`
                            <td>
                                <select onChange="printer(this.options[this.selectedIndex].value, ${enr.enrollmentId})"
                                        class="grade-level-dropdown" data-enrollment-id="${enr.enrollmentId}" data-isStudent-new="${enr.student.new}"
                                        data-current-grade-Id="${levelId}" data-isStudent-transferee="${enr.student.transferee}">
                                    <option>Loading...</option> <!-- Placeholder -->
                                </select>
                            </td>`;
                    }else{
                        row.innerHTML+=`<td>${enr.gradeLevelToEnroll || "NONE"}</td>`;
                    }
                    row.innerHTML+=`
                    <td>
                        <div class="dropdown">
                            <div class="status-container">
                                <div class="status" id="status-registration">${enr.enrollmentStatus}</div>
                                <button class="dropdown-status-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="dropdown-status-content" id="dropdown-listing">
                                ${dropdownContent}
                            </div>
                        </div>
                    </td>
                `;
                    tableBody.appendChild(row);
                });
                document.querySelectorAll(".grade-level-dropdown").forEach(selectTag => {
                    var currentLevelId = selectTag.getAttribute("data-current-grade-Id");
                    var isStudentNew = selectTag.getAttribute("data-isStudent-new");
                    var isTransferee = selectTag.getAttribute("data-isStudent-transferee");
                    var enrollmentId = selectTag.getAttribute("data-enrollment-id");
                    var selectedGrade = data.content.find(e => e.enrollmentId == enrollmentId)?.gradeLevelToEnroll;
                    fetchGradeLevels(selectedGrade, selectTag,isStudentNew,currentLevelId,isTransferee);
                });

                updatePagination(status, pageNo, pageSize, data.totalPages);
            })
            .catch(error => console.error("Error:", error));
    }

    function printer(gradeLevelId, enrollmentId) {
        updateGradeLevel(enrollmentId, gradeLevelId);
    }
    async function updateGradeLevel(enrollmentId, gradeLevelId) {
        try {
            const response = await fetch(`/enrollment/add/assessment/${enrollmentId}/${gradeLevelId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" }
            });

            if (response.ok) {
                const result = await response.text(); // Parse the response as text
                alert(result);
                goList(currentPageNo,currentPageSize)
            } else {
                const errorMessage = await response.text();
                alert(errorMessage);
            }
        } catch (error) {
            console.error("Error proceeding to assessment:", error);
            alert("Transaction failed. Try again.");
        }
    }

        function fetchGradeLevels(selectedGrade, selectTag,isStudentNew,currentLevelId, isTransferee) {
        var url = "/gradelevel/successor/"+currentLevelId;
        isStudentNew = isStudentNew === true || isStudentNew === "true";
        isTransferee = isTransferee === true || isTransferee === "true";
        if(isStudentNew && isTransferee){
            url = "/gradelevel/all";
        }
        else if(isStudentNew){
            url = "/gradelevel/no-pre-requisite";
        }
        const originalOnChange = selectTag.getAttribute("onChange");
        selectTag.removeAttribute("onChange");

        fetch(url)
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! Status: ${res.status}`);
                }
                return res.json();
            })
            .then(gradeLevels => {
                if (!Array.isArray(gradeLevels) || gradeLevels.length === 0) {
                    console.warn("No grade levels received or data is not an array.");
                    return;
                }

                selectTag.innerHTML = ""; // Clear existing options

                let foundMatch = false;

                gradeLevels.forEach((grade, index) => {
                    if (!grade.levelId || !grade.levelName) {
                        console.warn(`Invalid grade level at index ${index}:`, grade);
                        return;
                    }

                    const option = document.createElement("option");
                    option.value = grade.levelId;
                    option.textContent = grade.levelName;
                    if (String(selectedGrade).trim().toLowerCase() === String(grade.levelName).trim().toLowerCase()) {
                        option.selected = true;
                        foundMatch = true;
                    }

                    selectTag.appendChild(option);
                });

                if (!foundMatch) {
                    console.warn(`⚠️ No matching grade level found for selectedGrade: ${selectedGrade}`);
                }

                // Re-enable the onChange event listener after populating the dropdown
                selectTag.setAttribute("onChange", originalOnChange);
            })
            .catch(error => console.error("Error fetching grade levels:", error));
    }

    function getDropdownContent(enr) {
        switch (enr.enrollmentStatus) {
            case "LISTING":
                return `
                <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="studentInformationModal"> View Record </a>
                <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" data-isStudent-new="${enr.student.new}"
                   data-isTransferee="${enr.student.transferee}" data-current-gradeId="${enr.student.currentGradeLevel.levelId}"
                   data-open-modal="gradeLevelModal"> Proceed </a>
                <a href="#" data-action="cancelRegistration" data-open-modal="confirmationModal" 
                   data-message="Are you sure you want to cancel this registration?"> Cancel Registration </a>
            `;
            case "ASSESSMENT":
                return `
                <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="studentInformationModal"> View Record </a>
                <a href="#" class="action" data-displayId="${enr.student.studentDisplayId}"
                   data-prerequisite="${enr.preRequisiteId}"
                   data-stud-name="${enr.student.firstName} ${enr.student.middleName || ""} ${enr.student.lastName}"
                   data-id="${enr.student.studentId}" data-open-modal="viewGradesModal">View Grades</a>
                <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}"
                    data-grade-level-id="${enr.gradeLevelToEnroll}"
                   data-open-modal="addGradeLevelAssessmentModal"
                   ${enr.qualified ? '' : 'style="pointer-events: none; opacity: 0.5; color: gray;"'}>${enr.qualified ? 'Proceed' : 'Not Qualified'}</a>
            `;
            case "NOT_REGISTERED":
                return `<a href="#" onclick="addExistingStudent(${enr.student.studentId})"> Add to Listing </a>
            `;
            case "PAYMENT":
                return `
                <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="studentInformationModal"> View Record </a>
                <a href="#" class="viewPaymentsButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="listOfPaymentsModal"
                   data-student-id="${enr.student.studentId}"
                   data-level-id="${enr.gradeLevelToEnrollId}"
                   > View List of Payments </a>
                ${enr.complete ? `
                    <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" 
                       data-open-modal="confirmationModal" 
                       data-message="Are you sure you want to proceed and finish enrollment?" 
                       data-action="proceedToEnrolled"> Proceed </a>
                ` : `<a style="pointer-events: none; opacity: 0.5; color: gray;">
                       Bayarig minimum isa2 suss
                    </a>`}
            `;
            case "ENROLLED":
                return `
                <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="studentInformationModal"> View Record </a>
            `;
            default:
                return `<p>No actions available</p>`;
        }
    }

    function updatePagination(status, currentPage, pageSize, totalPages) {
        const paginationContainer = document.querySelector("#pagination");
        paginationContainer.innerHTML = "";

        if (totalPages <= 1) return;

        const maxVisiblePages = 3;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        // Adjust if near the beginning or end
        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        // Left Arrow
        if (currentPage > 1) {
            const prevButton = document.createElement("button");
            prevButton.innerText = "<";
            prevButton.classList.add("pagination-button");
            prevButton.addEventListener("click", () => {
                goList(currentPage - 1, pageSize);
            });
            paginationContainer.appendChild(prevButton);
        }

        // Page Numbers
        for (let i = startPage; i <= endPage; i++) {
            const button = document.createElement("button");
            button.innerText = i;
            button.classList.add("pagination-button");
            if (i === currentPage) button.classList.add("active");
            button.addEventListener("click", () => {
                goList(i, pageSize);
            });
            paginationContainer.appendChild(button);
        }

        // Right Arrow
        if (currentPage < totalPages) {
            const nextButton = document.createElement("button");
            nextButton.innerText = ">";
            nextButton.classList.add("pagination-button");
            nextButton.addEventListener("click", () => {
                goList(currentPage + 1, pageSize);
            });
            paginationContainer.appendChild(nextButton);
        }
    }
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add("show");
            modal.style.visibility = "visible";
            modal.style.opacity = "1";
            modal.style.pointerEvents = "auto";
        }
    }
    let payerStudentId;
    let payLevelToEnrollId;
    document.addEventListener("click", function (event) {
        const target = event.target;
        const gradeLevelbtn = target.closest('[data-open-modal="gradeLevelModal"]');
        const proceedButton = target.closest('[data-open-modal="addGradeLevelAssessmentModal"]');
        const enrollmentId = target.getAttribute("data-enrollment-id");
        const paymentList = target.closest('[data-open-modal="listOfPaymentsModal"]');
        const viewRecordButton = target.closest(".viewRecordButton");
        const paymentBtn = target.closest('[data-open-modal="addPaymentModal"]');
        const proceedToEnrolledButton = target.closest("#proceed-btn");
        if (proceedToEnrolledButton) {
            const enrollmentIdElement = proceedToEnrolledButton.getAttribute("data-enrollment-id");

            if (enrollmentIdElement) {
                enrollmentIdLet = enrollmentIdElement.trim();
            } else {
                alert("⚠️ Enrollment ID not found.");
            }
        }
        if(paymentBtn){
            alert("Will set up payment form");
            setUpPaymentForm();
        }
        else if (paymentList) {
            const enrollmentId = paymentList.getAttribute("data-enrollment-id");
            if (!enrollmentId) return console.error("Enrollment Id Not Found");
            payerStudentId = paymentList.getAttribute("data-student-id");
            payLevelToEnrollId = paymentList.getAttribute("data-level-Id");
            fetchPayments(enrollmentId);
        }
        else if (viewRecordButton) {
            const enrollmentId = viewRecordButton.getAttribute("data-enrollment-id"); // ✅ Capture enrollment ID
            console.log(`🔍 View Record for Enrollment ID: ${enrollmentId}`);

            // Show the modal
            const modal = document.getElementById("studentInformationModal");
            if (modal) {
                modal.classList.add("show");
                modal.style.visibility = "visible";
                modal.style.opacity = "1";
                modal.style.pointerEvents = "auto";
            }
        }
        if (target.classList.contains("viewRecordButton")) {
            console.log(`🔍 View Record for Enrollment ID: ${enrollmentId}`);
            openModal("studentInformationModal");
        }
        if (target.classList.contains("proceedButton")) {
            const modalId = target.getAttribute("data-open-modal");
            openModal(modalId);
        }
        if (target.dataset.openModal=== "viewGradesModal") {
            viewStudentGrade(target);
        }
        if (target.classList.contains("viewPaymentsButton")) {
            console.log(`💰 Viewing Payments for Enrollment ID: ${enrollmentId}`);
            openModal("listOfPaymentsModal");
        }
        if (proceedButton) {
            const gradeLevel = proceedButton.getAttribute("data-grade-level-id");
            if (!gradeLevel) return console.error("Grade level not found for section selection");
            const gradeLevelInput = document.querySelector("#grade-level");
            if (gradeLevelInput) {
                gradeLevelInput.value = gradeLevel;
            }
            fetchSections(gradeLevel);
        }
        if(gradeLevelbtn){
            const isStudentNew = gradeLevelbtn.getAttribute("data-isStudent-new");
            const isTransferee = gradeLevelbtn.getAttribute("data-isTransferee");
            const currentGradeId = gradeLevelbtn.getAttribute("data-current-gradeId");
            fetchAllGradeLevels(isStudentNew, isTransferee, currentGradeId);
        }
    });

    function handleCheckboxChange(event, balance) {
            const checkbox = event.target; // The checkbox that was clicked
            const value = checkbox.value; // The value of the checkbox
            const isChecked = checkbox.checked; // Whether the checkbox is checked or unchecked
            const currentMax = parseFloat(paymentAmountInput.max) || 0;
            let newMax = 0;
            if (isChecked) {
                newMax = currentMax + balance;
            } else {
                newMax = currentMax - balance;
            }
            paymentAmountInput.max = newMax;
            if (paymentAmountInput.value > newMax) {
                paymentAmountInput.value = newMax;
            }
    }
    const paymentAmountInput = document.getElementById('payment-amount');
        if (paymentAmountInput) {
            paymentAmountInput.addEventListener('input', function () {
                const maxValue = parseFloat(this.max);
                const enteredValue = parseFloat(this.value);

                if (enteredValue > maxValue) {
                    alert(maxValue + ' nalang imong need bayaran, di na pwde musobra sussss');
                    this.value = maxValue;
                }
            });
        }
    async function setUpPaymentForm() {
        paymentAmountInput.max = 0;
        paymentAmountInput.value = 0.0;
        let response = await fetch(`/paymentrecord/form/${payerStudentId}?gradeLevelId=${payLevelToEnrollId}`);
        if (!response.ok) throw new Error("wa nakita");
        let data = await response.json();
        const student = data.student;

        const studentname = document.querySelector("#payee-name");
        const studentDisplayId = document.querySelector("#payee-id");
        studentname.value = student.fullName;
        studentDisplayId.value = student.studentDisplayId;

        const paymentContainer = document.querySelector(".payment-container-group");
        paymentContainer.innerHTML = '';
        data.feesAndBalance.forEach(par => {
            const paymentItem = document.createElement("div");
            paymentItem.classList.add("payment-item");
            console.log(par);
            console.log(par.balance);
            const input = document.createElement("input");
            input.type = "checkbox";
            input.name = par.fee.name;
            input.value = par.fee.id;
            input.addEventListener("change", (event) => {
                handleCheckboxChange(event, par.balance);
            });

            let label = document.createElement("label");
            label.textContent = par.fee.name;
            label.setAttribute("for", par.fee.name);

            paymentItem.appendChild(input);
            paymentItem.appendChild(label);
            paymentContainer.appendChild(paymentItem);
        });
    }

    function viewStudentGrade(target){
        const studentId = target.dataset.id;
        const preRequisiteId = target.getAttribute("data-prerequisite");
        document.getElementById("student-grade-name").textContent = target.getAttribute("data-stud-name");
        document.getElementById("student-grade-id").textContent = target.getAttribute("data-displayId");
        const tableBody = document.querySelector("#lamesaa tbody");
        tableBody.innerHTML = `<td colspan="4">No Records Found</td>`;
        if(preRequisiteId === "null"){
            return;
        }

        if (!studentId) {
            console.error(
                "Error: gradeLevelId is undefined! Make sure data-id is set in HTML."
            );
            return;
        }

        fetch(`/student-grades/student/${studentId}/${preRequisiteId}`)
            .then((response) => response.json())
            .then((data) => {
                const studentGradesMap = new Map(Object.entries(data));
                if(studentGradesMap.size === 0) {
                    return;}
                tableBody.innerHTML = "";
                studentGradesMap.forEach((values, key) => {
                    const keyRow = document.createElement("tr");
                    keyRow.innerHTML = `<td colspan="3"><strong>${key}</strong></td>`; // Use colspan to span all columns
                    tableBody.appendChild(keyRow);

                    let gradeTotal = 0;
                    let gradeCount = 0;
                    values.forEach((grade) => {
                        gradeTotal += grade.subjectGrade === null ? 0 : grade.subjectGrade;
                        gradeCount++;

                        const gradeRow = document.createElement("tr");
                        gradeRow.innerHTML = `
                            <td>${grade.subjectName}</td>
                            <td>${grade.subjectName}</td>
                            <td>${grade.subjectGrade === null ? 'N/A' : grade.subjectGrade}</td>
                        `;
                        tableBody.appendChild(gradeRow);
                    });

                    // Calculate the average grade after the loop is finished
                    const avg = gradeCount > 0 ? gradeTotal / gradeCount : 0; // Avoid division by 0

                    // Create the average row (this should be done outside the loop)
                    const averageRow = document.createElement("tr");
                    averageRow.id = "average-row";
                    averageRow.innerHTML = `
                            <td colspan="2">Average</td>
                            <td>${avg.toFixed(2)}</td>`;
                    // Append the average row after all grade rows have been appended
                    tableBody.appendChild(averageRow);
                });
            })
            .catch((error) => console.error("Error fetching grade level:", error));
    }

    let enrollmentIdLet = null;
    function fetchSections(gradeLevel) {
        fetch(`/section/gradeLevel/${gradeLevel}`)
            .then(res => res.json())
            .then(sections => {
                const selectTag = document.querySelector("#section"); // Modal select tag
                if (!selectTag) return console.error("Dropdown for sections not found");

                selectTag.innerHTML = `<option value="">Select Section</option>`; // Default option

                sections.forEach(section => {
                    const option = document.createElement("option");
                    option.value = section.number;
                    option.textContent = section.sectionName;
                    selectTag.appendChild(option);
                });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }
    document.addEventListener("click", async function (event) {
        const addButton = event.target.closest('.add-payment-btn');

        if (addButton) {
            const studentName = document.querySelector("#student-name")?.textContent?.trim();
            const studentId = document.querySelector("#student-id-list")?.textContent;
            if (!studentName || !studentId) {
                console.error("Student information not found");
                return;
            }

            document.querySelector("#payee-name").value = studentName;
            document.querySelector("#payee-id").value = studentId;

            // Set current date in the "Date" field (local timezone)
            let dateInput = document.getElementById("date");
            if (dateInput) {
                const today = new Date();
                const formattedDate = today.getFullYear() + "-" +
                    String(today.getMonth() + 1).padStart(2, '0') + "-" +
                    String(today.getDate()).padStart(2, '0');

                dateInput.value = formattedDate; // Correct local date
                dateInput.readOnly = true;       // Make it readonly
            } else {
                console.error("Date input field not found in the modal");
            }


            // Fetch and populate the current active school year
            try {
                let response = await fetch("/semester/currentactive");
                if (!response.ok) throw new Error("Failed to fetch active school year");

                let data = await response.json();
                document.getElementById("semester").value = data.sem;
                document.getElementById("school-year").value = data.schoolYear.schoolYear;

            } catch (error) {
                console.error("Error fetching current active school year:", error);
            }

            // Fetch and populate payment list
            try {
                let response = await fetch("/payments/all");
                if (!response.ok) throw new Error("Failed to fetch required payments");

                let data = await response.json();
                let paymentList = document.getElementById("payment-list");

                paymentList.innerHTML = '<option value="" disabled selected>Choose</option>';
                Object.values(data).forEach(payment => {
                    let option = document.createElement("option");
                    option.value = payment.id;
                    option.textContent = payment.name;
                    paymentList.appendChild(option);
                });

            } catch (error) {
                console.error("Error fetching payment list:", error);
            }
        }
    });





</script>

</html>