    <!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/fragment :: commonHead}">
</head>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/sidebar.js}"></script>

<body>
    <!-- Sidebar -->
    <div th:replace="~{fragments/fragment :: sidebar}"></div>

    <!-- Topbar with Hamburger & User Icon -->
    <div class="dashboard-container" id="content">
        <div class="sticky-header">
            <!-- Topbar -->
            <div th:replace="~{fragments/fragment :: topbar}"></div>

            <div class="text-link" id="breadcrumb-container">
                <h4>Student Reports</h4>
                <a href="/home">Main</a>
                <p>/</p>
                <a href="/reports/student">Reports - Student Reports</a>
                <p>/</p>
                <a href="/reports/student/{studentName}" id="studName" title="You're currently on this page.">Reynolds Perkins</a>
            </div>

            <div class="report-main-btns">
                <div class="report-main-btns-left back-btn">
                    <button type="button" class="btn-back" onclick="history.back()" title="Back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>

                <div class="report-main-btns-right">
                    <button onclick="setUpEditForm()" type="button" class="btn-gray" id="editStudInfo"
                        data-open-modal="studentInformationEditModal">Edit</button>
                    <button type="button" class="btn-neutral" id="printGrade"
                        data-open-modal="studentInformationPrintModal">Print</button>
                </div>

            </div>

        </div>

        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="modal">
            <div class="modal-content scroll-lock">
                <p id="modalText">Are you sure?</p>
                <div class="confirmation-modal-buttons">
                    <button type="button" id="confirmAction" class="btn-confirm">Confirm</button>
                    <button type="button" data-close-modal="confirmationModal" class="btn-cancel">Cancel</button>
                </div>
            </div>
        </div>

        <!-- viewClaimedResourcesModal -->
        <div id="viewClaimedResourcesModal" class="view-claimed-resources-modal modal">
            <div class="view-claimed-resources-modal-content scroll-lock">
                <h2>Claimed Resources</h2>

                <div class="half-width view-studId" id="">
                    <label for="student-resources-id">Student ID:</label>
                    <h6 id="student-resources-id"></h6>
                </div>
                <div class="half-width view-studName" id="">
                    <label for="student-resources-name">Student Name:</label>
                    <h6 id="student-resources-name">Martin Francisco</h6>
                </div> <br>

                <!-- Table -->
                <div class="table-wrapper-printable">
                    <table id="claimed-res-table" class="printable-table main-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Grade Level</th>
                                <th>Date Received</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="pagination-container">
                        <div class="pagination-controls">
                            <span id="itemRangeDistC">1–10 of 37</span>
                            <button type="button" id="prevPageDistC">«</button>
                            <input type="number" id="pageInputDistC" min="1" value="1">
                            <span id="totalPagesDistC">of 4</span>
                            <button type="button" id="nextPageDistC">»</button>
                        </div>
                    </div>
                </div>


                <!-- Close button -->
                <div class="modal-buttons">
                    <button type="button" data-close-modal="viewClaimedResourcesModal" class="btn-cancel"
                        id="close-button">Close</button>

                    <button type="button" onclick="printClaimedResources()" class="print-btn">Print Record</button>
                </div>
            </div>
        </div>

        <!-- viewPastTransactionsModal -->
        <div id="viewPastTransactionsModal" class="view-past-transactions-modal modal">
            <div class="view-past-transactions-modal-content scroll-lock">
                <h2>Fully Paid Particulars</h2>

                <div class="half-width view-studId" id="">
                    <label for="student-grade-id">Student ID:</label>
                    <h6 id="student-grade-id"></h6>
                </div>
                <div class="half-width view-studName" id="">
                    <label for="student-grade-name">Student Name:</label>
                    <h6 id="student-grade-name">Martin Francisco</h6>
                </div> <br>

                <!-- Table -->
                <div class="table-wrapper-printable">
                    <table id="past-trans-table" class="printable-table main-table">
                        <thead>
                            <tr>
                                <th>Particular</th>
                                <th>Total Amount</th>
                                <th>Total Paid</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <!-- Pagination -->
                    <div class="pagination-container">
                        <div class="pagination-controls">
                            <span id="itemRangePFee">1–10 of 37</span>
                            <button type="button" id="prevPagePFee">«</button>
                            <input type="number" id="pageInputPFee" min="1" value="1">
                            <span id="totalPagesPFee">of 4</span>
                            <button type="button" id="nextPagePFee">»</button>
                        </div>
                    </div>
                </div>


                <!-- Close button -->
                <div class="modal-buttons">
                    <button type="button" data-close-modal="viewPastTransactionsModal" class="btn-cancel"
                        id="close-button">Close</button>

                    <button type="button" onclick="printIndividTransactions()" class="print-btn">Print Record</button>
                </div>
            </div>
        </div>

        <!-- individTransactionPrintModal -->
        <div id="individTransactionsPrintModal" class="all-transactions-print-modal modal">
            <div class="printable-area-transactions">
                <div class="all-transactions-print-modal-content scroll-lock">
                    <!-- Report Header -->
                    <div class="header-container-print">

                        <div class="left-header">
                            <img src="/images/al-furqanlogo.jpg" alt="School Logo" class="school-logo-payment">
                        </div>
                        <div class="middle-header">
                            <div class="school-info-print">
                                <h3 th:text="${schoolName}"></h3>
                                <p th:text="${schoolAddress}"></p>
                                <p th:text="${schoolEmail}"></p>
                                <p th:text="${schoolNum}"></p>
                            </div>
                        </div>
                    </div>

                    <div class="separator-line"></div>
                    <!-- Student Info -->

                    <h3 class="report-title"><strong>Payments and Transactions Report</strong></h3>

                    <!-- Table -->
                    <table id="individ-trans-table-printable" class="printable-table">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Student Name</th>
                                <th>Date Paid</th>
                                <th>Transaction No.</th>
                                <th>Amount Paid</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>

                    <div class="printable-footer">
                        Date Printed: <strong>4/1/2020</strong>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn-cancel"
                            data-close-modal="allTransactionsPrintModal">Close</button>

                        <button type="button" onclick="printReceipt()" class="print-btn">Print Record</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- individClaimedResourcesPrintModal -->
        <div id="individClaimedResourcesPrintModal" class="all-transactions-print-modal modal">
            <div class="printable-area-claimed-resources">
                <div class="all-transactions-print-modal-content scroll-lock">
                    <!-- Report Header -->
                    <div class="header-container-print">

                        <div class="left-header">
                            <img src="/images/al-furqanlogo.jpg" alt="School Logo" class="school-logo-payment">
                        </div>
                        <div class="middle-header">
                            <div class="school-info-print">
                                <h3 th:text="${schoolName}"></h3>
                                <p th:text="${schoolAddress}"></p>
                                <p th:text="${schoolEmail}"></p>
                                <p th:text="${schoolNum}"></p>
                            </div>
                        </div>
                    </div>

                    <div class="separator-line"></div>
                    <!-- Student Info -->

                    <h3 class="report-title"><strong>Payments and Transactions Report</strong></h3>

                    <!-- Table -->
                    <table id="claimed-res-table-printable" class="printable-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Grade Level</th>
                                <th>Date Received</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>

                    <div class="printable-footer">
                        Date Printed: <strong>4/1/2020</strong>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn-cancel"
                            data-close-modal="allTransactionsPrintModal">Close</button>

                        <button type="button" onclick="printReceipt()" class="print-btn">Print Record</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="studentInformationEditModal" class="student-information-edit-modal modal">
            <div class="student-information-edit-modal-content scroll-lock">
                <div class="modal-body">
                    <h1>Student Information</h1>
                    <form method="" action="" id="studentInformationFormEdit">
                        <div class="header">
                            <div class="half-unique">
                                <label for="student-id-edit">Student ID: </label>
                                <input readonly type="text" class="student-id-report" id="student-id-edit">
                            </div> <br>

                            <div class="checkbox-container other-info-container">
                                <div class="checkbox">
                                    <label for="isTransferee-edit">Transferee:</label>
                                    <input type="checkbox" name="amITransferee" id="isTransferee-edit">
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left;">
                            <h2>Personal Information</h2>
                        </div>

                        <div class="container">
                            <div class="row">
                                <div class="column1">
                                    <div>
                                        <label for="name-edit">Name</label>
                                        <div class="student-form-group half">
                                            <input name="firstName" type="text" required class="name" id="firstNameEdit">
                                            <input name="middleName" type="text" required class="name" id="middleNameEdit">
                                            <input name="lastName" type="text" required class="name" id="lastNameEdit">
                                        </div>
                                        <div class="small-text">
                                            <p>First</p>
                                            <p>Middle</p>
                                            <p>Last</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="column2">
                                    <div class="student-form-group half-stud-info-small" style="margin-bottom: 0px;">
                                        <label for="gender-edit">Gender:</label>
                                        <select type="text" name="gender" required class="gender" id="gender-edit">
                                            <option value="MALE">Male</option>
                                            <option value="FEMALE">Female</option>
                                        </select>

                                        <label for="birthdate-edit">Birthdate:</label>
                                        <input required name="birthdate" type="date" class="birthdate" id="birthdate-edit">
                                    </div>
                                </div>

                                <div class="student-form-group">
                                    <div>
                                        <label for="address-edit">Address:</label>
                                        <div class="student-form-group half-unique">
                                            <input name=street type="text" class="address" id="street-edit" required
                                                placeholder="Street">
                                            <input name="barangay" type="text" class="address" id="barangay-edit" required
                                                placeholder="Barangay">
                                            <input name="city" type="text" class="address" id="city-edit" required
                                                placeholder="City">
                                        </div>
                                    </div>

                                    <div>
                                        <label>Place of Birth:</label>
                                        <div class="student-form-group">
                                            <input name="birthPlace" type="text" required id="placeOfBirthEdit" class="place-of-birth-report">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Additional Information</h2>
                        </div>

                        <div>
                            <h6>Student Email: (Optional)</h6>
                            <div class="student-form-group stud-email address-div">
                                <label for="stud-email">Email:</label>
                                <input type="email" readonly class="parent-occupation">
                            </div> <br>
                        </div>

                        <div>
                            <h6>Father's Information</h6>
                            <div class="student-form-group">
                                <label for="fatherNameEdit">Name:</label>
                                <input name="fatherName" type="text" class="parent-name" required id="fatherNameEdit">

                                <label for="fatherOccupationEdit">Occupation:</label>
                                <input name="fatherOccupation" type="text" class="parent-occupation" required id="fatherOccupationEdit">
                            </div> <br>
                        </div>
                        <div>
                            <h6>Mother's Information</h6>
                            <div class="student-form-group">
                                <label for="motherNameEdit">Name:</label>
                                <input name="motherName" type="text" class="parent-name" required id="motherNameEdit">

                                <label for="motherOccupationEdit">Occupation:</label>
                                <input name="motherOccupation" type="text" class="parent-occupation" required id="motherOccupationEdit">
                            </div> <br>
                        </div>

                        <h6>Guardian's Information</h6>
                        <div class="student-form-group">
                            <label for="guardianNameEdit">Name:</label>
                            <input name="guardianName" type="text" class="parent-name" required id="guardianNameEdit">

                            <label for="guardianOccupationEdit">Occupation:</label>
                            <input name="guardianOccupation" type="text" class="parent-occupation" required id="guardianOccupationEdit">
                        </div> <br>

                        <div class="student-form-group">
                            <label for="guardianContactNumberEdit">Contact Number:</label>
                            <input name="guardianContactNum" type="text" class="guardian-number" required id="guardianContactNumberEdit">

                            <label for="guardianAddressEdit">Address:</label>
                            <input name="guardianAddress"type="text" class="guardian-address" required id="guardianAddressEdit">
                        </div> <br>

                        <div class="transferee-section" id="transfereeEditFields">
                            <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                                <h2>For Transferees Only</h2>
                            </div>

                            <div class="student-form-group">
                                <label for="lastGradeLevelCompletedEdit">Last Grade Level Completed:</label>
                                <select name="lastGradeLevelId" type="text" required id="lastGradeLevelCompletedEdit">
                                    <option value="0">None</option>
                                </select>

                                <label for="lastMadrasaYearCompletedEdit">Last Madrasa Year Completed</label>
                                <input name="lastMadrasaYearCompleted"type="text" required id="lastMadrasaYearCompletedEdit">
                            </div> <br>

                            <div class="student-form-group">
                                <label for="madrasaNameLastAttendedEdit">Madrasa Name Last Attended:</label>
                                <input name="madrasaName"type="text" required id="madrasaNameLastAttendedEdit">
                            </div> <br>

                            <div class="student-form-group">    
                                <label for="madrasaAddressEdit">Madrasa Address:</label>
                                <input name="madrasaAddress"type="text" required id="madrasaAddressEdit">
                            </div> <br>
                        </div>
                    </form>
                </div>
                

                <div class="modal-buttons">
                    <button type="button" id="confirmStudentReportEdit" class="btn-confirm" data-action="editStudentReport"
                        data-open-modal="confirmationModal"
                        data-message="Are you sure you want to update this student record?">Save Changes</button>

                    <button type="button" class="btn-cancel"
                        data-close-modal="studentInformationEditModal">Cancel</button>
                </div>
            </div>
        </div>


        <!-- Modal for student information -->
        <div id="studentInformationContainer" class="student-information-container">
            <div class="student-information-container-content">
                <h1>Student Information</h1>
                <form method="" action="" id="studentInformationForm">
                    <div class="header">
                        <div class="half-unique">
                            <label for="student-id">Student ID: </label>
                            <input readonly type="text" class="student-id-report" id="student-id">
                        </div> <br>

                        <div class="checkbox-container other-info-container">
                            <div class="checkbox">
                                <label for="isScholar">Scholar:</label>
                                <h6 id="isScholar">Yes</h6>

                                <button type="button" id="dropdown-report-scholar"> <img
                                        src="/images/icons/arrow-down.png" alt="dropdown-icon">
                                </button>

                                <div id="report-scholar-popover" name="add-discount" class="styled-popover">
                                    <div id="discounts-rec" class="checkbox-transferee-reqs-group">
                                    </div>
                                    <div>
                                        <button type="button" style="width: 100%;"
                                            data-open-modal="confirmationModal" data-action="editDiscounts"
                                            data-message="Are you sure you want to update the student discounts?"
                                            class="btn-confirm">Update</button>
                                    </div>
                                </div>
                            </div>

                            <div class="checkbox">
                                <label for="isTransferee">Transferee:</label>
                                <input type="checkbox" id="isTransferee">

                                <button type="button" id="dropdown-report-transferee"> <img
                                        src="/images/icons/arrow-down.png" alt="dropdown-icon">
                                </button>


                                <div id="report-transferee-popover" name="add-transferee-req" class="styled-popover">

                                    <div class="transferee-requirements">
                                        <h6>Requirements:</h6>
                                        <div id="transfereeReq" class="checkbox-transferee-reqs-group">

                                        </div>

                                        <div>
                                            <button type="button" style="width: 100%;" data-action="editGradeLevel"
                                                data-message="Are you sure you want to update the transferee requirements?"
                                                onclick="updateRequirements()" class="btn-confirm">Update</button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div style="display: flex; align-content: center; justify-items: left;">
                        <h2>Personal Information</h2>
                    </div>

                    <div class="container">
                        <div class="row">
                            <div class="column1">
                                <div>
                                    <label for="name">Name</label>
                                    <div class="student-form-group half">
                                        <input readonly type="text" class="name" id="firstName">
                                        <input readonly type="text" class="name" id="middleName">
                                        <input readonly type="text" class="name" id="lastName">
                                    </div>
                                    <div class="small-text">
                                        <p>First</p>
                                        <p>Middle</p>
                                        <p>Last</p>
                                    </div>
                                </div>
                            </div>
                            <div class="column2">
                                <!-- Gender, BDate, and Scholar -->
                                <div class="student-form-group half-stud-info-small">
                                    <label for="gender">Gender:</label>
                                    <input readonly type="text" class="gender" id="gender">

                                    <label for="birthdate">Birthdate:</label>
                                    <input readonly required type="date" class="birthdate" id="birthdate-report">
                                </div>
                            </div>

                            <div class="column1">
                                <div class="student-form-group">
                                    <div>
                                        <label for="address">Address:</label>
                                        <div class="student-form-group half-unique">
                                            <input readonly type="text" class="address" id="street" required
                                                placeholder="Street">
                                            <input readonly type="text" class="address" id="barangay" required
                                                placeholder="Barangay">
                                            <input readonly type="text" class="address" id="city" required
                                                placeholder="City">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="column2">
                                <label>Place of Birth:</label>
                                <div class="student-form-group">
                                    <input readonly type="text" id="placeOfBirth" class="place-of-birth-report">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                        <h2>Additional Information</h2>
                    </div>

                    <div>
                        <h6>Student Email: (Optional)</h6>
                        <div class="student-form-group stud-email address-div">
                            <label for="stud-email">Email:</label>
                            <input type="email" readonly class="parent-occupation">
                        </div> <br>
                    </div>

                    <div>
                        <h6>Father's Information</h6>
                        <div class="student-form-group">
                            <label for="fatherName">Name:</label>
                            <input readonly type="text" class="parent-name" id="fatherName">

                            <label for="fatherOccupation">Occupation:</label>
                            <input readonly type="text" class="parent-occupation" id="fatherOccupation">
                        </div> <br>
                    </div>
                    <div>
                        <h6>Mother's Information</h6>
                        <div class="student-form-group">
                            <label for="motherName">Name:</label>
                            <input readonly type="text" class="parent-name" id="motherName">

                            <label for="motherOccupation">Occupation:</label>
                            <input readonly type="text" class="parent-occupation" id="motherOccupation">
                        </div> <br>
                    </div>

                    <h6>Guardian's Information</h6>
                    <div class="student-form-group">
                        <label for="guardianName">Name:</label>
                        <input readonly type="text" class="parent-name" id="guardianName">

                        <label for="guardianOccupation">Occupation:</label>
                        <input readonly type="text" class="parent-occupation" id="guardianOccupation">
                    </div> <br>

                    <div class="student-form-group">
                        <label for="guardianContactNumber">Contact Number:</label>
                        <input readonly type="text" class="guardian-number" id="guardianContactNumber">

                        <label for="guardianAddress">Address:</label>
                        <input readonly type="text" class="guardian-address" id="guardianAddress">
                    </div> <br>

                    <div class="transferee-section" id="transfereeFields">
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>For Transferees Only</h2>
                        </div>
                        <div class="student-form-group">
                            <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                            <input readonly type="text" id="lastGradeLevelCompleted">

                            <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed</label>
                            <input readonly type="text" id="lastMadrasaYearCompleted">
                        </div> <br>

                        <div class="student-form-group">
                            <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                            <input readonly type="text" id="madrasaNameLastAttended">
                        </div> <br>

                        <div class="student-form-group">
                            <label for="madrasaAddress">Madrasa Address:</label>
                            <input readonly type="text" id="madrasaAddress">
                        </div> <br>
                    </div>


                    <div class="report-header">
                        <div class="report-header-item">
                            <h2>Balance Information</h2>
                        </div>
                        <div class="report-header-item">
                            <h2>Resources Distribution</h2>
                        </div>
                    </div>

                    <div class="container-two">
                        <div class="column-main">
                            <p>Remaining Balance</p>
                            <div class="table-container">
                                <table class="mini-table" id="payment-mini-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Req. Amount</th>
                                            <th>Paid</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>

                                <!-- Pagination -->
                                <div class="pagination-container">
                                    <div class="pagination-controls">
                                        <span id="itemRangeUFee">1–10 of 37</span>
                                        <button type="button" id="prevPageUFee">«</button>
                                        <input type="number" id="pageInputUFee" min="1" value="1">
                                        <span id="totalPagesUFee">of 4</span>
                                        <button type="button" id="nextPageUFee">»</button>
                                    </div>
                                </div>
                            </div>

                            <div class="basic-modal-buttons">
                                <h6>Balance:</h6>
                                <h6 id="total-balance">P0</h6>
                                <button type="button" onclick="fetchAllTimeFees()" class="btn-confirm" data-open-modal="viewPastTransactionsModal"
                                    id="transaction-record-btn">View Fully Paid</button>
                            </div>

                        </div>

                        <div class="column-main">
                            <p>Unclaimed Resources</p>
                            <div class="table-container">
                                <table class="mini-table" id="distribution-mini-table">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Grade Level</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                                <!-- Pagination -->
                                <div class="pagination-container">
                                    <div class="pagination-controls">
                                        <span id="itemRangeDistU">1–10 of 37</span>
                                        <button type="button" id="prevPageDistU">«</button>
                                        <input type="number" id="pageInputDistU" min="1" value="1">
                                        <span id="totalPagesDistU">of 4</span>
                                        <button type="button" id="nextPageDistU">»</button>
                                    </div>
                                </div>
                            </div>

                            <div class="basic-modal-buttons">
                                <button onclick="fetchDistributedItems()" type="button" class="btn-confirm" data-open-modal="viewClaimedResourcesModal"
                                    id="unclaimed-resources-btn">View Claimed
                                    Resources</button>
                            </div>
                        </div>
                    </div> <br>


                    <div class="header-stud-info-half">
                        <h2>Grades</h2>
                        <div class="action">
                            <div class="dropdown">

                                <button type="button" class="dropdown-print-btn" onclick="toggleDropdown(event)">
                                    Print
                                    <i class="fas fa-chevron-down"></i>
                                </button>

                                <div class="dropdown-status-content normal-mob-text" id="dropdown-print-options">
                                    <a href="#" class="action" data-open-modal="gradePrintModal">All</a>
                                    <a href="#" class="action" data-open-modal="gradePrintModal">Semester 1</a>
                                    <a href="#" class="action" data-open-modal="gradePrintModal">Semester 2</a>
                                    <a href="#" class="action" data-open-modal="gradePrintModal">School Year
                                        2023-2024</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="grades-container">

                    </div>
                </form>
            </div>

            <!-- Grade Print Modal -->
            <div id="gradePrintModal" class="grade-print-dal modal">
                <div class="printable-area">
                    <div class="grade-print-modal-content scroll-lock">

                        <!-- Report Header -->
                        <div class="header-container-print">

                            <div class="left-header">
                                <img src="/images/al-furqanlogo.jpg" alt="School Logo" class="school-logo-payment">
                            </div>
                            <div class="middle-header">
                                <div class="school-info-print">
                                    <h3 th:text="${schoolName}"></h3>
                                    <p th:text="${schoolAddress}"></p>
                                    <p th:text="${schoolEmail}"></p>
                                    <p th:text="${schoolNum}"></p>
                                    <h3 class="report-type"><strong>Grade Form</strong></h3>
                                </div>
                            </div>
                        </div>

                        <div class="separator-line"></div>
                        <!-- Student Info -->
                        <table border="1" cellspacing="0" cellpadding="6"
                            style="width: 100%; margin-top: -30px; font-family: Arial, sans-serif; border-collapse: collapse;">
                            <!-- Student Info Section -->
                            <tr class="stud-info-section">
                                <td colspan="6">
                                    <div class="student-info-container-printable">
                                        <div class="payment-student-info-row">
                                            <label for="receipt-student-id">Student ID:</label>
                                            <input type="text" class="print-inputs" id="receipt-student-id"
                                                placeholder="">
                                        </div>

                                        <div class="payment-student-info-row">
                                            <label for="receipt-date">Date:</label>
                                            <input type="date" class="print-inputs" id="receipt-date">
                                        </div>

                                        <div class="payment-student-info-row">
                                            <label for="receipt-student-name">Student Name:</label>
                                            <input type="text" class="print-inputs" id="receipt-student-name"
                                                placeholder="">
                                        </div>

                                        <div class="payment-student-info-row">
                                            <label for="sy-and-sem">SY & Sem:</label>
                                            <input type="text" class="print-inputs" id="current-sy-and-sem"
                                                placeholder="">
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <!-- Grade Table Header -->
                            <tr class="grade-header">
                                <th>Subject</th>
                                <th>1st Sem</th>
                                <th>2nd Sem</th>
                                <th>Final</th>
                                <th>Remarks</th>
                            </tr>

                            <!-- Grade Table Rows (No inner borders) -->
                            <tr class="grade-row">
                                <td>READING AND WRITING</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr class="grade-row">
                                <td>PAGBASA AT PAGSUSURI NG IBAT IBANG TEKSTO TUNGO SA P</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr class="grade-row">
                                <td>21ST CENTURY LITERATURE FROM THE PHILIPPINES AND THE W</td>
                                <td>78</td>
                                <td>77</td>
                                <td>77.5</td>
                                <td>Passed</td>
                            </tr>
                            <tr class="grade-row">
                                <td>HOUSEKEEPING</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr class="grade-row">
                                <td>STATISTICS AND PROBABILITY</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr class="grade-row">
                                <td>PHYSICAL EDUCATION AND HEALTH</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr class="grade-row">
                                <td>PHYSICAL SCIENCE</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                        </table>

                        <div class="printable-footer">
                            Date Printed: <strong>4/1/2020</strong>
                        </div>

                        <!-- Print Button -->
                        <div class="modal-buttons">
                            <button type="button" onclick="printReceipt()" class="print-btn">PRINT RECEIPT</button>
                        </div>
                    </div>
                </div>
            </div>

                    <!-- Error Modal -->
            <div id="errorModal" class="modal">
                <div class="modal-content scroll-lock">
                    <p id="errorMessage"></p>
                    <div class="modal-buttons">
                        <button class="error-btn-cancel" data-close-modal="errorModal">Close</button>
                    </div>
                </div>
            </div>
            <!-- Background overlay -->
            <div id="successModalOverlay"></div>

            <!-- Success modal -->
            <div id="successModal">
                <p id="successModalMessage"></p>
            </div>

        </div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const path = window.location.pathname;
        const wordArray = (path.split("/"));
        const studentName = ((wordArray[wordArray.length - 1]));
        findStudent(studentName);
        
        const transfereeCheckbox = document.getElementById("isTransferee");
        const transfereeFields = document.getElementById("transfereeFields");
        const requiredInputs = transfereeFields.querySelectorAll("input, select, textarea");

        transfereeCheckbox.addEventListener("change", function () {
            if (this.checked) {
                fetchTransRequirements();
                transfereeFields.style.display = "block";
                requiredInputs.forEach(input => {
                    input.setAttribute("required", "required");
                });
            } else {
                document.getElementById("transfereeReq").innerHTML = ``;
                transfereeFields.style.display = "none";
                requiredInputs.forEach(input => {
                    input.removeAttribute("required");
                });
            }
        });

        const transfereeEditCheckbox = document.getElementById("isTransferee-edit");
        const transfereeEditFields = document.getElementById("transfereeEditFields");
        const requiredEditInputs = transfereeEditFields.querySelectorAll("input, select, textarea");

        transfereeEditCheckbox.addEventListener("change", function () {
            if (this.checked) {
                transfereeEditFields.style.display = "block";
                requiredEditInputs.forEach(input => {
                    input.setAttribute("required", "required");
                });
            } else {
                transfereeEditFields.style.display = "none";
                requiredEditInputs.forEach(input => {
                    input.removeAttribute("required");
                });
            }
        });
    });
    var student;
    var studentId;
    async function findStudent(studentName) {
        const response = await fetch(`/students/find-student/name/${studentName}`);
        if (!response.ok) { alert("student record no found"); }
        student = await response.json();

        //document.getElementById("stud-type").textContent = student.status;
        document.getElementById("isTransferee").checked = student.transferee;
        if(student.transferee){
            document.getElementById("transfereeFields").style.display = "block";
        }
        document.getElementById("isScholar").textContent =student.discountsAvailed > 0 ? "YES" : "NO";

        document.getElementById("student-id").value = student.studentDisplayId;
        document.getElementById("firstName").value = student.firstName;
        document.getElementById("middleName").value = student.middleName;
        document.getElementById("lastName").value = student.lastName;
        document.getElementById("gender").value = student.gender;
        document.getElementById("birthdate-report").value = student.birthdate;
        document.getElementById("placeOfBirth").value = student.birthPlace;
        document.getElementById("fatherName").value = student.fatherName;
        document.getElementById("fatherOccupation").value = student.fatherOccupation;
        document.getElementById("motherName").value = student.motherName;
        document.getElementById("motherOccupation").value = student.motherOccupation;
        document.getElementById("guardianName").value = student.guardianName;
        document.getElementById("guardianOccupation").value = student.fatherOccupation;
        document.getElementById("guardianContactNumber").value = student.guardianContactNum;
        document.getElementById("guardianAddress").value = student.guardianAddress;

        document.getElementById("street").value = student.address.street;
        document.getElementById("barangay").value = student.address.barangay;
        document.getElementById("city").value = student.address.city;
        document.getElementById("lastGradeLevelCompleted").value = student.currentGradeLevel ? student.currentGradeLevel.levelName : 'None';
        document.getElementById("lastMadrasaYearCompleted").value = student.lastMadrasaYearCompleted;
        document.getElementById("madrasaNameLastAttended").value = student.madrasaName;
        document.getElementById("madrasaAddress").value = student.madrasaAddress;

        setNameIdText();
        fetchTransRequirements(student.transfereeRequirements);
        studentId = student.studentId;
        fetchRemainingFees();
        setStudentGrades();
        setUpDistribution();
        fetchDiscounts(student.discountsAvailed);
    }

    async function setGradeLevels(elementId,selectedLvl){
        const response = await fetch("/gradelevel/all");
        var gradeOption = document.getElementById(elementId);
        gradeOption.innerHTML = "<option value='0'>None</option>";
        if(response.ok){
            const gradeLevels = await response.json();
            gradeLevels.forEach(gradeLevel =>{
                var option = document.createElement("option");
                option.textContent = gradeLevel.levelName;
                option.value = gradeLevel.levelId;
                if(selectedLvl === gradeLevel.levelId){
                    console.log("true");
                    option.selected = true;
                }

                gradeOption.appendChild(option);
            });
        }
    }

    function setUpEditForm(){
        document.getElementById("student-id-edit").value = student.studentDisplayId;
        document.getElementById("isTransferee-edit").checked = student.transferee;
        if(student.transferee){
            document.getElementById("transfereeEditFields").style.display = "block";
        }
        document.getElementById("firstNameEdit").value = student.firstName;
        document.getElementById("middleNameEdit").value = student.middleName;
        document.getElementById("lastNameEdit").value = student.lastName;
        document.getElementById("gender-edit").value = student.gender;
        document.getElementById("birthdate-edit").value = student.birthdate;
        document.getElementById("placeOfBirthEdit").value = student.birthPlace;
        document.getElementById("fatherNameEdit").value = student.fatherName;
        document.getElementById("fatherOccupationEdit").value = student.fatherOccupation;
        document.getElementById("motherNameEdit").value = student.motherName;
        document.getElementById("motherOccupationEdit").value = student.motherOccupation;
        document.getElementById("guardianNameEdit").value = student.guardianName;
        document.getElementById("guardianOccupationEdit").value = student.fatherOccupation;
        document.getElementById("guardianContactNumberEdit").value = student.guardianContactNum;
        document.getElementById("guardianAddressEdit").value = student.guardianAddress;

        document.getElementById("street-edit").value = student.address.street;
        document.getElementById("barangay-edit").value = student.address.barangay;
        document.getElementById("city-edit").value = student.address.city;
        setGradeLevels("lastGradeLevelCompletedEdit",(student.lastGradeLevelCompleted ? student.lastGradeLevelCompleted.levelId : 0));
        document.getElementById("lastMadrasaYearCompletedEdit").value = student.lastMadrasaYearCompleted;
        document.getElementById("madrasaNameLastAttendedEdit").value = student.madrasaName;
        document.getElementById("madrasaAddressEdit").value = student.madrasaAddress;
    }

    async function setStudentGrades() {
        const response = await fetch(`/student-grades/student/${studentId}`);
        if (!response.ok) { return; }

        const grades = await response.json();
        const gradesview = document.getElementById("grades-container");
        gradesview.innerHTML = ""; // clear previous content
        if (!grades || grades.length === 0) {
            gradesview.innerHTML = `
            <div class="no-records-message">
                <p>No grade records found for this student.<p>
            </div>`;
            return;
        }

        for (let i = 0; i < grades.length; i += 2) {
            const containerTwo = document.createElement("div");
            containerTwo.classList.add("container-two");

            for (let j = i; j < i + 2 && j < grades.length; j++) {
                const sem = grades[j];
                let allFilled = true;
                let gradesRow = '';
                let totalGrade = 0;
                let count = 0;

                sem.grades.forEach(grade => {
                    if (allFilled) {
                        allFilled = grade.subjectGrade;
                    }
                    totalGrade += grade.subjectGrade;
                    count++;
                    gradesRow += `
            <tr>
                <td>${grade.subjectName}</td>
                <td>${grade.subjectGrade ? grade.subjectGrade : ""}</td>
                <td>
                    <div class="status-container">
                        <div class="status" id="grade-remarks">
                            ${!grade.subjectGrade ? "" : grade.subjectGrade > 49 ? "PASSED" : "FAILED"}
                        </div>
                    </div>
                </td>
            </tr>`;
                });

                const average = totalGrade / count;

                const semesterFormatted = sem.sectionSemester.includes("First semester")
                    ? sem.sectionSemester.replace("First semester", "1st Sem")
                    : sem.sectionSemester.includes("Second semester")
                        ? sem.sectionSemester.replace("Second semester", "2nd Sem")
                        : sem.sectionSemester;

                const columnMain = document.createElement("div");
                columnMain.classList.add("column-main");

                columnMain.innerHTML = `
            <div class="table-container">
                <div style="display: flex; justify-content: space-between;">
                    <div class="grade-table-header">
                        <div>
                            <label>SY & Sem:</label>
                            <h6 id="sy">${semesterFormatted}</h6>
                        </div>
                        <div>
                            <label>Level:</label>
                            <h6>${sem.gradeSection}</h6>
                        </div>
                    </div>
                </div> <br>
                <table class="grades-mini-table" id="grades-mini-table">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Grade</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${gradesRow}
                        <tr id="average-row">
                            <td>Average</td>
                            <td>${allFilled ? average : ""}</td>
                            <td>
                                <div class="status-container">
                                    <div class="status">
                                        <div class="average-remarks">
                                            ${average === "N/A" || !allFilled ? "" : (average > 49 ? "PASSED" : "FAILED")}
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;

                containerTwo.appendChild(columnMain);
            }

            gradesview.appendChild(containerTwo);
            gradesview.appendChild(document.createElement("br")); // Optional line break
        }

    }

    async function updateStudentRecord(){
        const form = document.getElementById('studentInformationFormEdit');

        const formData = new FormData(form);

        // Get all data as an object
        const formDataObject = Object.fromEntries(formData.entries());
        formDataObject.address = {
            street: form.elements['street'].value,
            barangay : form.elements['barangay'].value,
            city : form.elements['city'].value
        };

        formDataObject.transferee = form.elements[`amITransferee`].value === "on";

        const response = await fetch(`/students/update/${studentId}`,{
            method : "PUT",
            headers : { "Content-Type": "application/json" },
            body : JSON.stringify(formDataObject)
        });

        const msgresult = await response.text();
        if(response.ok){
            showSuccessModal("Student Profile Updated Successfully",false);
            setTimeout(() => {
                window.location.href=`/reports/student/${msgresult}`;
            }, 2000);
        }else{
            showErrorModal(msgresult);
        }
    }

    var currentDisPage;
    async function setUpDistribution(currentPage = 1) {
        try {
            const claimed = false;
            currentDisPage = currentPage;
            const response = await fetch(`/distributable/student-distribution/all?pageSize=3&pageNo=${currentPage}&isClaimed=false&student=${student.fullName}&itemType=0&sortBy=none`);
            if (!response.ok) {
                updatePaginationUI("DistU",1,0,0,0);
                return;
            }

            const data = await response.json();

            const tableBody = document.querySelector("#distribution-mini-table tbody");
            if (!tableBody) {
                updatePaginationUI("DistU",1,0,0,0);
                return;
            }

            // Clear existing rows
            tableBody.innerHTML = '';

            if (!data.content || data.content.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="2">No records found</td></tr>`;
                updatePaginationUI("DistU",1,0,0,0);
                return;
            }

            const fragment = document.createDocumentFragment();

            data.content.forEach(studDis => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${studDis.itemName || 'N/A'}</td>
                    <td>${studDis.gradeLevel?.levelName || 'N/A'}</td>`;
                fragment.appendChild(row);
            });
            tableBody.appendChild(fragment);
            updatePaginationUI("DistU",currentDisPage,data.pageSize,data.totalElements,data.totalPages);

        } catch (error) {
            const tableBody = document.querySelector("#table-ko tbody");
            if (tableBody) {
                tableBody.innerHTML = `<tr><td colspan="6">Error loading data. Please try again.</td></tr>`;
            }
        }
    }

    var selectedDistId;
    document.body.addEventListener("click", function (event) {
        const target = event.target.closest("[data-open-modal='confirmationModal']");
        if (target) {
            selectedDistId = target.getAttribute("data-item-id");
        }
    });

    async function fetchAllTimeFees(currentPage=1) {
        const feesTable = document.querySelector("#past-trans-table tbody");
        const response = await fetch(`/paymentrecord/form/${studentId}?forBreakDown=true&pageNo=${currentPage}&pageSize=7`);
        if (!response.ok) { 
            updatePaginationUI("PFee",1,0,0,0);
            return; }

        const remainingFees = await response.json();

        feesTable.innerHTML = `<tr><td colspan="4">No records found</td></tr>`;
        if (remainingFees.content.length === 0) { 
            updatePaginationUI("PFee",1,0,0,0);
            return; }
        feesTable.innerHTML = ``;
        remainingFees.content.forEach(data => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${data.fee.name}</td>
                <td>${data.totalRequired}</td>
                <td>${data.totalPaid}</td>
                <td>
                    <div class="status-container">
                        <div class="status" id="status-payments">${data.totalPaid > 0 && data.totalPaid<data.totalRequired ? "Partially Paid" :
                                                                    data.balance === 0 ? "Fully Paid" : data.balance<0 ? "For Refund" :"Not Paid"}</div>
                    </div>
                </td>`;
            feesTable.appendChild(row);
            updatePaginationUI("PFee",currentPage,remainingFees.pageSize,remainingFees.totalElements,remainingFees.totalPages);
        });
    }

    function setNameIdText(){
        document.getElementById("studName").innerHTML=`<a href="/reports/student/${student.fullName}" id="studName" title="You're currently on this page.">${student.fullName}</a>`;
        document.getElementById("student-grade-id").textContent=student.studentDisplayId;
        document.getElementById("student-grade-name").textContent=student.fullName;
        document.getElementById("student-resources-name").textContent=student.studentDisplayId;
        document.getElementById("student-resources-id").textContent=student.fullName;
        document.getElementById("total-balance").textContent = `₱${student.balanceAmount}`;
    }

    //go here
    async function fetchDistributedItems(currentPage=1){
        const response = await fetch(`/distributable/student-distribution/all?pageSize=10&isClaimed=true&student=${student.fullName}&pageNo=${currentPage}&itemType=0&sortBy=none`);
        if(response.ok){
            const distributed = await response.json();
            var claimedTable = document.querySelector("#claimed-res-table tbody")
            claimedTable.innerHTML = "<tr><td colspan='3'>No records found.</td></tr>";
            if(distributed.content.length === 0){
                updatePaginationUI("DistC",1,0,0,0);
                return;
            }
            claimedTable.innerHTML="";
            const fragment = document.createDocumentFragment();
            distributed.content.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${item.itemName || 'N/A'}</td>
                    <td>${item.gradeLevel?.levelName || 'N/A'}</td>
                    <td>${item.dateReceived || 'N/A'}</td>`;
                fragment.appendChild(row);
            });
            claimedTable.appendChild(fragment);
            updatePaginationUI("DistC",distributed.pageNo,distributed.pageSize,distributed.totalElements,distributed.totalPages);
        }
    }

    async function fetchRemainingFees(currentPage=1) {
        const feesTable = document.querySelector("#payment-mini-table tbody");
        const response = await fetch(`/paymentrecord/form/${studentId}?pageNo=${currentPage}`);
        if (!response.ok) { 
            updatePaginationUI("UFee",1,0,0,0);
            return; }

        const remainingFees = await response.json();
        console.log(remainingFees);

        feesTable.innerHTML = `<tr><td colspan="5">No records found</td></tr>`;
        if (remainingFees.content.length === 0) { 
            updatePaginationUI("UFee",1,0,0,0);
            return; }
        feesTable.innerHTML = ``;
        remainingFees.content.forEach(data => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${data.fee.name}</td>
                <td>${data.totalRequired}</td>
                <td>${data.totalPaid}</td>
                <td><span>P</span>${data.balance}</td>
                <td>
                    <div class="status-container">
                        <div class="status" id="status-payments">${data.totalPaid > 0 ? "Partially Paid" : "Not Paid"}</div>
                    </div>
                </td>`;
            feesTable.appendChild(row);
            updatePaginationUI("UFee",currentPage,remainingFees.pageSize,remainingFees.totalElements,remainingFees.totalPages);
        });
    }

    function updateRequirements() {
        const selectedTransReq = [];
        document.querySelectorAll("#transfereeReq input[name='transferRequirements']:checked").forEach(checkbox => {
            selectedTransReq.push(checkbox.value);
        });
        fetch(`/trans-req/add/student-requirements/${studentId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ids: selectedTransReq
            }),
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        showSuccessModal(message);
                    } else {
                        showErrorModal(message); // Show the error message if the response is not ok
                    }
                });
            })
            .catch(error => {
                showErrorModal(error.message || "An unexpected error occurred."); // Show an error modal in case of failure
            });
    }

    function updateDiscounts() {
        const selectedTransReq = [];
        document.querySelectorAll("#discounts-rec input[name='studDiscounts']:checked").forEach(checkbox => {
            selectedTransReq.push(checkbox.value);
        });
        alert(selectedTransReq+" ang sulod");
        fetch(`/discounts/add-student-discounts/${studentId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ids: selectedTransReq
            }),
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        showSuccessModal(message);
                    } else {
                        showErrorModal(message); // Show the error message if the response is not ok
                    }
                });
            })
            .catch(error => {
                showErrorModal(error.message || "An unexpected error occurred."); // Show an error modal in case of failure
            });
    }

    function fetchDiscounts(discIds = [], popoverId = "discounts-rec") {
        const popover = document.getElementById(popoverId);
        if (!popover) return //console.error(`Element with ID ${popoverId} not found.`);

        popover.innerHTML = ``;

        fetch("/discounts/all")
            .then(response => response.json())
            .then(data => {
                // Create and append the heading
                const heading = document.createElement("h6");
                heading.textContent = "Scholarship Types:";
                popover.appendChild(heading);

                const discountWrapper = document.createElement("div");
                discountWrapper.classList.add("checkbox-container-popover");

                data.forEach(disc => {
                    const paymentDiv = document.createElement("div");
                    paymentDiv.classList.add("checkbox-each");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `disc-${disc.discountId}`;
                    checkbox.name = "studDiscounts";
                    checkbox.value = disc.discountId;

                    const label = document.createElement("label");
                    label.htmlFor = `disc-${disc.discountId}`;
                    label.textContent = disc.discountName;

                    if (discIds.includes(disc.discountId)) {
                        checkbox.checked = true;
                    }

                    paymentDiv.appendChild(checkbox);
                    paymentDiv.appendChild(label);
                    discountWrapper.appendChild(paymentDiv);
                });

                popover.appendChild(discountWrapper);
            })
            .catch(error => console.error("Error fetching discounts:", error));
    }

    function fetchTransRequirements(reqIds = [],divId = "transfereeReq") {
        fetch("/trans-req/all")
            .then(response => response.json())
            .then(data => {
                const reqContainer = document.getElementById(divId);
                reqContainer.innerHTML = "";
                data.forEach(transReq => {
                    const paymentDiv = document.createElement("div");
                    paymentDiv.classList.add("checkbox-each");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `transReq-${transReq.levelId}`;
                    checkbox.name = "transferRequirements";
                    checkbox.value = transReq.id;

                    const label = document.createElement("label");
                    label.htmlFor = `transReq-${transReq.idd}`;
                    label.textContent = transReq.name;

                    if (reqIds.includes(transReq.id)) {
                        checkbox.checked = true;
                    }

                    paymentDiv.appendChild(checkbox);
                    paymentDiv.appendChild(label);
                    reqContainer.appendChild(paymentDiv);
                });
            })
            .catch(error => console.error("Error fetching grade levels:", error));
    }

    function updatePaginationUI(paginationKey, currentPage, pageSize, totalItems, totalPages) {
        const config = paginationConfigs[paginationKey];
        if (!config) return;

        const { elements } = config;
        const start = totalItems === 0 ? 0 : (currentPage - 1) * pageSize + 1;
        const end = Math.min(currentPage * pageSize, totalItems);

        // Update UI elements
        document.getElementById(elements.itemRange).textContent = `${start}–${end} of ${totalItems}`;
        document.getElementById(elements.pageInput).value = currentPage;
        document.getElementById(elements.pageInput).min = 1;
        document.getElementById(elements.pageInput).max = totalPages;
        document.getElementById(elements.totalPages).textContent = `of ${totalPages}`;

        // Update button states
        document.getElementById(elements.prevPage).disabled = currentPage <= 1 || totalPages === 0;
        document.getElementById(elements.nextPage).disabled = currentPage >= totalPages || totalPages === 0;

        // Update current page in config
        config.currentPage = currentPage;
    }

const paginationConfigs = {
    'DistU': {
        currentPage: 1,
        setUpFunction: setUpDistribution,
        elements: {
            itemRange: "itemRangeDistU",
            pageInput: "pageInputDistU",
            totalPages: "totalPagesDistU",
            prevPage: "prevPageDistU",
            nextPage: "nextPageDistU"
        }
    },
    'DistC': {
        currentPage: 1,
        setUpFunction: fetchDistributedItems,
        elements: {
            itemRange: "itemRangeDistC",
            pageInput: "pageInputDistC",
            totalPages: "totalPagesDistC",
            prevPage: "prevPageDistC",
            nextPage: "nextPageDistC"
        } 
    },    
    'UFee': {
        currentPage: 1,
        setUpFunction: fetchRemainingFees,
        elements: {
            itemRange: "itemRangeUFee",
            pageInput: "pageInputUFee",
            totalPages: "totalPagesUFee",
            prevPage: "prevPageUFee",
            nextPage: "nextPageUFee"}
    },
    'PFee': {
        currentPage: 1,
        setUpFunction: fetchAllTimeFees,
        elements: {
            itemRange: "itemRangePFee",
            pageInput: "pageInputPFee",
            totalPages: "totalPagesPFee",
            prevPage: "prevPagePFee",
            nextPage: "nextPagePFee"}
    }
};

function initializePaginationListeners() {
    Object.keys(paginationConfigs).forEach(key => {
        const config = paginationConfigs[key];
        const { elements, setUpFunction } = config;

        // Previous page button
        document.getElementById(elements.prevPage).addEventListener("click", () => {
            if (config.currentPage > 1) {
                config.currentPage--;
                setUpFunction(config.currentPage);
            }
        });

        // Next page button
        document.getElementById(elements.nextPage).addEventListener("click", () => {
            const totalPages = parseInt(document.getElementById(elements.pageInput).max);
            if (config.currentPage < totalPages) {
                config.currentPage++;
                setUpFunction(config.currentPage);
            }
        });

        // Page input change
        document.getElementById(elements.pageInput).addEventListener("change", (e) => {
            const totalPages = parseInt(document.getElementById(elements.pageInput).max);
            let page = parseInt(e.target.value);
            if (page >= 1 && page <= totalPages) {
                config.currentPage = page;
                setUpFunction(config.currentPage);
            } else {
                e.target.value = config.currentPage;
            }
        });
    });
}   
document.addEventListener("DOMContentLoaded", initializePaginationListeners);
</script>

</html>