<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head th:replace="~{fragments/fragment :: commonHead}">
</head>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/sidebar.js}"></script>

<body>
    <!-- Sidebar (ADMIN) -->
    <div th:replace="~{fragments/fragment :: sidebar}"></div>

    <!-- Topbar with Hamburger & User Icon -->
    <div class="dashboard-container" id="content">
        <div class="sticky-header">
            <!-- Topbar -->
            <div th:replace="~{fragments/fragment :: topbar}"></div>

            <!-- Overlay -->
            <div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

            <div class="text-link" id="breadcrumb-container">
                <h4>Listing</h4>
                <a href="/home">Main</a>
                <p>/</p>
                <a href="/enrollment/listing" title="You're currently in this page.">Enrollment - Listing</a>
            </div>

            <div class="search-div">
                <!-- Searchbox and sort btn -->
                <div class="left-section">
                    <div class="search-container">
                        <input type="text" id="search-stud" placeholder="Search..." class="search-input" />
                        <button type="button" onclick="goList(1)" class="search-btn">Search</button>
                    </div>

                    <!-- Three-dot menu (hidden on desktop, shown on mobile) -->
                    <div class="menu-container">
                        <button type="button" class="menu-btn" aria-label="More options">
                            <span class="menu-icon">⋮</span>
                        </button>
                        <div class="menu-dropdown">
                            <button type="button" class="menu-item" data-open-modal="newStudentModal"
                                title="Add New Student">Add New Student</button>
                            <div class="menu-sort-container">
                                <select title="sort" name="sort" onchange="goList(1)" id="sort-select"
                                    class="sort-select">
                                    <option value="All" selected>All</option>
                                    <option value="Listing">Listing</option>
                                    <option value="Assessment">Assessment</option>
                                    <option value="Payment">Payment</option>
                                    <option value="Enrolled">Enrolled</option>
                                    <option value="Not_registered">Not listed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Enrollment Buttons -->
                    <div class="enrollment-buttons">
                        <button type="button" class="btn-confirm" data-open-modal="newStudentModal"
                            title="Add New Student">Add New Student</button>
                    </div>
                </div>

                <div class="sort-container">
                    <select title="sort" name="sort" onchange="goList(1)" id="sort-select" class="sort-select">
                        <option value="All" selected>All</option>
                        <option value="Listing">Listing</option>
                        <option value="Assessment">Assessment</option>
                        <option value="Payment">Payment</option>
                        <option value="Enrolled">Enrolled</option>
                        <option value="Not_registered">Not listed</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="table-wrapper">
            <!-- Table -->
            <table id="lamesa" class="listing-table main-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Student Name</th>
                        <th>Enrolling to</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-controls">
                <span id="itemRange">1–10 of 37</span>
                <select id="pageSizeSelector">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                </select>
                <button type="button" id="prevPage">«</button>
                <input type="number" id="pageInput" min="1" value="1">
                <span id="totalPages">of 4</span>
                <button type="button" id="nextPage">»</button>
            </div>
        </div>

        <!-- Modal for student information -->
        <div id="studentInformationModal" class="student-information-modal modal">
            <div class="student-information-modal-content scroll-lock">
                <div class="modal-body">
                    <h1>Student Information</h1>
                    <form method="" action="" id="studentInformationForm">
                        <div class="header">
                            <div class="half-unique">
                                <label for="student-id">Student ID: </label>
                                <input type="text" readonly class="student-id-report" id="student-id">
                            </div> <br>

                            <div class="other-info-container">
                                <div class="half-other-info" id="stud-type-row">
                                    <label for="stud-type">Student Type:</label>
                                    <h6 id="stud-type">New</h6>
                                </div>
                                <div class="checkbox-container">
                                    <div class="checkbox">
                                        <label for="scholar">Scholar:</label>
                                        <h6 id="isScholar">Yes</h6>

                                        <button type="button" id="dropdown-scholar"> <img
                                                src="/images/icons/arrow-down.png" alt="dropdown-icon">
                                        </button>

                                        <div id="scholar-popover" name="add-discount" class="styled-popover">
                                            <div id="discounts-rec" class="checkbox-transferee-reqs-group">
                                                <!--Ibutang ang mga transferee requiremetns dri-->
                                            </div> <br>
                                            <div>
                                                <button type="button" style="width: 100%;"
                                                    data-open-modal="confirmationModal" data-action="editDiscounts"
                                                    data-message="Are you sure you want to update the student discounts?"
                                                    class="btn-confirm">Update</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="checkbox">
                                        <label for="isTransferee">Transferee:</label>
                                        <input type="checkbox" id="isTransferee">

                                        <button type="button" id="dropdown-transferee"> <img
                                                src="/images/icons/arrow-down.png" alt="dropdown-icon">
                                        </button>

                                        <!-- Popover lives right below the button now -->
                                        <div id="transferee-popover" name="add-transferee-req" class="styled-popover">
                                            <!-- Transferee Requirements Section -->
                                            <div class="transferee-requirements">
                                                <h6>Requirements:</h6>
                                                <div id="transfereeReq-rec" class="checkbox-transferee-reqs-group">
                                                    <!--Ibutang ang mga transferee requiremetns dri-->
                                                </div> <br>

                                                <!-- Update Button -->
                                                <div>
                                                    <button type="button" style="width: 100%;"
                                                        data-open-modal="confirmationModal"
                                                        data-action="updateRequirements"
                                                        data-message="Are you sure you want to update the transferee requirements?"
                                                        class="btn-confirm">Update</button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left;">
                            <h2>Personal Information</h2>
                        </div>

                        <div class="container">
                            <div class="row">
                                <div class="column1">
                                    <div>
                                        <label for="name">Name</label>
                                        <div class="student-form-group">
                                            <div class="input-label-pair">
                                                <input readonly type="text" id="firstName">
                                                <p class="small-text first-name-p">First</p>
                                            </div>
                                            <div class="input-label-pair">
                                                <input readonly type="text" id="middleName">
                                                <p class="small-text middle-name-p">Middle</p>
                                            </div>
                                            <div class="input-label-pair">
                                                <input readonly type="text" id="lastName">
                                                <p class="small-text last-name-p">Last</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="column2">
                                    <div class="student-form-group">

                                        <label for="gender">Gender:</label>
                                        <input readonly type="text" class="gender" id="gender">

                                        <label for="birthdate">Birthdate:</label>
                                        <input type="date" class="birthdate" id="birthdate" readonly>

                                    </div>
                                </div>

                                <div class="column1">
                                    <div>
                                        <div class="student-form-group">
                                            <div>
                                                <label for="address">Address:</label>
                                                <div class="student-form-group address-div half-unique">
                                                    <input readonly type="text" class="address" id="street" required
                                                        placeholder="Street">
                                                    <input readonly type="text" class="address" id="barangay" required
                                                        placeholder="Barangay">
                                                    <input readonly type="text" class="address" id="city" required
                                                        placeholder="City">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="column2">
                                    <label>Place of Birth:</label>
                                    <div class="student-form-group">
                                        <input readonly type="text" id="placeOfBirth" class="place-of-birth">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>Additional Information</h2>
                        </div>

                        <div>
                            <h6>Father's Information</h6>
                            <div class="student-form-group address-div">
                                <label for="fatherName">Name:</label>
                                <input readonly type="text" class="parent-name" id="fatherName">

                                <label for="fatherOccupation">Occupation:</label>
                                <input readonly type="text" class="parent-occupation" id="fatherOccupation">
                            </div> <br>
                        </div>
                        <div>
                            <h6>Mother's Information</h6>
                            <div class="student-form-group address-div">
                                <label for="motherName">Name:</label>
                                <input readonly type="text" class="parent-name" id="motherName">

                                <label for="motherOccupation">Occupation:</label>
                                <input readonly type="text" class="parent-occupation" id="motherOccupation">
                            </div> <br>
                        </div>

                        <h6>Guardian's Information</h6>
                        <div class="student-form-group address-div">
                            <label for="guardianName">Name:</label>
                            <input readonly type="text" class="parent-name" id="guardianName">

                            <label for="guardianOccupation">Occupation:</label>
                            <input readonly type="text" class="parent-occupation" id="guardianOccupation">
                        </div> <br>

                        <div class="student-form-group address-div">
                            <label for="guardianContactNumber">Contact Number:</label>
                            <input readonly type="text" class="guardian-number" id="guardianContactNumber">

                            <label for="guardianAddress">Address:</label>
                            <input readonly type="text" class="guardian-address" id="guardianAddress">
                        </div> <br>


                        <div class="transferee-section">
                            <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                                <h2>For Transferees Only</h2>
                            </div>

                            <div class="student-form-group">
                                <label for="lastGradeLevelCompleted">Last Grade Level Completed:</label>
                                <input readonly type="text" id="lastGradeLevelCompleted">

                                <label for="lastMadrasaYearCompleted">Last Madrasa Year Completed:</label>
                                <input readonly type="text" id="lastMadrasaYearCompleted">
                            </div> <br>

                            <div class="student-form-group">
                                <label for="madrasaNameLastAttended">Madrasa Name Last Attended:</label>
                                <input readonly type="text" id="madrasaNameLastAttended">
                            </div> <br>

                            <div class="student-form-group">
                                <label for="madrasaAddress">Madrasa Address:</label>
                                <input readonly type="text" id="madrasaAddress">
                            </div> <br>
                        </div>
                    </form>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" data-close-modal="studentInformationModal">Close</button>
                </div>
            </div>
            </form>
        </div>
    </div>

    <!-- Modal for confirmation -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content scroll-lock">
            <p id="modalText"></p>
            <div class="confirmation-modal-buttons">
                <button type="button" id="confirmAction" class="btn-confirm">Confirm</button>
                <button type="button" class="btn-close-confirm" data-close-modal="confirmationModal">Cancel</button>
            </div>
        </div>
    </div>


    <!-- Modal for adding a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content scroll-lock">
            <div class="modal-body">
                <h2>Promote To</h2>

                <label for="grade-level">Grade Level:</label>
                <input type="text" id="grade-level" readonly>

                <label for="section">Section:</label>
                <select name="section" id="section">
                    <option value="" disabled selected>Choose</option>
                </select>


                <div class="modal-buttons"
                    style="display: flex;justify-content: center;align-items: center;gap: 24px;margin-top: 1rem;flex-wrap: wrap;width: 100%;">
                    <button type="button" class="btn-cancel"
                        data-close-modal="addGradeLevelAssessmentModal">Cancel</button><button type="button"
                        class="btn-confirm" data-action="proceedToPayment"
                        data-message="Are you sure you want to proceed with payment?"
                        data-open-modal="confirmationModal" title="Confirm Button">
                        Confirm
                    </button>

                </div>

            </div>
        </div>
    </div>

    <!-- Modal for listOfPaymentsModal -->
    <div id="listOfPaymentsModal" class="list-of-payments-modal modal">
        <div class="list-of-payments-modal-content scroll-lock">
            <div class="modal-body">
                <h2>List of Payments</h2>

                <div class="half-width">
                    <label for="student-id-list">Student ID:</label>
                    <h6 id="student-id-list"></h6>
                </div>
                <div class="half-width">
                    <label for="student-name">Student Name:</label>
                    <h6 id="student-name"></h6>
                </div> <br>

                <!-- List of Payments Table -->
                <div class="table-wrapper-modal">
                    <table id="table-ni-kharl" class="view-list-of-payments-table main-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Req. Amount</th>
                                <th>Amount Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Add Payment button -->
            <div class="modal-buttons" id="add-payment-btn">
                <button type="button" class="btn-confirm" data-open-modal="addPaymentModal">Add
                    Payment</button>
                <button type="button" class="btn-cancel" data-close-modal="listOfPaymentsModal">Close</button>
            </div>
        </div>
    </div>


    <!-- Modal for listing add grade level -->
    <div id="gradeLevelModal" class="grade-level-modal modal">
        <div class="grade-level-modal-content scroll-lock">
            <div class="modal-body">
                <h2>Enroll To</h2>
                <form method="post" action="/gradelevelmaintenance/add" id="gradeLevelForm">
                    <label for="levelName">Grade Level Name:</label>
                    <select name="levelName" id="levelName">
                        <option value="" disabled>Choose a Grade Level</option>
                    </select>
                    <br><br>
                    <div class="modal-buttons">
                        <button type="button" class="btn-confirm" data-action="proceedAssessment"
                            data-message="Are you sure you want to proceed this registration from Listing to Assessment?"
                            id="confirmGradeLevel" data-open-modal="confirmationModal">
                            Confirm
                        </button>
                        <button type="button" class="btn-cancel" data-close-modal="gradeLevelModal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content scroll-lock">
            <p id="errorMessage"></p>
            <div class="modal-buttons">
                <button type="button" class="error-btn-cancel" data-close-modal="errorModal">Close</button>
            </div>
        </div>
    </div>

    <!-- Background overlay -->
    <div id="successModalOverlay"></div>

    <!-- Success modal -->
    <div id="successModal">
        <p id="successModalMessage"></p>
    </div>


    <!-- Modal for adding a a section to what grade level it will be enrolled to (assessment) -->
    <div id="addGradeLevelAssessmentModal" class="add-grade-level-assessment-modal modal">
        <div class="add-grade-level-assessment-modal-content scroll-lock">

            <h2>Promote To</h2>

            <label for="grade-level">Grade Level:</label>
            <input type="text" id="grade-level" readonly>

            <label for="section">Section:</label>
            <select name="section" id="section">
                <option value="" disabled selected>Choose</option>
            </select>


            <div class="modal-buttons">
                <button type="button" class="btn-confirm" data-action="proceedToPayment"
                    data-message="Are you sure you want to proceed with payment?" id=""
                    data-open-modal="confirmationModal">
                    Confirm
                </button>
                <button type="button" class="btn-cancel" data-close-modal="addGradeLevelAssessmentModal">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing grades -->
    <div id="viewGradesModal" class="view-grades-modal modal">
        <div class="view-grades-modal-content scroll-lock">
            <div class="modal-body">
                <h2>Student Grades</h2>

                <div class="half-width view-studId" id="view-grade-studId">
                    <label for="student-grade-id">Student ID:</label>
                    <h6 id="student-grade-id"></h6>
                </div>
                <div class="half-width view-studName" id="view-grade-studName">
                    <label for="student-grade-name">Student Name:</label>
                    <h6 id="student-grade-name">Martin Francisco</h6>
                </div> <br>

                <!-- Grades Table -->
                <div id="preRequisite-grades"></div>
            </div>

            <!-- Close button -->
            <div class="modal-buttons">
                <button type="button" data-close-modal="viewGradesModal" class="btn-cancel"
                    id="close-button">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for New/Transferee Student Enrollment -->
    <div id="newStudentModal" class="student-modal modal">
        <div class="student-modal-content scroll-lock">
            <div class="modal-body">
                <h1>Student Information</h1>
                <form id="studentForm">
                    <div class="header">
                        <h5>Personal Information</h5>
                    </div>

                    <div class="student-form-group address-div fullName">
                        <div>
                            <label for="studentFirstName">First Name:</label>
                            <input type="text" name="firstname" class="name" id="studentFirstName" required>
                        </div>
                        <div>
                            <label for="studentMiddleName">Middle Name:</label>
                            <input type="text" name="middlename" class="name" id="studentMiddleName"
                                placeholder="Optional">
                        </div>
                        <div>
                            <label for="studentLastName">Last Name:</label>
                            <input type="text" name="lastname" class="name" id="studentLastName" required>
                        </div>
                    </div> <br>

                    <div class="student-form-group address-div">
                        <label for="gender">Gender:</label>
                        <select id="studgender" required>
                            <option value="" disabled selected>Select Gender</option>
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>

                        <label for="birthdate">Birthdate:</label>
                        <input type="date" id="studbirthdate" required>

                        <div class="checkbox-container">
                            <div class="checkbox">
                                <label for="scholar">Scholar:</label>
                                <input type="checkbox" id="scholar">

                                <button type="button" id="dropdown-add-scholar"> <img src="/images/icons/arrow-down.png"
                                        alt="dropdown-icon">
                                </button>

                                <!-- Popover lives right below the button now -->
                                <div id="add-scholar-popover" name="add-discount" class="styled-popover">
                                </div>
                            </div>

                            <div class="checkbox">
                                <label for="isTransfereeRec">Transferee:</label>
                                <input type="checkbox" id="isTransfereeRec">

                                <button type="button" id="dropdown-add-transferee"> <img
                                        src="/images/icons/arrow-down.png" alt="dropdown-icon">
                                </button>

                                <!-- Popover lives right below the button now -->
                                <div id="add-transferee-popover" name="add-transferee-req" class="styled-popover">
                                    <!-- Transferee Requirements Section -->
                                    <div class="transferee-requirements">
                                        <div id="transfereeReq" class="checkbox-transferee-reqs-group">
                                            <!--Ibutang ang mga transferee requiremetns dri-->
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div> <br>

                    <div class="student-form-group">
                        <label>Place of Birth:</label>
                        <input required type="text" id="studplaceOfBirth" class="place-of-birth">
                    </div> <br>

                    <div>
                        <label for="studaddress">Address:</label>
                        <div id="studaddress" class="student-form-group address-div">
                            <input type="text"  id="studstreet" required placeholder="Street">
                            <input type="text"  id="studbarangay" required placeholder="Barangay">
                            <input type="text"  id="studcity" required placeholder="City">
                        </div>
                    </div> <br> <br>

                    <h5>Parent's/Guardian's Information</h5>

                    <h6>Father's Information</h6>
                    <div class="student-form-group address-div">
                        <label for="studfatherName">Name:</label>
                        <input required type="text" name="fatherName" class="parent-name" id="studfatherName">

                        <label for="studfatherOccupation">Occupation:</label>
                        <input required type="text" class="parent-occupation" id="studfatherOccupation">
                    </div> <br>

                    <h6>Mother's Information</h6>
                    <div class="student-form-group address-div">
                        <label for="studmotherName">Name:</label>
                        <input required type="text" class="parent-name" id="studmotherName">

                        <label for="studmotherOccupation">Occupation:</label>
                        <input required type="text" class="parent-occupation" id="studmotherOccupation">
                    </div> <br>

                    <h6>Guardian's Information</h6>
                    <div class="student-form-group address-div">
                        <label for="studguardianName">Name:</label>
                        <input required type="text" class="parent-name" id="studguardianName">

                        <label for="studguardianOccupation">Occupation:</label>
                        <input required type="text" class="parent-occupation" id="studguardianOccupation">
                    </div> <br>

                    <div class="student-form-group address-div">
                        <label for="studguardianContactNumber">Contact Number:</label>
                        <input required type="text" class="guardian-number" id="studguardianContactNumber">

                        <label for="studguardianAddress">Address:</label>
                        <input required type="text" class="guardian-address" id="studguardianAddress">
                    </div> <br>

                    <!-- Transferee Fields -->
                    <div class="transferee-section" id="transfereeFields">
                        <div style="display: flex; align-content: center; justify-items: left; margin-top: 20px;">
                            <h2>For Transferees Only</h2>
                        </div>

                        <div class="transferee-requirements">
                            <div class="student-form-group">
                                <label for="lastGradeLevelIdCompleted">Last Grade Level Completed:</label>
                                <select id="lastGradeLevelIdCompleted" class="lastGradeLevelCompletedSelect">
                                </select>

                                <label for="studlastMadrasaYearCompleted">Last Madrasa Year Completed:</label>
                                <input type="text" id="studlastMadrasaYearCompleted">

                            </div> <br>

                            <div class="student-form-group">
                                <label for="studmadrasaNameLastAttended">Madrasa Name Last Attended:</label>
                                <input type="text" id="studmadrasaNameLastAttended">
                            </div> <br>

                            <div class="student-form-group">
                                <label for="studmadrasaAddress">Madrasa Address:</label>
                                <input type="text" id="studmadrasaAddress">
                            </div> <br>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-buttons">
                <button type="button" class="btn-confirm" id="confirmStudent" data-open-modal="confirmationModal"
                    data-message="Are you sure you want to add this student?">Confirm</button>

                <button type="button" class="btn-cancel" id="cancelStudent"
                    data-close-modal="newStudentModal">Cancel</button>
            </div>

        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="receipt-modal modal">
        <div class="printable-area">
            <div class="receipt-modal-content scroll-lock">
                <!-- Receipt Header -->
                <div class="header-container-payment">
                    <div class="left-header">
                        <img src="/images/al-furqanlogo.jpg" alt="School Logo" class="school-logo-payment">
                        <div class="school-info">
                            <h3>AL-FURQAN ISLAMIC INSTITUTE INCORPORATED</h3>
                            <p>Talabaan, Zamboanga City</p>
                            <p>Phone #: 09358268263</p>
                        </div>
                    </div>

                    <div class="right-header">
                        <div class="receipt-box">
                            <h2>RECEIPT</h2>
                        </div>
                        <p>Semester & SY: <strong>1ST SEM | 2021-2022</strong></p>
                    </div>
                </div>

                <div class="separator-line"></div>

                <!-- Student Info -->
                <div class="student-info-container">
                    <div class="payment-student-info-container">
                        <div class="half-width">
                            <label id="receipt-student-id-label">Student ID:</label>
                            <input type="text" id="receipt-student-id" readonly>
                        </div>

                        <div class="half-width">
                            <label>Date:</label>
                            <input type="date" id="receipt-date" readonly>
                        </div>
                    </div>
                    <div class="payment-student-info-container">
                        <div class="half-width">
                            <label id="receipt-student-name-label">Student Name:</label>
                            <input type="text" id="receipt-student-name" readonly>
                        </div>

                        <div class="half-width">
                            <label id="receipt-number-label">Receipt Number:</label>
                            <input type="text" id="receipt-number" readonly>
                        </div>
                    </div>
                </div>

                <div id="receipt-table" class="receipt-table main-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ITEM #</th>
                                <th>DESCRIPTION</th>
                                <th>AMOUNT</th>
                            </tr>
                        </thead>
                        <tbody id="receipt-items">
                            <!-- <tr>
                                <td>1</td>
                                <td>Tuition Fee</td>
                                <td>1,000.00</td>
                                <td>-200.00</td>
                                <td>800.00</td>
                            </tr> -->
                            <!-- Additional rows will be inserted dynamically if needed -->
                        </tbody>
                    </table>
                </div>

                <!-- Collected By Section -->
                <div id="staff-receiver" class="collector-info-container">
                    <h6>Received/Collected By:</h6>
                    <div class="collector-name-container">
                        <input th:value="${userFullName}" type="text" readonly id="collector-name">
                        <p id="position" th:text="${userRole}"></p>
                    </div>
                </div>

                <!-- Print Button -->
                <div class="modal-buttons">
                    <button type="button" data-close-modal="receiptModal" class="btn-cancel">Close</button>
                    <button type="button" onclick="printReceipt()" class="print-btn">PRINT RECEIPT</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal for addPaymentModal-->
    <div id="addPaymentModal" class="add-payment-modal modal">
        <div class="add-payment-modal-content scroll-lock">
            <div class="modal-body">
                <div class="header-container">
                    <h3>Payment Form</h3>
                </div> <br>

                <div class="payee-info-container" id="payee-info">
                    <div class="student-form-group address-div">
                        <label for="payee-id">Student ID:</label>
                        <input type="text" id="payee-id" readonly>

                        <label for="Date">Date:</label>
                        <input type="date" id="date">
                    </div>

                    <div class="student-form-group address-div">
                        <label for="payee-name">Name:</label>
                        <input type="text" id="payee-name" readonly>
                    </div>
                    <div class="student-form-group address-div">
                        <label for="semester">Semester:</label>
                        <input th:value="${currentSem}" type="text" id="semester" readonly>

                        <label for="school-year">S.Y.</label>
                        <input th:value="${currentSY}" type="text" id="school-year" readonly>
                    </div>
                </div>
                <div class="payment-wrapper">
                    <h6>Payment For:</h6>
                    <div class="payment-container-group">

                    </div> <br>
                </div>

                <div class="payment-amount-container">
                    <div class="student-form-group">
                        <label for="amount" id="label-amount">Amount:</label>
                        <input type="number" max="0" id="payment-amount" placeholder="0.00">
                    </div>
                </div> <br>

                <div id="staff-receiver" class="collector-info-container">
                    <h6>Received/Collected By:</h6>
                    <div class="collector-name-container">
                        <input th:value="${userFullName}" type="text" readonly id="collector-name">
                        <p id="position" th:text="${userRole}"></p>
                    </div>
                </div>
            </div>

            <div class="modal-buttons payment-modal-buttons">
                <button id="save-payment-btn" class="btn-confirm no-print" type="button"
                    data-open-modal="confirmationModal" data-action="savePayment"
                    data-message="Are you sure you want to save this payment?">Save Payment
                </button>

                <button type="button" id="payment-closer" class="btn-cancel"
                    data-close-modal="addPaymentModal">Cancel</button>
            </div>
        </div>

    </div>
</body>

<script>
    // // this is for the popover for the scholar
    // const dropdownScholarBtn = document.getElementById("dropdown-scholar");
    // const popover = document.getElementById("scholar-popover");

    // dropdownScholarBtn.addEventListener("click", function () {
    //     if (popover.matches(":popover-open")) {
    //         popover.hidePopover();
    //     } else {
    //         popover.showPopover();
    //     }
    // });

    function proceedToPayment(enrollmentIdLet, sectionNumberLet) {
        sectionNumberLet = document.querySelector("#section").value;
        if (!sectionNumberLet || sectionNumberLet === "") {
            showErrorModal("❌ Error: Please select a section!");
            return;
        }

        const apiUrl = `/enrollment/add/payment/${enrollmentIdLet}/${sectionNumberLet}`;
        // console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status })))
            .then(({ text, status }) => {
                // console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
                    showSuccessModal("✅ Success: New student has been added successfully!", false);
                    goList(currentPage);
                } else {
                    showErrorModal("❌ Error:" + text);
                }
            })
            .catch(error => {
                showErrorModal("❌ Error: Transaction failed. Please try again!");
            });
    }

    document.addEventListener("DOMContentLoaded", function () {
        document.body.addEventListener("click", function (event) {
            if (event.target.closest(".proceedButton")) {
                event.preventDefault(); // Prevent default link behavior

                // Get Enrollment ID from the button
                enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id");

                // Get the selected section number value
                sectionNumberLet = document.querySelector("#section").value;

                // console.log("Enrollment ID:", enrollmentIdLet);
                // console.log("Selected Section:", sectionNumberLet);
            }
        });
        goList();
        fetchGradeLevelsForm();
        preRequisiteGradesDiv = document.getElementById("preRequisite-grades");
    });
    var preRequisiteGradesDiv;
    async function fetchGradeLevelsForm() {
        const gradeLevels = document.getElementById("lastGradeLevelIdCompleted");
        const response = await fetch("/gradelevel/all");
        if (!response.ok) throw new Error("Failed to fetch grade levels");
        const data = await response.json();
        gradeLevels.innerHTML = '<option value="" disabled selected>Choose a Grade Level</option>';
        data.forEach(level => {
            let option = document.createElement("option");
            option.value = level.levelId;
            option.textContent = level.levelName;
            gradeLevels.appendChild(option);
        });
    }

    function getPaymentStatusClass(status) {
        status = status.toLowerCase();
        if (status === "fully paid") {
            return "paid-status";
        } else if (status === "unpaid") {
            return "unpaid-status";
        } else if (status === "partially paid") {
            return "partially-paid-status"
        }
        return "";
    }

    var payerId = 0;
    function fetchPayments(enrollmentId) {
        fetch(`/enrollment/paymentView/${enrollmentId}`)
            .then(res => res.json())
            .then(epv => {
                const studentname = document.querySelector("#student-name");
                const studentId = document.querySelector("#student-id-list");
                if (!studentname || !studentId) return //console.error("Dropdown for sections not found");

                studentname.textContent = epv.student.fullName;

                studentId.textContent = epv.student.studentDisplayId;
                payerId = epv.student.studentId;
                const tableBody = document.querySelector("#table-ni-kharl tbody");
                tableBody.innerHTML = "";
                epv.feesAndBalance.forEach(datas => {
                    var status = datas.totalPaid < datas.totalRequired && datas.totalPaid === 0 ? "Unpaid" :
                        datas.totalPaid > 0 && datas.totalPaid < datas.totalRequired ? "Partially Paid" :
                            "Fully Paid";
                    const row = document.createElement("tr");
                    const statusClass = getPaymentStatusClass(status);
                    row.innerHTML = `
                        <td>${datas.fee.name}</td>
                        <td>${datas.totalRequired}</td>
                        <td>${datas.totalPaid}</td>
                        <td>${datas.balance}</td>
                        <td>
                            <div class="status-container">
                                <div class="status ${statusClass}">${status}</div>
                            </div>
                        </td>`;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }

    async function fetchAllGradeLevels(isStudentNew, isTransferee, currentLevelId) {
        try {
            isStudentNew = isStudentNew === true || isStudentNew === "true";
            isTransferee = isTransferee === true || isTransferee === "true";
            const isLevelIdNull = currentLevelId === null || currentLevelId === "null" || currentLevelId === "None";
            let url = "/gradelevel/successor/" + currentLevelId;
            if ((isStudentNew && !isTransferee) || isLevelIdNull) {
                url = '/gradelevel/no-pre-requisite';
            } else if (isTransferee && !isLevelIdNull) {
                url = `/gradelevel/for-transferee/${currentLevelId}`;
            }
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to fetch grade levels");
            const data = await response.json();
            populateGradeLevelDropdown(data);
        } catch (error) {
            // console.error("Error fetching grade levels:", error);
        }
    }

    function populateGradeLevelDropdown(gradeLevels) {
        const selectElement = document.getElementById("levelName");
        selectElement.innerHTML = '<option value="" disabled selected>Choose a Grade Level</option>';

        gradeLevels.forEach(level => {
            let option = document.createElement("option");
            option.value = level.levelId;
            option.textContent = level.levelName;
            selectElement.appendChild(option);
        });
    }

    function getCheckedPaymentValues() {
        const checkedCheckboxes = document.querySelectorAll('.payment-container-group input[type="checkbox"]:checked');
        const checkedValues = Array.from(checkedCheckboxes).map(checkbox => checkbox.value);
        return checkedValues;
    }

    function savePayment() {
        const feesSelectedId = getCheckedPaymentValues();
        const totalAmount = paymentAmountInput.value;
        if (totalAmount == 0) {
            showErrorModal("Ammount cannot be P0");
            return;
        } else if (feesSelectedId.length == 0) {
            showErrorModal("Choose a particular");
            return;
        }
        const url = `/paymentrecord/add/all/${encodeURIComponent(payerStudentId)}/${encodeURIComponent(totalAmount)}?gradeLevel=${encodeURIComponent(payLevelToEnrollId)}`;
        const obj = {
            feesId: feesSelectedId
        };

        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(obj)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json(); // Parse the response as JSON
            })
            .then(receipt => {
                document.getElementById("receipt-student-id").value = receipt.studentDisplayId;
                document.getElementById("receipt-date").value = receipt.date;
                document.getElementById("receipt-student-name").value = receipt.studentName;
                document.getElementById("receipt-number").value = receipt.transactionReference;
                document.getElementById("receipt-number").value = receipt.transactionReference;

                const tableBody = document.querySelector("#receipt-table tbody");
                tableBody.innerHTML = "";
                let i = 1;
                receipt.particulars.forEach(dat => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <tr>
                            <td>${i++}</td>
                            <td>${dat.feeName}</td>
                            <td>${dat.amountPaid}</td>
                        </tr>`;
                    tableBody.appendChild(row);
                });
                const row = document.createElement("tr");
                row.innerHTML = `
                        <tfoot>
                            <tr>
                                <td colspan="2">Total Amount Paid:
                                </td>
                                <td>₱ ${receipt.totalAmount}</td>
                            </tr>
                        </tfoot>`;
                tableBody.appendChild(row);
                goList(currentPage);
                closeOpen();
            })
            .catch(error => {
                showErrorModal("Failed to add payment transaction. Please try again.");
            });
    }

    function closeOpen() {
        const button1 = document.createElement("button");
        button1.setAttribute("data-open-modal", "receiptModal");
        const button2 = document.createElement("button");
        button2.setAttribute("data-close-modal", "listOfPaymentsModal");
        document.body.appendChild(button1);
        document.body.appendChild(button2);
        button1.click();
        button2.click();
        document.getElementById("payment-closer").click();
    }

    // < !--document.addEventListener("DOMContentLoaded", function () {
    //         -->
    // < !--document.body.addEventListener("click", function (event) {
    //             -->
    // < !--            if (event.target.closest(".proceedButton")) {
    //                 -->
    // < !--event.preventDefault(); -->

    // < !--enrollmentIdLet = event.target.closest(".proceedButton").getAttribute("data-enrollment-id"); -->
    // < !--console.log("Enrollment ID:", enrollmentIdLet); -->
    // < !--            } -->
    // < !--        }); -->
    // < !--    }); -->

    function proceedToEnrolled(enrollmentIdLet) {
        const apiUrl = `/enrollment/add/enrolled/${enrollmentIdLet}`;
        // console.log(`🔄 Sending request to: ${apiUrl}`);

        fetch(apiUrl, {
            method: "PUT",
            headers: { "Content-Type": "application/json" }
        })
            .then(response => response.text().then(text => ({ text, status: response.status }))) // Get text & status
            .then(({ text, status }) => {
                // console.log(`🔹 API Response (${status}): ${text}`);

                if (status === 200) {
                    showSuccessModal("✅ Success: Student successfully enrolled!", false);
                    location.reload();
                    goList(currentPage);
                } else {
                    // showErrorModal("❌ Error: " + text);
                    location.reload();
                }
            })
            .catch(error => {
                // showErrorModal("❌ Error: " + text);
                location.reload();
            });
    }

    async function proceedToAssessment() {
        const gradeLevelId = document.getElementById("levelName").value;
        if (!gradeLevelId) {
            showErrorModal("❌ Error: Please select a grade level!");
            return;
        }

        try {
            const response = await fetch(`/enrollment/add/assessment/${enrollmentIdLet}/${gradeLevelId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" }
            });

            const result = await response.text();

            if (response.ok) {
                showSuccessModal(result, false);
                goList(currentPage);
            } else {
                showErrorModal("❌ Error: Transaction failed. Please try again!");
            }
        } catch (error) {
            showErrorModal("❌ Error: Transaction failed. Please try again!");
        }
    }

    function addExistingStudent(studentId) {
        fetch('/enrollment/add/student/' + studentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        goList(currentPage);
                        showSuccessModal(message, false);
                    } else {
                        showErrorModal(message);
                    }
                });
            })
            .catch(error => {
                showErrorModal(message);
            });
    }
    document.getElementById("scholar").addEventListener("change", function () {
        this.checked;
    });

    // this is for adding new student/transferee if the checkbox for transferee is checked then it will set the value of data-action attribute to that value
    document.addEventListener('DOMContentLoaded', () => {
        const confirmButton = document.getElementById('confirmStudent');

        confirmButton.addEventListener('click', () => {
            const isTransferee = document.getElementById("isTransferee").checked;
            confirmButton.setAttribute("data-action", "transfereeAddListing");

        });
    });

    function transfereeAddListing() {
        const actionUrl = "/students/add"; // Update with your actual API endpoint
        const method = "POST";

        const selectedTransReq = [];
        document.querySelectorAll("input[name='transferRequirements']:checked").forEach(checkbox => {
            selectedTransReq.push(checkbox.value);
        });
        // console.log(selectedTransReq);
        const selectedDiscounts = [];
        document.querySelectorAll("input[name='studDiscounts']:checked").forEach(checkbox => {
            selectedDiscounts.push(checkbox.value);
        });
        // console.log(selectedTransReq);
        const birthplace =
            document.getElementById("studplaceOfBirth")?.value?.trim() ||
            document.getElementById("studplaceOfBirth")?.value?.trim() ||
            null;

        const studentData = {
            scholar: document.getElementById("scholar").checked,
            firstName: document.getElementById("studentFirstName").value.trim(),
            lastName: document.getElementById("studentLastName").value.trim(),
            middleName: document.getElementById("studentMiddleName")?.value?.trim() || null,
            gender: document.getElementById("studgender").value || null,
            birthdate: document.getElementById("studbirthdate").value || null,
            birthPlace: birthplace,
            address: {
                street: document.getElementById("studstreet")?.value?.trim(),
                barangay: document.getElementById("studbarangay")?.value?.trim(),
                city: document.getElementById("studcity")?.value?.trim()
            },
            fatherName: document.getElementById("studfatherName")?.value?.trim() || null,
            fatherOccupation: document.getElementById("studfatherOccupation")?.value?.trim() || null,
            motherName: document.getElementById("studmotherName")?.value?.trim() || null,
            motherOccupation: document.getElementById("studmotherOccupation")?.value?.trim() || null,

            guardianName: document.getElementById("studguardianName")?.value?.trim() || null,
            guardianOccupation: document.getElementById("studguardianOccupation")?.value?.trim() || null,
            guardianContactNum: document.getElementById("studguardianContactNumber")?.value?.trim() || null,
            guardianAddress: document.getElementById("studguardianAddress")?.value?.trim() || null,
            transferee: document.getElementById("isTransfereeRec").checked,
            lastGradeLevelId: document.getElementById("lastGradeLevelIdCompleted").options[document.getElementById("lastGradeLevelIdCompleted").selectedIndex].value,
            lastMadrasaYearCompleted: document.getElementById("studlastMadrasaYearCompleted")?.value?.trim() || null,
            madrasaName: document.getElementById("studmadrasaNameLastAttended")?.value?.trim() || null,
            madrasaAddress: document.getElementById("studmadrasaAddress")?.value?.trim() || null,
            transfereeRequirements: selectedTransReq,
            discountsAvailed: selectedDiscounts
        };

        fetch(actionUrl, {
            method: method,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(studentData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text); });
                }
                return response.text();
            })
            .then(text => {
                showSuccessModal("✅ Success: New transferee has been added successfully!");
            })
            .catch(error => {
                showErrorModal(error);
            });
    }
    function changeView() {
        goList(1);
    }

    var currentStat = "";
    var currentPage = 0;
    let totalItems = 0;
    var currentStat = "";
    async function goList(pageNo = 1) {
        const search = document.getElementById("search-stud").value;
        currentStat = document.getElementById("sort-select").value;
        currentPage = pageNo;
        const tableBody = document.querySelector("#lamesa tbody");
        const pageSize = parseInt(document.getElementById("pageSizeSelector").value);
        fetch(`/enrollment/all/paged/${currentStat}?pageNo=${pageNo}&pageSize=${pageSize}&search=${search}`)
            .then(res => {
                tableBody.innerHTML = `<tr><td colspan="4">No records found.</td></tr>`;
                if (res.status === 404) {
                    showErrorModal("No currently active semester");
                    return;
                }
                else if (!res.ok) throw new Error("Failed to fetch enrollment records");
                return res.json();
            })
            .then(data => {
                if (data.content.length === 0) { return; }
                tableBody.innerHTML = "";
                data.content.forEach(enr => {
                    const row = document.createElement("tr");
                    row.setAttribute("data-enrollment-id", enr.enrollmentId);
                    row.classList.add("clickable-row");
                    if (enr.notDeleted === false) {
                        row.classList.add("enrollment-cancelled");  // This will make the row red with opacity
                    }

                    const displayStatus = enr.enrollmentStatus === "NOT_REGISTERED" ? "UNREGISTERED" : enr.enrollmentStatus;

                    let dropdownContent = `
                    <a href="#" class="viewRecordButton" data-enrollment-id="${enr.enrollmentId}"
                    data-open-modal="studentInformationModal" onclick="displayStud(${enr.student.studentId})"> View Record </a>` +
                        getDropdownContent(enr);

                    const statusClass = getEnrollmentStatusClass(displayStatus, enr.notDeleted);

                    row.innerHTML = `
                    <td>${enr.student.studentDisplayId}</td>
                    <td>${enr.student.firstName} ${enr.student.middleName ? enr.student.middleName + ' ' : ''} ${enr.student.lastName}</td>`;

                    if (enr.enrollmentStatus === "ASSESSMENT") {
                        const levelId = enr.student.currentGradeLevel?.levelId ?? null;
                        row.innerHTML += `
                        <td>
                            <select onChange="updateGradeLevel(${enr.enrollmentId}, this.options[this.selectedIndex].value)"
                                    class="grade-level-dropdown" data-enrollment-id="${enr.enrollmentId}" 
                                    data-isStudent-new="${enr.student.new}" data-current-grade-Id="${levelId}" 
                                    data-isStudent-transferee="${enr.student.transferee}">
                                <option>Loading...</option> <!-- Placeholder -->
                            </select>
                        </td>`;
                    } else {
                        row.innerHTML += `<td>${enr.gradeLevelToEnroll || "NONE"}</td>`;
                    }

                    const status = enr.notDeleted === false ? "CANCELLED" : enr.enrollmentStatus;
                    row.innerHTML += `
                    <td>
                        <div class="dropdown">
                            <div class="status-container">
                               <div class="status ${statusClass}" id="status-registration">${displayStatus}</div>
                                <button class="dropdown-status-btn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="dropdown-status-content" id="dropdown-listing">
                                ${dropdownContent}
                            </div>
                        </div>
                    </td>`;

                    tableBody.appendChild(row);
                });

                document.querySelectorAll(".grade-level-dropdown").forEach(selectTag => {
                    var currentLevelId = selectTag.getAttribute("data-current-grade-Id");
                    var isStudentNew = selectTag.getAttribute("data-isStudent-new");
                    var isTransferee = selectTag.getAttribute("data-isStudent-transferee");
                    var enrollmentId = selectTag.getAttribute("data-enrollment-id");
                    var selectedGrade = data.content.find(e => e.enrollmentId == enrollmentId)?.gradeLevelToEnroll;
                    fetchGradeLevels(selectedGrade, selectTag, isStudentNew, currentLevelId, isTransferee);
                });

                totalItems = data.totalElements || 0;
                const totalPages = data.totalPages || 1;
                updatePaginationUI(currentPage, pageSize, totalItems, totalPages);
            })
            .catch(error => console.error("Error:", error));
    }

    // this function is to control the color of the status color
    function getEnrollmentStatusClass(status, isCancelled) {
        status = status.toLowerCase();
        if (!isCancelled) {
            return "enrollment-cancelled";
        }
        switch (status) {
            case "listing":
                return "listing-status";
            case "assessment":
                return "assessment-status";
            case "payment":
                return "payment-status";
            case "enrolled":
                return "enrolled-status";
            case "unregistered":
                return "not-registered-status";
            default:
                return "";
        }
    }

    async function updateGradeLevel(enrollmentId, gradeLevelId) {
        try {
            const response = await fetch(`/enrollment/add/assessment/${enrollmentId}/${gradeLevelId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" }
            });

            if (response.ok) {
                showSuccessModal("Enrolling Grade Level successfully updated", false);
                goList(currentPage);
            } else {
                const errorMessage = await response.text();
                showErrorModal(errorMessage);
            }
        } catch (error) {
            // console.error("Error proceeding to assessment:", error);
            showErrorModal("Transaction failed. Try again.");
        }
    }

    function fetchGradeLevels(selectedGrade, selectTag, isStudentNew, currentLevelId, isTransferee) {
        var url = "/gradelevel/successor/" + currentLevelId;
        isStudentNew = isStudentNew === true || isStudentNew === "true";
        isTransferee = isTransferee === true || isTransferee === "true";
        const isLevelIdNull = currentLevelId === null || currentLevelId === "null" || currentLevelId === "None";
        if ((isStudentNew && !isTransferee) || isLevelIdNull) {
            url = '/gradelevel/no-pre-requisite';
        } else if (isTransferee && !isLevelIdNull) {
            url = `/gradelevel/for-transferee/${currentLevelId}`;
        }
        const originalOnChange = selectTag.getAttribute("onChange");
        selectTag.removeAttribute("onChange");

        fetch(url)
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! Status: ${res.status}`);
                }
                return res.json();
            })
            .then(gradeLevels => {
                if (!Array.isArray(gradeLevels) || gradeLevels.length === 0) {
                    // console.warn("No grade levels received or data is not an array.");
                    return;
                }

                selectTag.innerHTML = ""; // Clear existing options

                let foundMatch = false;

                gradeLevels.forEach((grade, index) => {
                    if (!grade.levelId || !grade.levelName) {
                        // console.warn(`Invalid grade level at index ${index}:`, grade);
                        return;
                    }

                    const option = document.createElement("option");
                    option.value = grade.levelId;
                    option.textContent = grade.levelName;
                    if (String(selectedGrade).trim().toLowerCase() === String(grade.levelName).trim().toLowerCase()) {
                        option.selected = true;
                        foundMatch = true;
                    }

                    selectTag.appendChild(option);
                });

                if (!foundMatch) {
                    //console.warn(`⚠️ No matching grade level found for selectedGrade: ${selectedGrade}`);
                }
                selectTag.setAttribute("onChange", originalOnChange);
            })
            .catch(error => console.error("Error fetching grade levels:", error));
    }

    async function cancelEnrollment(enrollmentToCancel, backToNormal) {
        try {
            let response = await fetch(`/enrollment/cancel/${enrollmentToCancel}?undo=${backToNormal}`);

            if (!response.ok) {
                const errorText = await response.text();
                showErrorModal("❌ Error: " + errorText);
                return;
            }

            const successText = await response.text();
            showSuccessModal("✅ Success: " + successText, false);
            goList(currentPage);
        } catch (error) {
            showErrorModal("❌ Error: " + error.message);
        }
    }


    function getDropdownContent(enr) {
        if (enr.notDeleted === false || enr.notDeleted === "false") {
            return `<a href="#" data-enrollment-id="${enr.enrollmentId}" data-action="undoCancel">Undo cancellation</a>`;
        }
        switch (enr.enrollmentStatus) {
            case "LISTING":
                return `
                <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" data-isStudent-new="${enr.student.new}"
                   data-isTransferee="${enr.student.transferee}" data-current-gradeId="${enr.student.currentGradeLevel ? enr.student.currentGradeLevel.levelId : 'None'}"
                   data-open-modal="gradeLevelModal"> Proceed </a>
                <a href="#" data-action="cancelRegistration"
                data-enrollment-id="${enr.enrollmentId}"> Cancel Registration </a>
            `;
            case "ASSESSMENT":
                return `
                <a href="#" class="action" data-displayId="${enr.student.studentDisplayId}"
                   data-prerequisite="${enr.preRequisiteId}"
                   data-stud-name="${enr.student.firstName} ${enr.student.middleName || ""} ${enr.student.lastName}"
                   data-id="${enr.student.studentId}" data-open-modal="viewGradesModal">View Grades</a>
                <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}"
                    data-grade-level-id="${enr.gradeLevelToEnroll}"
                   data-open-modal="addGradeLevelAssessmentModal"
                   ${enr.qualified ? '' : 'style="pointer-events: none; opacity: 0.5; color: gray;"'}>${enr.qualified ? 'Proceed' : 'Not Qualified'}</a>
                   <a href="#" data-action="cancelRegistration"
                    data-enrollment-id="${enr.enrollmentId}"> Cancel Registration </a>
            `;
            case "NOT_REGISTERED":
                return `<a href="#" onclick="addExistingStudent(${enr.student.studentId})"> Add to Listing </a>
            `;
            case "PAYMENT":
                return `
                <a href="#" class="viewPaymentsButton" data-enrollment-id="${enr.enrollmentId}" 
                   data-open-modal="listOfPaymentsModal"
                   data-student-id="${enr.student.studentId}"
                   data-level-id="${enr.gradeLevelToEnrollId}"
                   > View List of Payments </a>
                ${enr.complete ? `
                    <a href="#" class="proceedButton" data-enrollment-id="${enr.enrollmentId}" 
                       data-open-modal="confirmationModal" 
                       data-message="Are you sure you want to proceed and finish enrollment?" 
                       data-action="proceedToEnrolled"> Proceed </a>
                    <a href="#" data-action="cancelRegistration"
                        data-enrollment-id="${enr.enrollmentId}"> Cancel Registration </a>
                ` : `<a style="pointer-events: none; opacity: 0.5; color: gray;">
                       Minimum payment is required to each fee/s
                    </a>`}
            `;
            case "ENROLLED":
                return `
            `;
            default:
                return `<p>No actions available</p>`;
        }
    }

    function fetchDiscounts(popoverId = "add-scholar-popover", discIds = []) {
        const popover = document.getElementById(popoverId);
        if (!popover) return //console.error(`Element with ID ${popoverId} not found.`);

        popover.innerHTML = ``;

        fetch("/discounts/all")
            .then(response => response.json())
            .then(data => {
                // Create and append the heading
                const heading = document.createElement("h6");
                heading.textContent = "Scholarship Types:";
                popover.appendChild(heading);

                const discountWrapper = document.createElement("div");
                discountWrapper.classList.add("checkbox-container-popover");

                data.forEach(disc => {
                    const paymentDiv = document.createElement("div");
                    paymentDiv.classList.add("checkbox-each");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `disc-${disc.discountId}`;
                    checkbox.name = "studDiscounts";
                    checkbox.value = disc.discountId;

                    const label = document.createElement("label");
                    label.htmlFor = `disc-${disc.discountId}`;
                    label.textContent = disc.discountName;

                    if (discIds.includes(disc.discountId)) {
                        checkbox.checked = true;
                    }

                    paymentDiv.appendChild(checkbox);
                    paymentDiv.appendChild(label);
                    discountWrapper.appendChild(paymentDiv);
                });

                popover.appendChild(discountWrapper);
            })
            .catch(error => console.error("Error fetching discounts:", error));
    }



    function fetchTransRequirements(divId = "transfereeReq", reqIds = []) {
        fetch("/trans-req/all")
            .then(response => response.json())
            .then(data => {
                const reqContainer = document.getElementById(divId);
                reqContainer.innerHTML = "";

                const reqWrapper = document.createElement("div");
                reqWrapper.classList.add("checkbox-container-popover");

                data.forEach(transReq => {
                    // Create and append the heading
                    const heading = document.createElement("h6");
                    heading.textContent = "Requirements:";
                    popover.appendChild(heading);

                    //console.log(transReq);
                    const reqDiv = document.createElement("div");
                    reqDiv.classList.add("checkbox-each");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = `transReq-${transReq.id}`;
                    checkbox.name = "transferRequirements";
                    checkbox.value = transReq.id;

                    const label = document.createElement("label");
                    label.htmlFor = `transReq-${transReq.id}`;
                    label.textContent = transReq.name;

                    if (reqIds.includes(transReq.id)) {
                        checkbox.checked = true;
                    }

                    reqDiv.appendChild(checkbox);
                    reqDiv.appendChild(label);
                    reqWrapper.appendChild(reqDiv);
                });

                reqContainer.appendChild(reqWrapper);
            })
            .catch(error => console.error("Error fetching transfer requirements:", error));
    }



    var toUpdateRecStudent;
    async function displayStud(studentId) {
        const response = await fetch(`/students/find-student/${studentId}`);
        if (!response.ok) { return; }
        const studentProf = await response.json();
        toUpdateRecStudent = studentId;
        document.getElementById("stud-type").textContent = studentProf.status;
        document.getElementById("isTransferee").checked = studentProf.transferee;
        document.getElementById("isScholar").textContent = studentProf.discountsAvailed > 0 ? "YES" : "NO";

        document.getElementById("student-id").value = studentProf.studentDisplayId;
        document.getElementById("firstName").value = studentProf.firstName;
        document.getElementById("middleName").value = studentProf.middleName;
        document.getElementById("lastName").value = studentProf.lastName;
        document.getElementById("gender").value = studentProf.gender;
        document.getElementById("birthdate").value = studentProf.birthdate;
        document.getElementById("placeOfBirth").value = studentProf.birthPlace;
        document.getElementById("street").value = studentProf.address.street;
        document.getElementById("barangay").value = studentProf.address.barangay;
        document.getElementById("city").value = studentProf.address.city;

        document.getElementById("fatherName").value = studentProf.fatherName;
        document.getElementById("fatherOccupation").value = studentProf.fatherOccupation;
        document.getElementById("motherName").value = studentProf.motherName;
        document.getElementById("motherOccupation").value = studentProf.motherOccupation;
        document.getElementById("guardianName").value = studentProf.guardianName;
        document.getElementById("guardianOccupation").value = studentProf.fatherOccupation;
        document.getElementById("guardianContactNumber").value = studentProf.guardianContactNum;
        document.getElementById("guardianAddress").value = studentProf.guardianAddress;


        document.getElementById("lastGradeLevelCompleted").value = studentProf.currentGradeLevel ? studentProf.currentGradeLevel.levelName : 'None';
        document.getElementById("lastMadrasaYearCompleted").value = studentProf.lastMadrasaYearCompleted;
        document.getElementById("madrasaNameLastAttended").value = studentProf.madrasaName;
        document.getElementById("madrasaAddress").value = studentProf.madrasaAddress;
        fetchTransRequirements("transfereeReq-rec", studentProf.transfereeRequirements);
        fetchDiscounts("discounts-rec", studentProf.discountsAvailed);

        toggleTransfereeSection(studentProf.transferee);
    }

    function updateDiscounts() {
        const selectedTransReq = [];
        document.querySelectorAll("#discounts-rec input[name='studDiscounts']:checked").forEach(checkbox => {
            selectedTransReq.push(checkbox.value);
        });
        fetch(`/discounts/add-student-discounts/${toUpdateRecStudent}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ids: selectedTransReq
            }),
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        showSuccessModal(message, false);
                        displayStud(toUpdateRecStudent);
                        goList(currentPage);
                    } else {
                        showErrorModal(message); // Show the error message if the response is not ok
                    }
                });
            })
            .catch(error => {
                showErrorModal(error.message || "An unexpected error occurred."); // Show an error modal in case of failure
            });
    }

    function updateRequirements() {
        const selectedTransReq = [];
        document.querySelectorAll("#transfereeReq-rec input[name='transferRequirements']:checked").forEach(checkbox => {
            selectedTransReq.push(checkbox.value);
        });
        fetch(`/trans-req/add/student-requirements/${toUpdateRecStudent}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                ids: selectedTransReq
            }),
        })
            .then(response => {
                return response.text().then(message => {
                    if (response.ok) {
                        showSuccessModal(message, false);
                        displayStud(toUpdateRecStudent);
                        goList(currentPage);
                    } else {
                        showErrorModal(message); // Show the error message if the response is not ok
                    }
                });
            })
            .catch(error => {
                showErrorModal(error.message || "An unexpected error occurred."); // Show an error modal in case of failure
            });
    }

    //pagination JS code
    function updatePaginationUI(currentPage, pageSize, totalItems, totalPages) {
        const start = totalItems === 0 ? 0 : (currentPage - 1) * pageSize + 1;
        const end = Math.min(currentPage * pageSize, totalItems);

        document.getElementById("itemRange").textContent = `${start}–${end} of ${totalItems}`;
        document.getElementById("pageInput").value = currentPage;
        document.getElementById("pageInput").min = 1;
        document.getElementById("pageInput").max = totalPages;
        document.getElementById("totalPages").textContent = `of ${totalPages}`;

        document.getElementById("prevPage").disabled = currentPage <= 1 || totalPages === 0;
        document.getElementById("nextPage").disabled = currentPage >= totalPages || totalPages === 0;
    }

    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            goList(currentPage);
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        if (currentPage < document.getElementById("pageInput").max) {
            currentPage++;
            // console.log("Navigating to page:", currentPage);
            goList(currentPage);
        } else {
            // console.log("Cannot navigate to next page");
        }
    });

    document.getElementById("pageInput").addEventListener("change", (e) => {
        const totalPages = parseInt(document.getElementById("pageInput").max);
        let page = parseInt(e.target.value);
        if (page >= 1 && page <= totalPages) {
            currentPage = page;
            goList(currentPage);
        } else {
            e.target.value = currentPage;
        }
    });

    document.getElementById("pageSizeSelector").addEventListener("change", (e) => {
        //console.log("pageSizeSelector changed", { value: e.target.value });
        pageSize = parseInt(e.target.value);
        currentPage = 1;
        goList(currentPage);
    });

    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add("show");
            modal.style.visibility = "visible";
            modal.style.opacity = "1";
            modal.style.pointerEvents = "auto";
        }
    }

    // This will show and hide the transferee section if the student is a transferee or not
    function toggleTransfereeSection(isTransferee) {
        const transfereeSections = document.querySelectorAll(".transferee-section");
        if (isTransferee) {
            //console.log("✅ YES detected, showing transferee sections.");
            transfereeSections.forEach(section => section.style.display = "block");
        } else {
            // console.log("❌ NO detected, hiding transferee sections.");
            transfereeSections.forEach(section => section.style.display = "none");
        }
    }
    let payerStudentId;
    let payLevelToEnrollId;
    document.addEventListener("click", function (event) {
        const target = event.target;
        const gradeLevelbtn = target.closest('[data-open-modal="gradeLevelModal"]');
        const proceedButton = target.closest('[data-open-modal="addGradeLevelAssessmentModal"]');
        const enrollmentId = target.getAttribute("data-enrollment-id");
        const paymentList = target.closest('[data-open-modal="listOfPaymentsModal"]');
        const viewRecordButton = target.closest(".viewRecordButton");
        const paymentBtn = target.closest('[data-open-modal="addPaymentModal"]');
        const proceedToEnrolledButton = target.closest("#proceed-btn");
        const cancelReg = target.closest('[data-action="cancelRegistration"]');
        const undoCancellation = target.closest('[data-action="undoCancel"]');
        if (cancelReg) {
            const enrollmentIdCancel = cancelReg.getAttribute("data-enrollment-id");
            cancelEnrollment(enrollmentIdCancel, false);
        } else if (undoCancellation) {
            const enrollmentIdBackToLife = undoCancellation.getAttribute("data-enrollment-id");
            cancelEnrollment(enrollmentIdBackToLife, true);
        }
        else if (proceedToEnrolledButton) {
            const enrollmentIdElement = proceedToEnrolledButton.getAttribute("data-enrollment-id");

            if (enrollmentIdElement) {
                enrollmentIdLet = enrollmentIdElement.trim();
            } else {
                showErrorModal("⚠️ Enrollment ID not found.");
            }
        }
        else if (paymentBtn) {
            setUpPaymentForm();
        }
        else if (paymentList) {
            const enrollmentId = paymentList.getAttribute("data-enrollment-id");
            if (!enrollmentId) return //console.error("Enrollment Id Not Found");
            payerStudentId = paymentList.getAttribute("data-student-id");
            payLevelToEnrollId = paymentList.getAttribute("data-level-Id");
            fetchPayments(enrollmentId);
        }
        if (target.classList.contains("viewRecordButton")) {
            //console.log(`🔍 View Record for Enrollment ID: ${enrollmentId}`);
            openModal("studentInformationModal");
        }
        if (target.classList.contains("proceedButton")) {
            const modalId = target.getAttribute("data-open-modal");
            openModal(modalId);
        }
        if (target.dataset.openModal === "viewGradesModal") {
            viewStudentGrade(target);
        }
        if (target.classList.contains("viewPaymentsButton")) {
            //console.log(`💰 Viewing Payments for Enrollment ID: ${enrollmentId}`);
            openModal("listOfPaymentsModal");
        }
        if (proceedButton) {
            const gradeLevel = proceedButton.getAttribute("data-grade-level-id");
            if (!gradeLevel) return //console.error("Grade level not found for section selection");
            const gradeLevelInput = document.querySelector("#grade-level");
            if (gradeLevelInput) {
                gradeLevelInput.value = gradeLevel;
            }
            fetchSections(gradeLevel);
        }
        if (gradeLevelbtn) {
            const isStudentNew = gradeLevelbtn.getAttribute("data-isStudent-new");
            const isTransferee = gradeLevelbtn.getAttribute("data-isTransferee");
            const currentGradeId = gradeLevelbtn.getAttribute("data-current-gradeId");
            fetchAllGradeLevels(isStudentNew, isTransferee, currentGradeId);
        }
    });

    function handleCheckboxChange(event, balance) {
        const checkbox = event.target; // The checkbox that was clicked
        const value = checkbox.value; // The value of the checkbox
        const isChecked = checkbox.checked; // Whether the checkbox is checked or unchecked
        const currentMax = parseFloat(paymentAmountInput.max) || 0;
        let newMax = 0;
        if (isChecked) {
            newMax = currentMax + balance;
        } else {
            newMax = currentMax - balance;
        }
        paymentAmountInput.max = newMax;
        if (paymentAmountInput.value > newMax) {
            paymentAmountInput.value = newMax;
        }
    }
    const paymentAmountInput = document.getElementById('payment-amount');
    if (paymentAmountInput) {
        paymentAmountInput.addEventListener('input', function () {
            const maxValue = parseFloat(this.max);
            const enteredValue = parseFloat(this.value);

            if (enteredValue > maxValue) {
                showErrorModal("Maximum amount is " + maxValue);
                this.value = maxValue;
            }
        });
    }
    async function setUpPaymentForm() {
        paymentAmountInput.max = 0;
        paymentAmountInput.value = 0.0;
        let response = await fetch(`/paymentrecord/form/${payerStudentId}?gradeLevelId=${payLevelToEnrollId}`);
        if (!response.ok) throw new Error("wa nakita");
        let data = await response.json();
        const student = data.student;

        const studentname = document.querySelector("#payee-name");
        const studentDisplayId = document.querySelector("#payee-id");
        studentname.value = student.fullName;
        studentDisplayId.value = student.studentDisplayId;

        const paymentContainer = document.querySelector(".payment-container-group");
        paymentContainer.innerHTML = '';
        data.feesAndBalance.forEach(par => {
            const paymentItem = document.createElement("div");
            paymentItem.classList.add("payment-item");
            // console.log(par);
            // console.log(par.balance);
            const input = document.createElement("input");
            input.type = "checkbox";
            input.name = par.fee.name;
            input.value = par.fee.id;
            input.addEventListener("change", (event) => {
                handleCheckboxChange(event, par.balance);
            });

            let label = document.createElement("label");
            label.textContent = par.fee.name;
            label.setAttribute("for", par.fee.name);

            paymentItem.appendChild(input);
            paymentItem.appendChild(label);
            paymentContainer.appendChild(paymentItem);
        });
    }

    function viewStudentGrade(target) {
        const studentId = target.dataset.id;
        const preRequisiteId = target.getAttribute("data-prerequisite");
        document.getElementById("student-grade-name").textContent = target.getAttribute("data-stud-name");
        document.getElementById("student-grade-id").textContent = target.getAttribute("data-displayId");
        if (preRequisiteId === "null") {
            return;
        }

        if (!studentId) {
            //    console.error(
            //         "Error: gradeLevelId is undefined! Make sure data-id is set in HTML."
            //     );
            return;
        }

        fetch(`/student-grades/student/${studentId}/${preRequisiteId}`)
            .then((response) => response.json())
            .then((data) => {
                const studentGradesMap = new Map(Object.entries(data.content));
                preRequisiteGradesDiv.innerHTML = `
                        <table class="view-grades-table main-table">
                        <thead>
                            <tr>
                                <th>Subject ID</th>
                                <th>Subject</th>
                                <th>Grade</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td colspan="3">No Records Found</td>
                            </tr>
                        </tbody>
                    </table>`;
                if (studentGradesMap.size === 0) {
                    return;
                }
                preRequisiteGradesDiv.innerHTML = ``;
                let count = 0; // make sure this is defined above the forEach
                let rowContainer;

                studentGradesMap.forEach((values, key) => {
                    let gradeTotal = 0;
                    let gradeCount = 0;
                    let gradesRow = ``;

                    values.forEach((grade) => {
                        gradeTotal += grade.subjectGrade === null ? 0 : grade.subjectGrade;
                        gradeCount++;
                        gradesRow += `
        <tr>
            <td>${grade.subjectName}</td>
            <td>${grade.subjectName}</td>
            <td>${grade.subjectGrade === null ? 'N/A' : grade.subjectGrade}</td>
        </tr>`;
                    });

                    let avg = gradeTotal / gradeCount;

                    // Format the key: "Grade 1 - Section 2 : 2025-2026-Second sem"
                    const [sectionPart, rest] = key.split(":");
                    const restParts = rest.trim().split("-");
                    const sy = `${restParts[0]}-${restParts[1]}`;
                    const sem = restParts.slice(2).join(" ").replace(/\bfirst\b/i, "1st").replace(/\bsecond\b/i, "2nd");
                    const formattedHeader = `${sectionPart.trim()} | SY: ${sy} (${sem})`;


                    const gradeWrapper = document.createElement("div");
                    gradeWrapper.className = "grade-wrapper";
                    gradeWrapper.innerHTML = `
        <h6 class="grades-header">${formattedHeader}</h6>
        <table class="view-grades-table main-table">
            <thead>
                <tr>
                    <th>Subject ID</th>
                    <th>Subject</th>
                    <th>Grade</th>
                </tr>
            </thead>
            <tbody>
                ${gradesRow}
                <tr>
                    <td colspan="2">Average</td>
                    <td>${avg.toFixed(2)}</td>
                </tr>
            </tbody>
        </table>`;

                    // Group every 2 wrappers in a row
                    if (count % 2 === 0) {
                        rowContainer = document.createElement("div");
                        rowContainer.className = "grades-row";
                        preRequisiteGradesDiv.appendChild(rowContainer);
                    }

                    rowContainer.appendChild(gradeWrapper);
                    count++;
                });
            })
            .catch((error) => console.error("Error fetching grade level:", error));
    }

    let enrollmentIdLet = null;
    function fetchSections(gradeLevel) {
        fetch(`/section/gradeLevel/${gradeLevel}`)
            .then(res => res.json())
            .then(sections => {
                const selectTag = document.querySelector("#section"); // Modal select tag
                if (!selectTag) return //console.error("Dropdown for sections not found");

                selectTag.innerHTML = `<option value="">Select Section</option>`; // Default option

                sections.forEach(section => {
                    const option = document.createElement("option");
                    option.value = section.number;
                    option.textContent = section.sectionName;
                    selectTag.appendChild(option);
                });
            })
            .catch(error => console.error("Error fetching sections:", error));
    }
    document.addEventListener("click", async function (event) {
        const addButton = event.target.closest('.add-payment-btn');

        if (addButton) {
            const studentName = document.querySelector("#student-name")?.textContent?.trim();
            const studentId = document.querySelector("#student-id-list")?.textContent;
            if (!studentName || !studentId) {
                //console.error("Student information not found");
                return;
            }

            document.querySelector("#payee-name").value = studentName;
            document.querySelector("#payee-id").value = studentId;

            // Set current date in the "Date" field (local timezone)
            let dateInput = document.getElementById("date");
            if (dateInput) {
                const today = new Date();
                const formattedDate = today.getFullYear() + "-" +
                    String(today.getMonth() + 1).padStart(2, '0') + "-" +
                    String(today.getDate()).padStart(2, '0');

                dateInput.value = formattedDate; // Correct local date
                dateInput.readOnly = true;       // Make it readonly
            } else {
                // console.error("Date input field not found in the modal");
            }


            // Fetch and populate the current active school year
            try {
                let response = await fetch("/semester/currentactive");
                if (!response.ok) throw new Error("Failed to fetch active school year");

                let data = await response.json();
                document.getElementById("semester").value = data.sem;
                document.getElementById("school-year").value = data.schoolYear.schoolYear;

            } catch (error) {
                // console.error("Error fetching current active school year:", error);
            }

            // Fetch and populate payment list
            try {
                let response = await fetch("/payments/all");
                if (!response.ok) throw new Error("Failed to fetch required payments");

                let data = await response.json();
                let paymentList = document.getElementById("payment-list");

                paymentList.innerHTML = '<option value="" disabled selected>Choose</option>';
                Object.values(data).forEach(payment => {
                    let option = document.createElement("option");
                    option.value = payment.id;
                    option.textContent = payment.name;
                    paymentList.appendChild(option);
                });

            } catch (error) {
                //console.error("Error fetching payment list:", error);
            }
        }
    });

    // this will hide and unhide the transferee-section when user checks and unchecks the checkbox
    document.addEventListener("DOMContentLoaded", function () {
        const transfereeCheckbox = document.getElementById("isTransfereeRec");
        const transfereeFields = document.getElementById("transfereeFields");
        const requiredInputs = transfereeFields.querySelectorAll("input, select, textarea");

        transfereeCheckbox.addEventListener("change", function () {
            if (this.checked) {
                fetchTransRequirements();
                transfereeFields.style.display = "block";
                requiredInputs.forEach(input => {
                    input.setAttribute("required", "required");
                });
            } else {
                document.getElementById("transfereeReq").innerHTML = ``;
                transfereeFields.style.display = "none";
                requiredInputs.forEach(input => {
                    input.removeAttribute("required");
                });
            }
        });
        document.getElementById("add-scholar-popover").innerHTML = ``;
        const isScholarship = document.getElementById("scholar");
        isScholarship.addEventListener("change", function () {
            if (this.checked) {
                fetchDiscounts();
            } else {
                document.getElementById("add-scholar-popover").innerHTML = ``;
            }
        });
    });

    // this will validate the last madrasa year completed (it must only submit 2 succeeding years e.g. 2012-2013)
    function validateMadrasaYear() {
        const madrasaYearInput = document.getElementById("studlastMadrasaYearCompleted").value.trim();
        const regex = /^(\d{4})-(\d{4})$/;
        const match = madrasaYearInput.match(regex);

        if (!match) {
            showErrorModal("❌ Error: " + "Invalid format! Please enter the Madrasa year in YYYY-YYYY format.");
            return false;
        }

        const startYear = parseInt(match[1], 10);
        const endYear = parseInt(match[2], 10);

        if (endYear !== startYear + 1) {
            showErrorModal("❌ Error: " + "Invalid year range! The second year must be exactly one year after the first.");
            return false;
        }

        return true;
    }
</script>

</html>